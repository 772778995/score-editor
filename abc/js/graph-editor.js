var rest = false;
var cen = new Object();
var svgns = `http://www.w3.org/2000/svg`;
var xlinkns = `http://www.w3.org/1999/xlink`;
var currShape = `#demo_black`;
var lastShape = ``;
var headModel = ``;
var isSelectDeco = false;
var selectDecoType = ``;
var selectDecoInfo = null;
var selectGchInfo = null;
var editorV = -1;
var selectedStaffNum = -1;
var hasAddBlank = false;
var dragSplNum = false;
var chordInput = false;
var nearDecoNote = null;
var updateNoteIndexInChord = -1;
var models = {
  "Treble Clef": `%%staffsep 60
%%sysstaffsep 60
%%pagewidth 1500
%%contbarnb 1
%%leftmargin 2
%%rightmargin 10
%%titlefont Microsoft-YaHei 28
%%stretchlast 0.7
I:abc-charset utf-8
X: 1
T: 标题
C: 作曲
Q: 1/4=88
M: 4/4
L: 1/8
K: C
V:1 treble
%%MIDI program 0
`,
  "Bass Clef": `%%staffsep 60
%%sysstaffsep 60
%%pagewidth 1500
%%contbarnb 1
%%leftmargin 2
%%rightmargin 10
%%titlefont Microsoft-YaHei 28
%%stretchlast 0.7
I:abc-charset utf-8
X: 1
T: 标题
C: 作曲
Q: 1/4=88
M: 4/4
L: 1/8
K: C
V:1 bass
%%MIDI program 0
`,
  "Grand Clef": `%%staffsep 60
%%sysstaffsep 60
%%contbarnb 1
%%leftmargin 2
%%rightmargin 10
%%titlefont Microsoft-YaHei 28
%%stretchlast 0.7
I:abc-charset utf-8
X: 1
T: 标题
C: 作曲
Q: 1/4=88
M: 4/4
L: 1/8
K: C
%%MIDI program 0
V:1 treble

V:2 bass
`,
  SATB: `%%staffsep 60
%%sysstaffsep 60
%%contbarnb 1
%%leftmargin 2
%%rightmargin 10
%%titlefont Microsoft-YaHei 28
%%stretchlast 0.7
I:abc-charset utf-8
X: 1
T: 标题
C: 作曲
Q: 1/4=88
M: 4/4
L: 1/8
K: C
%%MIDI program 0
V:1 treble

V:2 bass
`,
};
var deco_params = {
  jr: { start: `!>(!`, end: `!>)!` },
  jq: { start: `!<(!`, end: `!<)!` },
  k_slur: { start: `!slur(!`, end: `!slur)!` },
  dnb: { start: `v` },
  upb: { start: `u` },
  accent: { start: `!>!` },
  stc: { start: `.` },
  emb: { start: `!tenuto!` },
  lmrd: { start: `!mordent!` },
  opend: { start: `!open!` },
  dplus: { start: `!plus!` },
  sgno: { start: `!segno!` },
  brth: { start: `!breath!` },
  sphr: { start: `!shortphrase!` },
  "D.C. al Fine": { start: `!D.C.alfine!` },
  "D.S. al Fine": { start: `!D.S.alfine!` },
  Fine: { start: `!fine!` },
  pedoff: { start: `!ped-up!` },
  slur: { start: `(`, end: `)` },
  "8va": { start: `!8va(!`, end: `!8va)!` },
  "8vb": { start: `!8vb(!`, end: `!8vb)!` },
  "15ma": { start: `!15ma(!`, end: `!15ma)!` },
  "15mb": { start: `!15mb(!`, end: `!15mb)!` },
  tubrn: { start: `(\\d{1,2}` },
};
var tubrn_rules = {
  3: `/2`,
  4: `/4`,
  5: `/4`,
  6: `/4`,
  7: `/4`,
  8: `/8`,
  9: `/8`,
};
graph_update = true;
var graphEditor = { isPlayNote: true, pianoImpro: null };
var fixedLen = false;
var chordNote = ``;
var chordNoteLyric = ``;
function followMouse(_0x16062) {
  if (rest) {
    return;
  }
  var _0x17688 = _0x16062[`target`];
  var _0x1865A = _0x17688[`tagName`];
  if (_0x1865A != `svg`) {
    _0x17688 = $(_0x17688)[`parents`](`svg`);
  }
  var _0x18687 = document[`getElementById`](`use_black`);
  if (
    $(_0x16062[`target`])
    [`parents`](`svg`)
    [`attr`](`id`) !=
    $(_0x18687)[`parents`](`svg`)[`attr`](`id`)
  ) {
    $(`#use_black`)[`remove`]();
    _0x18687 = null;
  }
  if (!_0x18687) {
    _0x18687 = document[`createElementNS`](svgns, `use`);
    _0x18687[`setAttribute`](`id`, `use_black`);
    _0x18687[`setAttributeNS`](xlinkns, `href`, currShape);
    _0x18687[`setAttribute`](`x`, -10);
    _0x18687[`setAttribute`](`y`, -10);
    if ($(_0x17688)[`find`](`.g`)['length'] > 0) {
      $(_0x17688)[`find`](`.g`)[`append`]($(_0x18687));
    }
  }
  $(`use[type='demo_hl']`)[`remove`]();
  $(`.editor_rect`)[`removeClass`](`editor_rect`);
  editSvgLineIndex = $(_0x18687)
  [`parents`](`svg`)
  [`attr`](`id`);
  var _0x186B4 = findNearInfo(
    $(_0x18687)[`parents`](`svg`),
    _0x16062[`offsetX`] / scale,
    _0x16062[`offsetY`] / scale
  );
  if (_0x186B4) {
    cen = syms[_0x186B4[`istart`]];
  } else {
    cen = null;
  }
  if (isSelectDeco) {
    if (selectDecoType == `nodeline`) {
      moveingRenderBar(_0x16062);
    }
    if (selectDecoType == `linkclef`) {
      movingRenderStaff(_0x16062);
    }
    return;
  }
  var _0x176B5 = getYinfo(
    $(_0x18687)[`parents`](`svg`),
    _0x16062[`offsetY`] / scale
  );
  if (_0x186B4 && _0x176B5) {
    _0x18687[`setAttribute`](`x`, parseFloat(_0x186B4[`x`]));
    _0x18687[`setAttribute`](`y`, parseFloat(_0x176B5[`y`]));
    var _0x175D4 = _0x176B5[`num`];
    if (_0x175D4 != 0) {
      draw_short_line(
        _0x175D4,
        parseFloat(_0x186B4[`x`]),
        _0x176B5,
        _0x17688
      );
    }
    cen[`mouse_pos`] = _0x176B5[`mouse_pos`];
  } else {
    console[`log`](`未找到任何音符` + new Date());
  }
  rest = true;
  setTimeout(function () {
    rest = false;
  }, 66);
}
function draw_short_line(_0x175D4, _0x16008, _0x176B5, _0x17688) {
  if (_0x175D4 != 0) {
    var _0x17601 = _0x16008 + 4;
    var _0x1762E = parseFloat(_0x176B5[`staffY`]);
    if (_0x175D4 > 0) {
      _0x1762E -= 24;
      for (var _0x15CDE = 0; _0x15CDE < _0x175D4; _0x15CDE++) {
        _0x1762E -= 6;
        var _0x1765B = document[`createElementNS`](svgns, `use`);
        _0x1765B[`setAttributeNS`](xlinkns, `href`, `#my_hl`);
        _0x1765B[`setAttribute`](`type`, `demo_hl`);
        $(_0x17688)[`find`](`.g`)[`append`]($(_0x1765B));
        _0x1765B[`setAttribute`](`x`, _0x17601);
        _0x1765B[`setAttribute`](`y`, _0x1762E);
      }
    } else {
      for (var _0x15CDE = 0; _0x15CDE > _0x175D4; _0x15CDE--) {
        _0x1762E += 6;
        var _0x1765B = document[`createElementNS`](svgns, `use`);
        _0x1765B[`setAttributeNS`](xlinkns, `href`, `#my_hl`);
        _0x1765B[`setAttribute`](`type`, `demo_hl`);
        $(_0x17688)[`find`](`.g`)[`append`]($(_0x1765B));
        _0x1765B[`setAttribute`](`x`, _0x17601);
        _0x1765B[`setAttribute`](`y`, _0x1762E);
      }
    }
  }
}
function findNearInfo(argAAA, argBBB, argCCC) {
  var aaa = '';
  var jqEditorvSelected = $('.editorv.selected');
  if (jqEditorvSelected['length'] > 0) {
    aaa =
      `[v='` +
      (parseInt($(jqEditorvSelected)[`attr`](`value`)) - 1) +
      `']`;
  }
  var bbb = 9999;
  var ccc = 9999;
  var ddd = null;
  var eee = `rect[type='rest']` + aaa + `,rect[type='note']` + aaa + ``;
  if (musicType == 2) {
    eee = `rect[type='splnum_note'],rect[type='splnum_rest'],rect[type='splnum_chord']`;
  }
  var fff = $(dragObj)[`attr`](`value`);
  if (fff && fff[`indexOf`](`[K:`) == 0) {
    eee += `,rect[type='bar']` + aaa + `,rect[type='clef']`;
  }
  if ($(dragObj)[`attr`](`type`) == `all`) {
    if (musicType == 2) {
      eee += `,rect[type='splnum_bar']` + aaa + `,rect[type='clef']`;
    } else {
      eee += `,rect[type='bar']` + aaa + `,rect[type='clef']`;
    }
  }
  if (dragObj != null) {
    console[`log`]($(dragObj)[`attr`](`type`));
    if ($(dragObj)[`attr`](`type`) == `linkclef`) {
      return;
    }
    if (musicType == 0) {
      if ($(dragObj)[`attr`](`type`) == `nodeline`) {
        return;
        eee = `rect[type='bar']`;
      }
    } else {
      if ($(dragObj)[`attr`](`type`) == `nodeline`) {
        return;
        eee = `rect[type='splnum_bar']`;
      }
    }
  }
  $(argAAA)
  [`find`](eee)
  [`each`](function (_0x15CDE, _0x1646D) {
    var ggg = parseFloat($(this)[`attr`](`x`));
    var hhh = parseFloat($(this)[`attr`](`y`));
    var iii = parseFloat($(this)[`attr`](`height`));
    var jjj = parseFloat($(this)[`attr`](`width`));
    if (musicType == 2) {
      if ($(_0x1646D)[`attr`](`type`) != `splnum_bar`) {
        var kkk = $(_0x1646D)[`parent`]();
        var lll = $(kkk)[`attr`](`transform`);
        var mmm = getTransformsTranslate(lll);
        ggg = ggg + parseFloat(mmm[`x`]);
        hhh = hhh + parseFloat(mmm[`y`]);
      }
    }
    if (
      argBBB >= ggg &&
      argBBB <= ggg + jjj &&
      argCCC >= hhh &&
      argCCC <= hhh + iii
    ) {
      ccc = ppp;
      ddd = $(this);
    } else {
      var nnn = Math[`abs`](parseFloat(ggg) - argBBB);
      var ooo = Math[`abs`](parseFloat(hhh) - argCCC);
      if (nnn > 50) {
        return;
      }
      if (ooo > 50) {
        if (argCCC < hhh) {
          return;
        } else {
          if (
            argCCC > hhh &&
            argCCC - (hhh + parseFloat(iii)) > 30
          ) {
            return;
          }
        }
      }
      var ppp = 0;
      if (argCCC > parseFloat(hhh) + parseFloat(iii)) {
        var _0x18330 = Math[`abs`](
          argCCC - (parseFloat(hhh) + parseFloat(iii))
        );
        ppp = Math[`sqrt`](
          Math[`pow`](nnn, 2) + Math[`pow`](_0x18330, 2)
        );
      } else {
        ppp = Math[`sqrt`](
          Math[`pow`](nnn, 2) + Math[`pow`](ooo, 2)
        );
      }
      if (ppp < 30) {
        if (ppp < ccc) {
          ccc = ppp;
          ddd = $(this);
        }
      }
    }
  });
  var _0x18114 = false;
  if (ddd != null) {
    var _0x181F5 = $(ddd)[`attr`](`istart`);
    var _0x16170 = syms[_0x181F5];
    if (_0x16170 && _0x16170[`dur`] == _0x16170[`my_wmeasure`]) {
      _0x18114 = true;
    }
  }
  if (ddd != null) {
    $(`.editor_rect`)[`removeClass`](`editor_rect`);
    $(`rect[type='rest'],rect[type='note']`)[`css`](`fill-opacity`, `0`);
    $(ddd)[`addClass`](`editor_rect`);
    var _0x17AED = new Object();
    var _0x1716F = $(ddd)[`prev`]();
    while ($(_0x1716F)[`attr`](`type`) == `dot`) {
      _0x1716F = $(_0x1716F)[`prev`]();
    }
    if ($(_0x1716F)[`is`](`g`)) {
      _0x1716F = $(_0x1716F)[`find`](`text`);
    }
    var argBBB = $(_0x1716F)[`attr`](`x`);
    _0x17AED[`x`] = argBBB;
    _0x17AED[`istart`] = $(ddd)[`attr`](`istart`);
    return _0x17AED;
  } else {
    console[`log`](`未找到附近的`, argBBB, argCCC);
    var _0x16C29 = getMouseNode(
      $(argAAA)[`attr`](`index`),
      argBBB * scale,
      argCCC * scale
    );
    if (_0x16C29 == null) {
      return;
    }
    console[`log`](`当前所在的小节序号：`, _0x16C29);
    var _0x15D92 = getNodesInfo($(`#source`)[`val`]());
    var _0x1819B = getNodeContent(
      _0x15D92,
      _0x16C29[`node_index`],
      _0x16C29[`v`]
    );
    _0x1819B = _0x1819B[`replace`](/[.[^]]*]/, ``)
    [`replace`](/[,'$|]/g, ``)
    [`replace`](/d/g, ``)
    [`replace`](/s/g, ``);
    console[`log`](`小节内容：`, _0x1819B);
    if (_0x1819B == `z`) {
      var _0x17AED = new Object();
      var argBBB = _0x16C29[`nodeline_start`][0] / scale;
      if (argBBB == 0) {
        var _0x1808D = $(argAAA)[`find`](`text[type='bclef'],text[type='tclef']`)[0];
        if (_0x1808D) {
          argBBB += parseFloat($(_0x1808D)[`attr`](`x`)) + 40;
        } else {
          argBBB += 60;
        }
      } else {
        argBBB += 20;
      }
      _0x17AED[`x`] = argBBB;
      var _0x181C8 = _0x16C29[`node_index`];
      if (has_weak_node) {
        _0x181C8--;
      }
      _0x17AED[`istart`] = getRestIstart(_0x181C8, _0x16C29[`v`]);
      console[`log`](`obj.istart:`, _0x17AED[`istart`]);
      return _0x17AED;
    }
  }
}
function getMouseNode(_0x19D8E, _0x16008, _0x16035) {
  console[`log`](`---`, _0x16008, _0x16035);
  var _0x19D07 = getStaffNodeCoor(scale, false, 0);
  var _0x19875 = new Array();
  for (var _0x15CDE = 0; _0x15CDE < _0x19D07['length']; _0x15CDE++) {
    var _0x19CDA = _0x19D07[_0x15CDE];
    var _0x19E15 = _0x19CDA[`nodeline_start`][0];
    var _0x19D34 = _0x19CDA[`nodeline_end`][0];
    var _0x19E42 = _0x19CDA[`nodeline_start`][1];
    var _0x19D61 = _0x19CDA[`nodeline_start`][3];
    if (
      _0x16008 >= _0x19E15 &&
      _0x16008 < _0x19D34 &&
      _0x19D8E == _0x19CDA[`line`]
    ) {
      _0x19875[`push`](_0x19CDA);
    }
  }
  if (_0x19875['length'] == 1) {
    return _0x19875[0];
  } else {
    if (_0x19875['length'] > 1) {
      for (var _0x15CDE = 0; _0x15CDE < _0x19875['length']; _0x15CDE++) {
        var _0x19CDA = _0x19875[_0x15CDE];
        var _0x1619D = _0x19CDA[`nodeline_start`][1];
        var _0x160E9 = _0x19CDA[`nodeline_start`][3];
        if (_0x15CDE + 1 < _0x19875['length']) {
          var _0x19DE8 = _0x19875[_0x15CDE + 1][`nodeline_start`][1];
          var _0x19DBB = _0x19875[_0x15CDE + 1][`nodeline_start`][3];
          _0x160E9 = _0x160E9 + (_0x19DE8 - _0x160E9) / 2;
        } else {
          return _0x19875[_0x15CDE];
        }
        if (_0x16035 < _0x160E9) {
          return _0x19875[_0x15CDE];
        }
      }
    }
  }
  return null;
}
function getNodeContent(_0x15D92, _0x181C8, _0x185A6) {
  for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
    var _0x1635F = _0x15D92[_0x15CDE];
    if (_0x1635F[`type`] == `note`) {
      var _0x1A112 = _0x1635F[`nodes`];
      for (var _0x15D0B = 0; _0x15D0B < _0x1A112['length']; _0x15D0B++) {
        var _0x16C29 = _0x1A112[_0x15D0B];
        if (
          _0x16C29[`nodeIndex`] == _0x181C8 &&
          _0x16C29[`v`] == _0x185A6
        ) {
          return _0x16C29[`nodeStr`];
        }
      }
    }
  }
  return ``;
}
function getRestIstart(_0x181C8, _0x185A6) {
  console[`log`](`nodeIndex:`, _0x181C8, _0x185A6);
  for (var _0x15CDE = 0; _0x15CDE < syms['length']; _0x15CDE++) {
    var _0x16170 = syms[_0x15CDE];
    if (_0x16170 && _0x16170[`type`] == 10) {
      if (
        _0x16170[`my_wmeasure`] == _0x16170[`dur`] &&
        _0x16170[`my_bar_num`] == _0x181C8 &&
        _0x16170[`v`] == _0x185A6
      ) {
        return _0x16170[`istart`];
      }
    }
  }
  return -1;
}
var lastStaffY = -1;
function getYinfo(_0x1792B, _0x16035) {
  var _0x168D2 = /translate((.[^(]*))/;
  var _0x1A301 = 9999;
  var _0x1A3E2 = null;
  var _0x1A32E = null;
  var _0x17AED = new Object();
  $(_0x1792B)
  [`find`](`g[type='staff']`)
  [`each`](function (_0x1646D) {
    var _0x17A39 = $(this)[`attr`](`transform`);
    var _0x16AEE = _0x168D2[`exec`](_0x17A39)[1];
    var _0x1A3B5 = _0x16AEE[`replace`](`s`, ``)[
      `split`
    ](`,`)[1];
    _0x1A3B5 = parseFloat(_0x1A3B5);
    var _0x1A35B = Math[`abs`](_0x1A3B5 - _0x16035);
    var _0x1A388 = Math[`abs`](_0x1A3B5 - 24 - _0x16035);
    var _0x182A9 = _0x1A35B;
    if (_0x1A388 < _0x1A35B) {
      _0x182A9 = _0x1A388;
    }
    if (_0x182A9 < _0x1A301) {
      _0x1A301 = _0x182A9;
      _0x1A3E2 = $(this);
      _0x1A32E = _0x1A3B5;
    }
  });
  _0x17AED[`staffY`] = _0x1A32E;
  var _0x1A40F = _0x1A32E - _0x16035;
  _0x17AED[`mouse_pos`] = parseInt(_0x1A40F / 3);
  _0x17AED[`y`] = _0x1A32E - parseInt(_0x1A40F / 3) * 3;
  if (_0x1A40F > 0) {
    if (_0x1A40F >= 24) {
      _0x17AED[`num`] = parseInt((_0x1A40F - 24) / 6);
    } else {
      _0x17AED[`num`] = 0;
    }
  } else {
    _0x17AED[`num`] = parseInt(_0x1A40F / 6);
  }
  if (cen == null) {
    console[`log`](`cen is null`);
    return null;
  }
  if ($(_0x1A3E2)[`attr`](`st`) != cen[`st`]) {
    return null;
  }
  return _0x17AED;
}
function getStaffBotLineY(_0x1792B, _0x16035) {
  var _0x168D2 = /translate((.[^(]*))/;
  var _0x1A32E = null;
  var _0x1A301 = 9999;
  $(_0x1792B)
  [`find`](`g[type='staff']`)
  [`each`](function (_0x1646D) {
    var _0x17A39 = $(this)[`attr`](`transform`);
    var _0x16AEE = _0x168D2[`exec`](_0x17A39)[1];
    var _0x1A3B5 = _0x16AEE[`replace`](`s`, ``)[
      `split`
    ](`,`)[1];
    _0x1A3B5 = parseFloat(_0x1A3B5);
    var _0x1A35B = Math[`abs`](_0x1A3B5 - _0x16035);
    var _0x1A388 = Math[`abs`](_0x1A3B5 - 24 - _0x16035);
    var _0x182A9 = _0x1A35B;
    if (_0x1A388 < _0x1A35B) {
      _0x182A9 = _0x1A388;
    }
    if (_0x182A9 < _0x1A301) {
      _0x1A301 = _0x182A9;
      _0x1A32E = _0x1A3B5;
    }
  });
  return _0x1A32E;
}
function genClickNote(_0x16062, _0x18BCD) {
  if (cen == null) {
    return;
  }
  hasAddBlank = false;
  var _0x18C81 = getNewNote(cen);
  var _0x18AEC = _0x18C81[`note`];
  if (_0x18BCD) {
    _0x18AEC = _0x18BCD;
  }
  if (rest_status == `selected`) {
    _0x18AEC = `z`;
  }
  if (chordNote != ``) {
    _0x18AEC = chordNote;
  }
  var _0x18C54 = genNoteAndDur(_0x18AEC, cen);
  if (!_0x18C54) {
    return;
  }
  _0x18C54[`note`] = _0x18AEC;
  var _0x18BFA = _0x18C54[`noteStr`];
  editSplnum[`noteUpdate`][`line`] = 0;
  if (cen[`in_tuplet`]) {
    _0x18C54[`note_dur`] = cen[`dur_orig`];
    _0x18C54[`noteStr`] = _0x18C54[`oriNoteStr`];
    _0x18C54[`del_s`] = [];
    _0x18C54[`update_dur_s`] = null;
    replaceNote(`source`, cen[`istart`], cen[`iend`], _0x18C54);
  } else {
    if (cen[`type`] == 10) {
      if (
        graphEditor[`pianoImpro`] &&
        graphEditor[`pianoImpro`][`isEditLyric`]
      ) {
        editSplnum[`noteUpdate`][`active`] = true;
        editSplnum[`noteUpdate`][`istart`] =
          _0x18C54[`noteStr`][0] == ` `
            ? cen[`istart`] + 1
            : cen[`istart`];
      }
      replaceNote(`source`, cen[`istart`], cen[`iend`], _0x18C54);
    } else {
      if (cen[`type`] == 8) {
        var _0x18C27 = cen[`dur`];
        if (cen[`tie_s`]) {
          _0x18C27 += cen[`tie_s`][`dur`];
        }
        if (_0x18C27 == durSetting) {
          var _0x18A0B = genChordNote(cen, _0x18AEC, durSetting);
          if (rest_status == `` && chordNote == ``) {
            _0x18C54[`noteStr`] = _0x18A0B[`chordNoteStr`];
          }
          if (
            graphEditor[`pianoImpro`] &&
            graphEditor[`pianoImpro`][`isEditLyric`]
          ) {
            editSplnum[`noteUpdate`][`active`] = true;
            editSplnum[`noteUpdate`][`istart`] =
              _0x18C54[`noteStr`][0] == ` `
                ? cen[`istart`] + 1
                : cen[`istart`];
          }
          replaceNote(
            `source`,
            cen[`istart`],
            cen[`iend`],
            _0x18C54
          );
        } else {
          _0x18C54[`note_dur`] = durSetting;
          if (
            graphEditor[`pianoImpro`] &&
            graphEditor[`pianoImpro`][`isEditLyric`]
          ) {
            editSplnum[`noteUpdate`][`active`] = true;
            editSplnum[`noteUpdate`][`istart`] =
              _0x18C54[`noteStr`][0] == ` `
                ? cen[`istart`] + 1
                : cen[`istart`];
          }
          replaceNote(
            `source`,
            cen[`istart`],
            cen[`iend`],
            _0x18C54
          );
        }
      }
    }
  }
  if (rest_status == `selected`) {
    cen = null;
    return;
  }
  var _0x18CDB = new Array();
  if (_0x18AEC[`indexOf`](`[`) > -1) {
    var _0x170E8 = _0x18AEC[`match`](/[=_^]{0,1}[a-gA-G][,']{0,1}/g);
    for (var _0x15CDE = 0; _0x15CDE < _0x170E8['length']; _0x15CDE++) {
      var _0x18CAE = new Object();
      _0x18CAE[`pitch`] = findIndexByNote(_0x170E8[_0x15CDE]);
      _0x18CAE[`dur`] = durSetting;
      _0x18CAE[`time`] = 0;
      _0x18CDB[`push`](_0x18CAE);
    }
    play_notes(_0x18CDB);
    cen = null;
    return;
  }
  var _0x18CAE = new Object();
  _0x18CAE[`pitch`] = _0x18C81[`note_seq`];
  _0x18CAE[`dur`] = durSetting;
  _0x18CAE[`time`] = 0;
  _0x18CDB[`push`](_0x18CAE);
  if (_0x18AEC && _0x18AEC[`indexOf`](`z`) == -1) {
    play_notes(_0x18CDB);
  }
  cen = null;
}
function getNewNote(cen) {
  var _0x15F54 = cen[`mouse_pos`];
  var _0x170E8 = cen[`notes`];
  var _0x1A031 = 0;
  if (_0x170E8) {
    var _0x19FD7 = _0x170E8[0];
    var _0x1A004 = _0x19FD7[`opit`];
    var _0x1A05E = _0x19FD7[`pit`];
    if (_0x1A004) {
      if (_0x1A004 - _0x1A05E == 7) {
        _0x1A031 = 12;
      } else {
        if (_0x1A004 - _0x1A05E == -7) {
          _0x1A031 = -12;
        } else {
          if (_0x1A004 - _0x1A05E == 14) {
            _0x1A031 = 24;
          } else {
            if (_0x1A004 - _0x1A05E == -14) {
              _0x1A031 = -24;
            }
          }
        }
      }
    }
  }
  if (cen[`octave`]) {
    _0x1A031 -= cen[`octave`] * 12;
  }
  var _0x19F50 = cen[`clef_type`];
  var _0x17AED = new Object();
  var _0x18AEC = ``;
  var _0x19FAA = -1;
  if (_0x19F50 == `t`) {
    var _0x1A08B = [1, 2, 2, 2, 1, 2, 2];
    var _0x1A0B8 = [2, 2, 1, 2, 2, 2, 1];
    var _0x1A0E5 = 64;
    var _0x18BCD = parseInt(_0x15F54 / 7);
    var _0x185A6 = _0x15F54 % 7;
    var _0x17250 = 0;
    if (_0x15F54 >= 0) {
      _0x17250 = _0x18BCD * 12 + getArrSum(_0x1A08B, _0x185A6);
    } else {
      if (_0x15F54 < 0) {
        _0x17250 =
          _0x18BCD * 12 - getArrSum(_0x1A0B8, Math[`abs`](_0x185A6));
      }
    }
    _0x19FAA = _0x1A0E5 + _0x17250;
  } else {
    if (_0x19F50 == `b`) {
      var _0x19E9C = [2, 2, 1, 2, 2, 1, 2];
      var _0x19EC9 = [2, 1, 2, 2, 1, 2, 2];
      var _0x19EF6 = 43;
      var _0x18BCD = parseInt(_0x15F54 / 7);
      var _0x185A6 = _0x15F54 % 7;
      var _0x17250 = 0;
      if (_0x15F54 >= 0) {
        _0x17250 = _0x18BCD * 12 + getArrSum(_0x19E9C, _0x185A6);
      } else {
        if (_0x15F54 < 0) {
          _0x17250 =
            _0x18BCD * 12 - getArrSum(_0x19EC9, Math[`abs`](_0x185A6));
        }
      }
      _0x19FAA = _0x19EF6 + _0x17250;
    } else {
      if (_0x19F50 === `p`) {
        _0x19FAA = 71;
        _0x1A031 = 0;
      } else {
        if (_0x19F50 == `c`) {
          var _0x19F23 = 0;
          for (var _0x15CDE = cen[`istart`]; _0x15CDE > 0; _0x15CDE--) {
            var _0x19F7D = syms[_0x15CDE];
            if (_0x19F7D && _0x19F7D[`type`] == 1) {
              if (_0x19F7D[`clef_type`] == `c`) {
                _0x19F23 = _0x19F7D[`clef_line`];
                break;
              }
            }
          }
          if (_0x19F23 == 3) {
            var _0x1A08B = [2, 2, 2, 1, 2, 2, 1];
            var _0x1A0B8 = [1, 2, 2, 1, 2, 2, 2];
            var _0x19E6F = 53;
            var _0x18BCD = parseInt(_0x15F54 / 7);
            var _0x185A6 = _0x15F54 % 7;
            var _0x17250 = 0;
            if (_0x15F54 >= 0) {
              _0x17250 = _0x18BCD * 12 + getArrSum(_0x1A08B, _0x185A6);
            } else {
              if (_0x15F54 < 0) {
                _0x17250 =
                  _0x18BCD * 12 -
                  getArrSum(_0x1A0B8, Math[`abs`](_0x185A6));
              }
            }
            _0x19FAA = _0x19E6F + _0x17250;
          } else {
            if (_0x19F23 == 4) {
              var _0x1A08B = [2, 1, 2, 2, 2, 1, 2];
              var _0x1A0B8 = [2, 1, 2, 2, 2, 1, 2];
              var _0x19E6F = 50;
              var _0x18BCD = parseInt(_0x15F54 / 7);
              var _0x185A6 = _0x15F54 % 7;
              var _0x17250 = 0;
              if (_0x15F54 >= 0) {
                _0x17250 = _0x18BCD * 12 + getArrSum(_0x1A08B, _0x185A6);
              } else {
                if (_0x15F54 < 0) {
                  _0x17250 =
                    _0x18BCD * 12 -
                    getArrSum(_0x1A0B8, Math[`abs`](_0x185A6));
                }
              }
              _0x19FAA = _0x19E6F + _0x17250;
            }
          }
        }
      }
    }
  }
  _0x18AEC = findStandNoteByIndex(_0x19FAA + _0x1A031);
  _0x17AED[`note`] = _0x18AEC;
  _0x17AED[`note_seq`] = _0x19FAA + _0x1A031;
  return _0x17AED;
}
function genChordNote(cen, _0x18AEC) {
  var _0x18A0B = new Object();
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x16AEE = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
  var _0x18ABF = ``;
  var _0x18BA0 = cen[`p_v`][`ulen`];
  var _0x18A65 = cen[`dur`];
  if (cen[`tie_s`]) {
    var _0x18B19 = cen[`tie_s`];
    var _0x18B46 = _0x15C57[`substring`](
      _0x18B19[`istart`],
      _0x18B19[`iend`]
    );
    if (_0x18B46[`indexOf`](`[`) > -1) {
      _0x18B46 = _0x18B46[`replace`](`[`, ``)[`replace`](
        `]`,
        ``
      );
    }
    var _0x18A92 =
      _0x18B46 + _0x18AEC + getLenStr(_0x18BA0, _0x18B19[`dur`]);
    _0x18A0B[`tie_str`] = `[` + _0x18A92 + `]`;
  }
  if (_0x16AEE[`indexOf`](`[`) > -1) {
    var _0x18A38 = /\[(.[^\[]*)\]/;;
    var _0x17D09 = _0x16AEE[`match`](_0x18A38);
    if (
      _0x17D09[1] !=
      _0x16AEE[`replace`](`[`, ``)[`replace`](
        `]`,
        ``
      )
    ) {
      _0x18ABF =
        `[` +
        _0x17D09[1] +
        _0x18AEC +
        `]` +
        getLenStr(_0x18BA0, _0x18A65);
    } else {
      _0x18ABF =
        `[` +
        _0x16AEE[`replace`](`[`, ``)[`replace`](
          `]`,
          ``
        ) +
        _0x18AEC +
        getLenStr(_0x18BA0, _0x18A65) +
        `]`;
    }
  } else {
    var _0x18B73 = ``;
    if (cen[`tie_s`]) {
      _0x18B73 = `-`;
    }
    _0x18ABF =
      `[` +
      _0x16AEE +
      _0x18AEC +
      getLenStr(_0x18BA0, _0x18A65) +
      _0x18B73 +
      `]`;
  }
  _0x18A0B[`chordNoteStr`] = _0x18ABF;
  return _0x18A0B;
}
function genNoteAndDur(_0x18AEC, cen, _0x1916D, _0x19140, _0x190B9) {
  if (!cen || !cen[`p_v`]) {
    return;
  }
  durSetting = durSetting - 0;
  var _0x17AED = new Object();
  var _0x18F7E = 384;
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x18FAB = beatSum(cen);
  var _0x18FD8 = ``;
  var _0x17115 = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
  if (_0x18FAB != 0 && parseInt(_0x18FAB) == _0x18FAB) {
    if (_0x15C57[`substr`](cen[`istart`] - 1, 1) != ` `) {
      _0x18FD8 = ` `;
      hasAddBlank = true;
    }
  }
  var _0x18C27 = cen[`dur`];
  if (user[`pasteNote`]) {
    _0x18C27 = cen[`dur`];
  }
  var _0x19005 = new Array();
  var _0x191C7 = null;
  var _0x18BA0 = cen[`p_v`][`ulen`];
  _0x17AED[`ulen`] = _0x18BA0;
  _0x17AED[`note_dur`] = durSetting;
  var _0x1905F = durSetting;
  if (user[`pasteNote`]) {
    if (user[`copyNoteInfo`][`dur`]) {
      durSetting = user[`copyNoteInfo`][`dur`];
    } else {
      durSetting = user[`copyNoteInfo`][`s`][`dur`];
    }
    _0x17AED[`note_dur`] = durSetting;
  }
  if (
    !_0x1916D &&
    graph_update &&
    midiInStatus == false &&
    !user[`pasteNote`] &&
    !_0x190B9
  ) {
    _0x18FD8 = ``;
    _0x17AED[`noteStr`] = _0x17115[`replace`](/[a-gA-G_^=,']*/, _0x18AEC);
    _0x17AED[`del_s`] = _0x19005;
    _0x17AED[`update_dur_s`] = _0x191C7;
    return _0x17AED;
  }
  var _0x1908C = parseInt(durSetting) + 0;
  var _0x1919A = /([/0-9]+)/g;
  if (_0x1916D) {
    durSetting = _0x19140;
    fixedLen = true;
  }
  if (cen[`grace`]) {
    var _0x17115 =
      _0x18AEC + (!fixedLen ? getLenStr(_0x18BA0, durSetting) : ``);
    if (user[`pasteNote`]) {
      _0x17115 = _0x18AEC;
    }
    _0x17AED[`oriNoteStr`] = _0x17115;
    _0x17AED[`noteStr`] = _0x17115;
  } else {
    if (cen[`in_tuplet`]) {
      var _0x17115 =
        _0x18AEC +
        (!fixedLen ? getLenStr(_0x18BA0, cen[`dur_orig`]) : ``);
      if (user[`pasteNote`]) {
        _0x17115 = _0x18AEC;
      }
      _0x17AED[`oriNoteStr`] = _0x17115;
      _0x17AED[`noteStr`] = _0x17115;
    } else {
      if (_0x18C27 == durSetting) {
        var _0x17115 =
          _0x18AEC + (!fixedLen ? getLenStr(_0x18BA0, durSetting) : ``);
        if (user[`pasteNote`]) {
          _0x17115 = _0x18AEC;
        } else {
          if (cen[`notes`]['length'] > 0) {
            if (
              $(`.selected_text`)['length'] > 0 &&
              cen[`notes`]['length'] > 1
            ) {
              var _0x191F4 = parseInt(
                $(`.selected_text`)[`attr`](`update_index`)
              );
              if (isNaN(_0x191F4)) {
              } else {
                var _0x190E6 = _0x15C57[`substring`](
                  cen[`istart`],
                  cen[`iend`]
                );
                var _0x1708E = str2notes(
                  _0x190E6[`replace`](/[[]]/g, ``)
                );
                console[`log`](`当前修改的音符是：`, _0x1708E[_0x191F4]);
                var _0x19221 = _0x1708E[_0x191F4][`note`];
                _0x17115 = _0x190E6[`replace`](_0x19221, _0x17115);
              }
            }
          }
        }
        _0x17AED[`oriNoteStr`] = _0x17115;
        _0x17AED[`noteStr`] = _0x18FD8 + _0x17115;
      } else {
        if (_0x18C27 < durSetting) {
          var _0x19032 = durSetting - _0x18C27;
          var _0x17007 = cen[`next`];
          while (_0x17007) {
            if (_0x17007[`type`] != 8 && _0x17007[`type`] != 10) {
              if (_0x17007[`type`] == 0) {
                _0x17AED[`del_nodeline`] = 1;
                _0x17AED[`dur_nodeline_behind`] = _0x19032;
              }
              _0x19005[`push`](abc[`clone`](_0x17007, 2));
              _0x17007 = _0x17007[`next`];
              if (_0x17007 == null) {
                for (
                  var _0x15CDE = cen[`istart`] + 1,
                  _0x1881C = syms['length'];
                  _0x15CDE < _0x1881C;
                  _0x15CDE++
                ) {
                  var _0x18BCD = syms[_0x15CDE];
                  if (_0x18BCD) {
                    if (
                      _0x18BCD[`v`] == cen[`v`] &&
                      (_0x18BCD[`type`] == 8 ||
                        _0x18BCD[`type`] == 10)
                    ) {
                      _0x17007 = _0x18BCD;
                      break;
                    }
                  }
                }
              }
              continue;
            }
            if (
              (_0x17007[`type`] == 8 || _0x17007[`type`] == 10) &&
              _0x17007[`dur`] <= _0x19032
            ) {
              _0x19032 = _0x19032 - _0x17007[`dur`];
              if (_0x19032 <= 0) {
                if (_0x19032 == 0) {
                  _0x19005[`push`](abc[`clone`](_0x17007, 2));
                } else {
                  if (_0x19032 < 0) {
                    _0x191C7 = _0x17007;
                    _0x191C7[`dur`] = _0x17007[`dur`] - _0x19032;
                    _0x191C7[`dur_orig`] = _0x191C7[`dur`];
                    _0x191C7[`notes`][`forEach`](function (
                      _0x1646D,
                      _0x15CDE
                    ) {
                      _0x191C7[`notes`][_0x15CDE][`dur`] =
                        _0x191C7[`dur`];
                    });
                    var _0x1924E = _0x15C57[`substring`](
                      _0x191C7[`istart`],
                      _0x191C7[`iend`]
                    );
                    _0x1924E = _0x1924E[`replace`](_0x1919A, ``);
                    _0x191C7[`restStr`] =
                      _0x1924E +
                      getDurStrByNoteDur(_0x191C7[`dur`], _0x18BA0);
                  }
                }
                break;
              }
              _0x19005[`push`](abc[`clone`](_0x17007, 2));
              _0x17007 = _0x17007[`next`];
            } else {
              _0x191C7 = _0x17007;
              _0x191C7[`dur`] = _0x17007[`dur`] - _0x19032;
              _0x191C7[`dur_orig`] = _0x191C7[`dur`];
              _0x191C7[`notes`][`forEach`](function (
                _0x1646D,
                _0x15CDE
              ) {
                _0x191C7[`notes`][_0x15CDE][`dur`] =
                  _0x191C7[`dur`];
              });
              var _0x1924E = _0x15C57[`substring`](
                _0x191C7[`istart`],
                _0x191C7[`iend`]
              );
              _0x1924E = _0x1924E[`replace`](_0x1919A, ``);
              _0x191C7[`restStr`] =
                _0x1924E + getDurStrByNoteDur(_0x191C7[`dur`], _0x18BA0);
              break;
            }
          }
          var _0x17115 =
            _0x18AEC +
            (!fixedLen ? getLenStr(_0x18BA0, durSetting) : ``);
          if (user[`pasteNote`]) {
            _0x17115 = _0x18AEC;
          }
          _0x17AED[`oriNoteStr`] = _0x17115;
          _0x17AED[`noteStr`] = _0x18FD8 + _0x17115;
        } else {
          var _0x19032 = _0x18C27 - durSetting;
          var _0x19113 = ``;
          if (_0x19032 >= durSetting) {
            if (dot_selected_value != ``) {
              _0x19113 +=
                `z,` +
                getLenStr(_0x18BA0, durSettingNotDot * 2 - durSetting);
              _0x19032 = _0x19032 - (durSettingNotDot * 2 - durSetting);
              for (var _0x15CDE = 2; _0x15CDE < 20; _0x15CDE = _0x15CDE * 2) {
                if (_0x19032 > 0) {
                  if (_0x19032 - durSettingNotDot * _0x15CDE > 0) {
                    _0x19113 +=
                      `z,` +
                      getLenStr(_0x18BA0, durSettingNotDot * _0x15CDE);
                  } else {
                    _0x19113 += `z,` + getLenStr(_0x18BA0, _0x19032);
                    _0x19032 = 0;
                    break;
                  }
                  _0x19032 = _0x19032 - durSettingNotDot * _0x15CDE;
                } else {
                  break;
                }
              }
            } else {
              _0x19113 += `z,` + getLenStr(_0x18BA0, durSetting);
              _0x19032 = _0x19032 - durSetting;
              for (var _0x15CDE = 2; _0x15CDE < 20; _0x15CDE = _0x15CDE * 2) {
                if (_0x19032 > 0) {
                  if (_0x19032 - durSetting * _0x15CDE > 0) {
                    _0x19113 +=
                      `z,` + getLenStr(_0x18BA0, durSetting * _0x15CDE);
                  } else {
                    _0x19113 += `z,` + getLenStr(_0x18BA0, _0x19032);
                    _0x19032 = 0;
                    break;
                  }
                  _0x19032 = _0x19032 - durSetting * _0x15CDE;
                } else {
                  break;
                }
              }
            }
          } else {
            _0x19113 += `z,` + getLenStr(_0x18BA0, _0x19032);
          }
          var _0x17115 =
            _0x18AEC +
            (!fixedLen ? getLenStr(_0x18BA0, durSetting) : ``);
          if (user[`pasteNote`]) {
            _0x17115 = _0x18AEC;
          }
          _0x17AED[`oriNoteStr`] = _0x17115;
          _0x17AED[`noteStr`] = _0x18FD8 + _0x17115 + _0x19113;
        }
      }
    }
  }
  if (_0x1916D) {
    fixedLen = false;
  }
  durSetting = _0x1908C;
  _0x17AED[`del_s`] = _0x19005;
  _0x17AED[`update_dur_s`] = _0x191C7;
  if (user[`pasteNote`]) {
    durSetting = _0x1905F;
  }
  return _0x17AED;
}
function genRestStrByDur(_0x18BA0, _0x18C27, _0x1970D) {
  return `z,` + getDurStrByNoteDur(_0x18C27, _0x18BA0);
  if (1 == 1) {
    return;
  }
  var _0x196B3 = _0x1970D;
  var _0x19032 = _0x18C27 - _0x196B3;
  var _0x19113 = ``;
  if (_0x19032 >= _0x196B3) {
    var _0x196E0 = getLenStr(_0x18BA0, _0x196B3);
    _0x19113 += `z` + _0x196E0;
    var _0x16332 = 0;
    for (var _0x15CDE = 2; _0x15CDE < 20; _0x15CDE = _0x15CDE * 2) {
      if (_0x19032 > 0) {
        _0x19113 += `z` + getLenStr(_0x18BA0, _0x196B3 * _0x15CDE);
        _0x19032 = _0x19032 - _0x196B3 * _0x15CDE * 2;
      }
    }
  } else {
    if (_0x19032 == 0) {
      _0x19032 = _0x18C27;
    }
    _0x19113 += `z` + getLenStr(_0x18BA0, _0x19032);
  }
  return _0x19113;
}
function beatSum(cen) {
  var _0x16143 = 0;
  for (var _0x15CDE = cen[`istart`] - 1; _0x15CDE > 0; _0x15CDE--) {
    if (syms[_0x15CDE] && syms[_0x15CDE][`type`] == 0) {
      break;
    }
    if (!syms[_0x15CDE]) {
      continue;
    }
    if (syms[_0x15CDE][`type`] == 8 || syms[_0x15CDE][`type`] == 10) {
      var _0x16170 = syms[_0x15CDE];
      if (_0x16170[`in_tuplet`]) {
        _0x16143 += _0x16170[`dur`];
      } else {
        _0x16143 += _0x16170[`dur_orig`];
      }
    }
  }
  var _0x16116 = cen[`my_meter`];
  if (_0x16116 != null && _0x16116['length'] > 0) {
    var _0x1619D = _0x16116[0][`top`];
    var _0x160E9 = _0x16116[0][`bot`];
    if (_0x1619D % 3 == 0 && _0x160E9 == 8) {
      return _0x16143 / 576;
    }
  }
  return _0x16143 / 384;
}
function getLastMeter(_0x15EFA) {
  var _0x17AED = new Object();
  _0x17AED[`wmeasure`] = 768;
  _0x17AED[`beat`] = 2;
  _0x17AED[`perBeat`] = 384;
  for (var _0x15CDE = _0x15EFA; _0x15CDE > 0; _0x15CDE--) {
    if (!syms[_0x15CDE]) {
      continue;
    }
    if (syms[_0x15CDE][`type`] == 6) {
      _0x17AED[`wmeasure`] = syms[_0x15CDE][`wmeasure`];
      _0x17AED[`beat`] = syms[_0x15CDE][`a_meter`][0][`top`];
    }
  }
  return _0x17AED;
}
function getLenStr(_0x18BA0, _0x1881C) {
  if (_0x1881C == 0) {
    return ``;
  }
  return getDurStrByNoteDur(_0x1881C, _0x18BA0);
}
function replaceNote(_0x1B279, _0x15EFA, _0x16F26, _0x18C54) {
  if (update_note_istart < _0x15EFA || update_note_istart > _0x16F26) {
    update_note_istart = -1;
  }
  var _0x17115 = _0x18C54[`noteStr`];
  var _0x15C57 = $(`#` + _0x1B279)[`val`]();
  var _0x19005 = _0x18C54[`del_s`];
  var _0x1B2A6 = _0x18C54[`update_dur_s`];
  var _0x1B1F2 = ``;
  var _0x1B2D3 = ``;
  if (_0x19005['length'] > 0) {
    for (var _0x15CDE = _0x19005['length'] - 1; _0x15CDE >= 0; _0x15CDE--) {
      var _0x16170 = _0x19005[_0x15CDE];
      if (_0x16170[`type`] == 8) {
        if (
          graphEditor[`pianoImpro`] &&
          typeof graphEditor[`pianoImpro`][`noteUpdate`] == `function`
        ) {
          _0x15C57 = graphEditor[`pianoImpro`][`noteUpdate`](
            _0x16170[`istart`],
            ``
          );
        }
      }
    }
    _0x19005[`forEach`](function (_0x16170) {
      if (_0x16170[`type`] == 0) {
        _0x1B1F2 = _0x15C57[`substring`](
          _0x16170[`istart`],
          _0x16170[`iend`]
        );
        if (_0x15C57[`substr`](_0x16170[`iend`], 1) == `$`) {
          _0x1B1F2 += `$`;
        }
      }
      _0x16F26 = _0x16170[`iend`];
    });
  }
  if (_0x1B2A6 != null) {
    _0x16F26 = _0x1B2A6[`iend`];
  }
  if (_0x1B1F2 != `` && _0x18C54[`dur_nodeline_behind`]) {
    var _0x1A13F = syms[_0x15EFA][`my_wmeasure`];
    _0x17115 = getNoteStr_(_0x1A13F, _0x18C54);
    _0x1B2D3 =
      _0x18C54[`note`] +
      getLenStr(_0x18C54[`ulen`], _0x18C54[`dur_nodeline_behind`]);
    if (_0x1B2A6 != null) {
      _0x1B2D3 += _0x1B2A6[`restStr`];
    }
  } else {
    if (_0x1B2A6 != null) {
      _0x1B2D3 += _0x1B2A6[`restStr`];
    }
  }
  _0x15C57 =
    _0x15C57[`substr`](0, _0x15EFA) +
    _0x17115 +
    _0x1B1F2 +
    _0x1B2D3 +
    _0x15C57[`substr`](_0x16F26);
  _0x15C57 = replaceBlankLine(_0x15C57);
  $(`#` + _0x1B279)[`val`](_0x15C57);
  doLog();
  if (musicType == 2) {
    hasTempo = false;
    render();
  } else {
    render();
  }
  if (
    chordNote != `` &&
    (!graphEditor[`pianoImpro`] || !graphEditor[`pianoImpro`][`isOpen`])
  ) {
    setTimeout(function () {
      if (hasAddBlank) {
        _0x15EFA = parseInt(_0x15EFA) + 1;
      }
      var _0x16170 = syms[_0x15EFA];
      updateLyrics(_0x16170, [chordNoteLyric]);
    }, 100);
  }
  if (user[`midiInput`]) {
    var _0x1B21F = $(`svg .` + _0x15EFA);
    if (_0x1B21F['length'] > 0) {
      _0x1B21F[0][`scrollIntoView`]();
    }
  }
  if ($(`#micInput`)[`hasClass`](`menu-pressed`)) {
    var _0x1B24C = syms[_0x15EFA];
    if (_0x1B24C) {
      console[`log`](`micInput:`, _0x15EFA);
      var _0x1B21F = $(`svg .` + _0x1B24C[`istart`] + `[x]`);
      if (_0x1B21F['length'] > 0) {
        var _0x16008 =
          parseInt($($(_0x1B21F)[0])[`attr`](`x`)) * scale;
        var _0x1770F = $(`.right-top-content`)[`width`]();
        if (_0x16008 > _0x1770F / 2) {
          $(`.right-top-content`)
          [`stop`]()
          [`animate`](
            { scrollLeft: _0x16008 - _0x1770F / 2 + `px` },
            1000
          );
        }
      }
    }
  }
  if (
    _0x1B2A6 != null &&
    graphEditor[`pianoImpro`] &&
    typeof graphEditor[`pianoImpro`][`noteUpdate`] == `function`
  ) {
    if (!syms[_0x15EFA]) {
      return;
    }
    var _0x17007 = syms[_0x15EFA][`next`];
    var _0x15C84 = 20;
    while (_0x17007 && _0x15C84 > 0) {
      if (_0x17007[`type`] == 10) {
        graphEditor[`pianoImpro`][`noteUpdate`](_0x17007[`istart`]);
      } else {
        if (_0x17007[`type`] == 0) {
          _0x17007 = null;
          _0x15C84 = 0;
          break;
        }
      }
      _0x17007 = _0x17007[`next`];
      _0x15C84--;
    }
  }
}
function getNoteStr_(_0x1A13F, _0x18C54) {
  var _0x18A65 = _0x18C54[`note_dur`] - _0x18C54[`dur_nodeline_behind`];
  var _0x19875 = new Array();
  while (_0x18A65 > _0x1A13F) {
    var _0x16AEE =
      _0x18C54[`note`] +
      getLenStr(_0x18C54[`ulen`], _0x1A13F) +
      `- `;
    _0x19875[`push`](_0x16AEE);
    _0x18A65 = _0x18A65 - _0x1A13F;
  }
  if (_0x18A65 > 0) {
    var _0x16AEE =
      _0x18C54[`note`] +
      getLenStr(_0x18C54[`ulen`], _0x18A65) +
      `- `;
    _0x19875[`push`](_0x16AEE);
  }
  var _0x1892A = ``;
  if (_0x19875['length'] > 0) {
    for (var _0x15CDE = _0x19875['length']; _0x15CDE > 0; _0x15CDE--) {
      if (_0x15CDE > 1) {
        _0x1892A += _0x19875[_0x15CDE - 1] + `|`;
      } else {
        _0x1892A += _0x19875[_0x15CDE - 1];
      }
    }
  }
  return _0x1892A;
}
function getArrSum(_0x19875, _0x18D35) {
  var _0x198A2 = 0;
  for (var _0x15CDE = 0; _0x15CDE < _0x18D35; _0x15CDE++) {
    _0x198A2 += _0x19875[_0x15CDE];
  }
  return _0x198A2;
}
function play_note(_0x1B13E, _0x18A65) {
  var _0x18CDB = new Array();
  var _0x18CAE = new Object();
  _0x18CAE[`pitch`] = _0x1B13E;
  _0x18CAE[`dur`] = _0x18A65;
  _0x18CAE[`time`] = 0;
  _0x18CDB[`push`](_0x18CAE);
  if (_0x1B13E != -1) {
    play_notes(_0x18CDB);
  }
}
function play_notes(_0x170E8) {
  if (!graphEditor[`isPlayNote`]) {
    return;
  }
  var _0x1B198 = 768;
  for (var _0x15CDE = 0; _0x15CDE < syms['length']; _0x15CDE++) {
    if (syms[_0x15CDE]) {
      var _0x16170 = syms[_0x15CDE];
      if (_0x16170[`tempo`]) {
        var _0x17BA1 = 0;
        var _0x18BCD = _0x16170[`tempo_notes`]['length'];
        for (j = 0; j < _0x18BCD; j++) {
          _0x17BA1 += _0x16170[`tempo_notes`][j];
        }
        _0x1B198 = (_0x17BA1 * _0x16170[`tempo`]) / 60;
        break;
      }
    }
  }
  var _0x1B16B = new Array();
  var _0x1B1C5 = 0;
  for (var _0x15CDE = 0; _0x15CDE < _0x170E8['length']; _0x15CDE++) {
    var _0x18AEC = new Float32Array(7);
    _0x18AEC[0] = -1;
    _0x18AEC[1] = _0x170E8[_0x15CDE][`time`];
    _0x18AEC[2] = 0;
    _0x18AEC[3] = _0x170E8[_0x15CDE][`pitch`];
    _0x18AEC[4] = parseInt(_0x170E8[_0x15CDE][`dur`]) / _0x1B198;
    _0x18AEC[5] = 1;
    _0x18AEC[6] = 0;
    _0x1B16B[`push`](_0x18AEC);
  }
  if (typeof doPlayNotes == `function`) {
    doPlayNotes(_0x1B16B);
  } else {
    play[`abcplay`][`play`](0, _0x1B16B['length'], _0x1B16B);
  }
}
var delObj = null;
var svgArr = new Array();
var clickTimeMill = -1;
function graphMouseDownHandle(_0x1A4C3) {
  if ($(`rect[type='startpoint']`)['length']) {
    src_change();
    return;
  }
  $(`rect[type!='bg_rect']`)[`css`](`fill-opacity`, `0`);
  $(`rect[type='splplaceholder']`)[`css`](`fill-opacity`, ``);
  $(`rect[recttype='movedragger']`)[`remove`]();
  var _0x167F1 = document[`getElementById`](`source`);
  if (window[`getSelection`]) {
    if (
      _0x167F1[`selectionStart`] != undefined &&
      _0x167F1[`selectionEnd`] != undefined
    ) {
      if (_0x167F1[`selectionStart`] != _0x167F1[`selectionEnd`]) {
        _0x167F1[`blur`]();
        _0x167F1[`focus`]();
        _0x167F1[`selectionStart`] = 0;
        _0x167F1[`selectionEnd`] = 0;
      }
    }
  }
  clickTimeMill = new Date()[`getTime`]();
  if (_0x1A4C3[`path`]) {
    var _0x1A577 = $(_0x1A4C3[`path`][0])[`attr`](`type`);
    if (_0x1A577 == `brace` || _0x1A577 == `bracket`) {
      $(`.selected_text`)[`removeClass`](`selected_text`);
      $(`rect[dragtype="linkclef"]`)[`remove`]();
      return;
    }
  }
  $(`#ctxMenu`)[`hide`]();
  $(`[cat="decos"]`)[`removeAttr`](`selected`);
  $(`[cat="decos"]`)[`removeClass`](`selected_path`);
  $(`text[type="zs"]`)[`removeAttr`](`selected`);
  $(`text[type="zs"]`)[`css`](`color`, ``);
  $(`rect[type="bar"][selected="selected"]`)
  [`css`](`fill-opacity`, `0`)
  [`removeAttr`](`selected`);
  console[`log`](`dragDecoFlag:`, dragDecoFlag);
  if (!dragDecoFlag) {
    $(`rect[dragtype]`)[`remove`]();
  }
  $(`[cat='decos']`)
  [`css`](`color`, ``)
  [`removeAttr`](`fill`);
  $(`text[type='hd'],text[type='HD']`)[`css`](`color`, ``);
  $(`g[style]`)[`css`](`color`, ``);
  $(`.editor-div`)[`blur`]();
  if (!_0x1A4C3[`ctrlKey`] && _0x1A4C3[`button`] != 2) {
    $(`.selected_text`)[`removeClass`](`selected_text`);
    $(`.select_text_g`)[`removeClass`](`select_text_g`);
    $(`text[type="lyric"]`)[`removeAttr`](`selected`);
    $(`text[type="lyric"]`)[`each`](function (_0x15CDE, _0x1646D) {
      var _0x1A5D1 = $(_0x1646D)[`attr`](`style`);
      if (_0x1A5D1[`indexOf`](`color: rgb(`) < 0) {
        $(_0x1646D)[`css`](`color`, ``);
      }
    });
  }
  selectDecoInfo = null;
  selectGchInfo = null;
  console[`log`](`graphMouseDownHandle`);
  if (_0x1A4C3[`button`] == 2) {
    return;
  }
  if ($(`g[type='gcolor']`)['length'] > 0) {
    $(`g[type='gcolor']`)[`removeAttr`](`style`);
  }
  $(`svg[type='rectnode']`)[`remove`]();
  $(`#nodeMenu`)[`hide`]();
  var _0x1A496 = _0x1A4C3[`target`],
    _0x1A43C = _0x1A496[`getAttribute`](`class`);
  var _0x17688 = _0x1A4C3[`target`];
  if (_0x17688 == null) {
    return;
  }
  if (_0x17688[`tagName`][`toLowerCase`]() != `svg`) {
    var _0x17AC0 = $(_0x17688)[`parents`](`svg`);
    _0x17688 = _0x17AC0[_0x17AC0['length'] - 1];
  } else {
    _0x17688 = $(_0x17688);
    if (_0x17688['length'] > 1) {
      return;
    }
  }
  if (_0x1A4C3[`touches`]) {
    _0x1A4C3[`offsetX`] =
      _0x1A4C3[`touches`][0][`pageX`] -
      $(_0x17688)[`offset`]()[`left`];
    _0x1A4C3[`offsetY`] =
      _0x1A4C3[`touches`][0][`pageY`] -
      $(_0x17688)[`offset`]()[`top`];
  }
  findNearNote(
    _0x1A4C3,
    _0x17688,
    _0x1A4C3[`offsetX`] / scale,
    _0x1A4C3[`offsetY`] / scale
  );
  if (select_note_info == null) {
    return;
  }
  cen = syms[$(select_note_info[`click_obj`])[`attr`](`istart`)];
  svgArr = $(`#target`)[`find`](`svg`);
  editSvgLineIndex = $(_0x17688)[`attr`](`id`);
  if (
    select_note_info[`click_obj`] == null ||
    $(select_note_info[`click_obj`])[`attr`](`cat`) == `decos`
  ) {
    if ($(select_note_info[`click_obj`])['length'] > 0) {
      selectDecoInfo = select_note_info[`click_obj`];
      _0x1A4F0 = true;
    } else {
      var _0x1A4F0 = findNearDeco(
        _0x1A4C3,
        _0x17688,
        _0x1A4C3[`offsetX`] / scale,
        _0x1A4C3[`offsetY`] / scale
      );
      if (dragDecoFlag) {
        return;
      }
    }
    if (_0x1A4F0) {
      showProperties(`deco`, _0x1A4C3);
      var _0x1649A = $(selectDecoInfo)[0][`getBBox`]();
      var _0x15EFA = $(selectDecoInfo)[`attr`](`start`);
      if (!_0x15EFA) {
        _0x15EFA = $(selectDecoInfo)[`attr`](`istart`);
      }
      $(
        `rect[type='` +
        $(selectDecoInfo)[`attr`](`type`) +
        `'][istart='` +
        _0x15EFA +
        `']`
      )[`remove`]();
      var _0x17769 = 0,
        _0x1773C = 0;
      if ($(selectDecoInfo)[`attr`](`type`) == `stc`) {
        _0x17769 = 5;
        _0x1773C = 5;
      }
      var _0x1A469 = drawDecoRect(
        _0x1649A[`x`],
        _0x1649A[`y`],
        _0x1649A[`width`] + _0x17769,
        _0x1649A[`height`] + _0x1773C,
        _0x15EFA,
        $(selectDecoInfo)[`attr`](`type`)
      );
      $(selectDecoInfo)[`parent`]()[`append`](_0x1A469);
      return;
    }
    var _0x1A51D = findNearObjByType(
      _0x1A4C3,
      _0x17688,
      _0x1A4C3[`offsetX`] / scale,
      _0x1A4C3[`offsetY`] / scale,
      `zs`
    );
    if (_0x1A51D) {
      showProperties(`gch`, _0x1A4C3);
      event[`preventDefault`]();
      event[`stopPropagation`]();
      return false;
    }
    var _0x1A54A = findNearObjByType(
      _0x1A4C3,
      _0x17688,
      _0x1A4C3[`offsetX`] / scale,
      _0x1A4C3[`offsetY`] / scale,
      `lyric`
    );
    if (_0x1A54A) {
      showProperties(`lyric`, _0x1A4C3);
      return;
    }
    var _0x15C57 = $(`#source`)[`val`]();
    if (musicType == 2) {
      selectSimpleNode(_0x17688, _0x1A4C3, scale, true);
      return;
    }
    var _0x1A5A4 = getStaffBotLineY(_0x17688, _0x1A4C3[`offsetY`] / scale);
    var _0x1A40F = _0x1A5A4 - _0x1A4C3[`offsetY`] / scale;
    if (_0x1A40F > 0 && _0x1A40F <= 24) {
      console[`log`](`未选中音符，且点击在五线内`);
      selectNode(_0x17688, _0x1A4C3, scale, true);
      showProperties(`bar`, _0x1A4C3);
    }
  } else {
    if (
      $(select_note_info[`click_obj`])[`attr`](`cat`) ==
      `decos`
    ) {
      if (selectDecoInfo == null) {
        selectDecoInfo = $(select_note_info[`click_obj`]);
      }
      showProperties(`deco`, _0x1A4C3);
      return;
    } else {
      if (
        $(select_note_info[`click_obj`])[`attr`](`type`) ==
        `zs`
      ) {
        selectGchInfo = $(select_note_info[`click_obj`]);
        showProperties(`gch`, _0x1A4C3);
        return;
      } else {
        if (
          $(select_note_info[`click_obj`])[`attr`](`type`) ==
          `lyric`
        ) {
          selectGchInfo = $(select_note_info[`click_obj`]);
          showProperties(`lyric`, _0x1A4C3);
          return;
        }
      }
    }
  }
}
function moveingRenderBar(_0x16062) {
  console[`log`](`在移动小节类的装饰音`, _0x16062);
  var _0x16A3A = _0x16062[`target`];
  if (_0x16A3A[`tagName`] == `svg`) {
    var _0x17688 = _0x16A3A;
    selectBar(_0x17688, _0x16062, scale, false);
  }
}
function movingRenderStaff(_0x16062) {
  console.log('——————————————————————————' + _0x16062 + '——————————————————————————————————————————')
  console[`log`](`在移动连谱号`, _0x16062);
  var _0x16A3A = _0x16062[`target`];
  if (musicType == 0 || musicType == 1) {
    if (_0x16A3A[`tagName`] == `svg`) {
      var _0x17688 = _0x16A3A;
      $(_0x17688)
      [`find`](`g[type='staff']`)
      [`find`](`path`)
      [`css`](`stroke`, `black`);
      selectStaff(_0x17688, _0x16062);
    }
  } else {
    if (musicType == 2) {
      console[`log`](_0x16062[`target`]);
      if (_0x16A3A[`tagName`] == `svg`) {
        var _0x17688 = _0x16A3A;
        $(_0x17688)
        [`find`](`g[type='bar_datas']`)
        [`find`](`text`)
        [`css`](`stroke`, `black`);
        selectStaff(_0x17688, _0x16062);
      }
    }
  }
}
function selectStaff(_0x17688, _0x16062) {
  var _0x1B657 = _0x16062[`offsetY`];
  var _0x182A9 = 99999;
  var _0x1962C = -1;
  if (musicType == 0 || musicType == 1) {
    $(_0x17688)
    [`find`](`g[type='staff']`)
    [`each`](function (_0x15CDE, _0x1646D) {
      var _0x17C82 = $(_0x1646D)[`attr`](`transform`);
      if (_0x17C82) {
        var _0x17A66 = getTransformsTranslate(_0x17C82);
        if (
          _0x1B657 < _0x17A66[`y`] * scale &&
          _0x1B657 > (_0x17A66[`y`] - 24) * scale
        ) {
          _0x1962C = $(_0x1646D)[`attr`](`st`);
          return false;
        }
      }
    });
  } else {
    if (musicType == 2) {
      $(_0x17688)
      [`find`](`g[type='bar_datas']`)
      [`each`](function (_0x15CDE, _0x1646D) {
        var _0x17C82 = $(_0x1646D)[`attr`](`transform`);
        if (_0x17C82) {
          var _0x17A66 = getTransformsTranslate(_0x17C82);
          console[`log`](
            `-----`,
            _0x1B657,
            _0x17A66[`y`],
            _0x17A66[`y`] * scale,
            (parseFloat(_0x17A66[`y`]) + 24) * scale
          );
          if (
            _0x1B657 > _0x17A66[`y`] * scale &&
            _0x1B657 <= (parseFloat(_0x17A66[`y`]) + 24) * scale
          ) {
            _0x1962C = $(_0x1646D)[`attr`](`st`);
            return false;
          }
        }
      });
    }
  }
  if (_0x1962C != -1) {
    if (musicType == 0 || musicType == 1) {
      $(_0x17688)
      [`find`](`g[type='staff'][st='` + _0x1962C + `']`)
      [`find`](`path`)
      [`css`](`stroke`, `red`)
      [`addClass`](`select_staff`);
    } else {
      $(_0x17688)
      [`find`](`g[type='bar_datas'][st='` + _0x1962C + `']`)
      [`find`](`text`)
      [`css`](`stroke`, `red`)
      [`addClass`](`select_staff`);
    }
    selectedStaffNum = _0x1962C;
  }
}
function findNearNote(_0x16062, _0x1792B, _0x16008, _0x16035) {
  console[`log`](`findnearnote...`);
  select_note_info = new Object();
  delObj = new Object();
  var _0x183B7 = null;
  $(_0x1792B)
  [`find`](`text`)
  [`each`](function (_0x15CDE, _0x1646D) {
    var _0x17E9E = $(this)[`attr`](`x`);
    var _0x17ECB = $(this)[`attr`](`y`);
    var _0x184C5 = 1;
    if (musicType == 2) {
      var _0x17C55 = $(_0x1646D)[`parent`]();
      var _0x17C82 = $(_0x17C55)[`attr`](`transform`);
      if (_0x17C82) {
        var _0x17A66 = getTransformsTranslate(_0x17C82);
        if (_0x17A66 != null) {
          if (_0x17E9E) {
            _0x17E9E =
              parseFloat(_0x17E9E) + parseFloat(_0x17A66[`x`]);
          }
          if (_0x17ECB) {
            _0x17ECB =
              parseFloat(_0x17ECB) + parseFloat(_0x17A66[`y`]);
          }
        }
        if ($(_0x17C55)[`attr`](`isgrace`) == `1`) {
          _0x184C5 = getTransformsScale(_0x17C82);
        }
      }
      if ($(_0x17C55)[`hasClass`](`jpchord`)) {
        var _0x18498 = $(_0x17C55)[`parent`]();
        var _0x184F2 = $(_0x18498)[`attr`](`transform`);
        if (_0x184F2) {
          var _0x1851F = getTransformsTranslate(_0x184F2);
          if (_0x1851F != null) {
            if (_0x17E9E) {
              _0x17E9E =
                parseFloat(_0x17E9E) + parseFloat(_0x1851F[`x`]);
            }
            if (_0x17ECB) {
              _0x17ECB =
                parseFloat(_0x17ECB) + parseFloat(_0x1851F[`y`]);
            }
          }
        }
      }
    }
    if (!_0x17E9E || !_0x17ECB) {
      var _0x17A39 = $(_0x1646D)[`attr`](`transform`);
      if (_0x17A39 && _0x17A39 != ``) {
        var _0x168D2 = /translate((.[^(]*))/;
        var _0x168A5 = _0x17A39[`match`](_0x168D2);
        if (_0x168A5 != null) {
          var _0x17B74 = _0x168A5[1][`replace`](/s/g, ``);
          var _0x17B47 = _0x17B74[`split`](`,`);
          _0x17E9E = _0x17B47[0];
          _0x17ECB = _0x17B47[1];
        }
      } else {
        return;
      }
    }
    var _0x18006 = parseFloat(_0x17E9E) * _0x184C5;
    var _0x18033 = parseFloat(_0x17ECB);
    if (musicType == 0) {
      if (
        _0x16008 >= _0x18006 - 3 &&
        _0x16008 <= _0x18006 + 6 &&
        _0x16035 <= _0x18033 + 3 &&
        _0x16035 >= _0x18033 - 6
      ) {
        _0x183B7 = $(this);
        if ($(_0x183B7)[`attr`](`type`) == `ghd`) {
        } else {
          $(_0x183B7)[`attr`](`x`, _0x17E9E);
          $(_0x183B7)[`attr`](`y`, _0x17ECB);
        }
      }
    } else {
      if (
        _0x16008 >= _0x18006 - 3 &&
        _0x16008 <= _0x18006 + 16 &&
        _0x16035 <= _0x18033 + 3 &&
        _0x16035 >= _0x18033 - 16
      ) {
        _0x183B7 = $(this);
      }
    }
  });
  $(_0x1792B)
  [`find`](`text:not([type='title'])`)
  [`css`](`fill`, ``);
  if (_0x183B7 != null) {
    var _0x15FDB = $(_0x183B7)[`attr`](`type`);
    if (
      _0x15FDB &&
      ($(_0x183B7)[`attr`](`type`)[`indexOf`](`acc`) == 0 ||
        eq(`meter`, _0x15FDB))
    ) {
      var _0x183E4 = $(_0x183B7)[`attr`](`istart`);
      $(`text[istart='` + _0x183E4 + `']`)[`addClass`](`selected_text`);
      clearFocus();
    } else {
      if (_0x15FDB && _0x15FDB == `tempo`) {
        $(_0x183B7)[`find`](`tspan`)[`addClass`](`selected_text`);
        clearFocus();
        showProperties(`tempo`, _0x16062);
      } else {
        if (
          _0x15FDB &&
          (_0x15FDB[`toLowerCase`]() == `hd` || _0x15FDB == `note`)
        ) {
          showProperties(`note`, _0x16062, _0x183B7);
        } else {
          if (_0x15FDB && _0x15FDB[`indexOf`](`r`) == 0) {
            showProperties(`rest`, _0x16062);
          }
        }
        $(_0x183B7)[`addClass`](`selected_text`);
        addHelpAssessant($($(_0x183B7))[`attr`](`istart`));
        clearFocus();
      }
    }
  }
  delObj[`click_obj`] = _0x183B7;
  select_note_info[`click_obj`] = _0x183B7;
  var _0x15EFA = $(select_note_info[`click_obj`])[`attr`](`istart`);
  if (_0x15EFA != ``) {
    var _0x1843E = $(select_note_info[`click_obj`])[`attr`](`y`);
    var _0x18411 = $(select_note_info[`click_obj`])
    [`parents`](`svg`)
    [`find`](
      `text[type='hd'].` +
      _0x15EFA +
      `,text[type='Hd'].` +
      _0x15EFA +
      `,text[type='HD'].` +
      _0x15EFA +
      `,text[type='note'][istart='` +
      _0x15EFA +
      `']`
    )
    [`sort`](function (_0x1735E, _0x1738B) {
      return (
        $(_0x1738B)[`attr`](`y`) -
        $(_0x1735E)[`attr`](`y`)
      );
    });
    var _0x1846B = -1;
    for (var _0x15CDE = 0; _0x15CDE < _0x18411['length']; _0x15CDE++) {
      if (
        parseFloat(_0x1843E) ==
        parseFloat($(_0x18411[_0x15CDE])[`attr`](`y`))
      ) {
        _0x1846B = _0x15CDE;
      }
    }
    $(select_note_info[`click_obj`])[`attr`](`ori_y`, _0x1843E);
    $(select_note_info[`click_obj`])[`attr`](`update_index`, _0x1846B);
  }
}
function findNearObjByType(_0x16062, _0x1792B, _0x16008, _0x16035, _0x1862D) {
  var _0x17B1A = false;
  var _0x180E7 = `text[type='` + _0x1862D + `']`;
  if (_0x1862D == `use`) {
    _0x180E7 = `use[cat='decos']`;
  }
  $(_0x1792B)
  [`find`](_0x180E7)
  [`each`](function (_0x15CDE, _0x1646D) {
    if (!_0x17B1A) {
      var _0x17E9E = $(this)[`attr`](`x`);
      var _0x17ECB = $(this)[`attr`](`y`);
      var _0x18006 = parseFloat(_0x17E9E);
      var _0x18033 = parseFloat(_0x17ECB);
      var _0x17C82 = $(_0x1646D)[`parent`]()[`attr`](`transform`);
      var _0x17A66 = getTransformsTranslate(_0x17C82);
      if (_0x17A66 != null) {
        _0x18006 = _0x18006 + parseFloat(_0x17A66[`x`]);
        _0x18033 = _0x18033 + parseFloat(_0x17A66[`y`]);
      }
      var _0x1649A = $(this)[0][`getBBox`]();
      var _0x17FAC = 0,
        _0x17CDC = 0;
      if (_0x1649A) {
        _0x17FAC = _0x1649A[`width`];
        _0x17CDC = _0x1649A[`height`];
      }
      if (
        _0x16008 >= _0x18006 &&
        _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
        _0x16035 <= _0x18033 &&
        _0x16035 >= _0x18033 - _0x17CDC
      ) {
        $(_0x1646D)[`css`](`color`, `red`);
        $(_0x1646D)[`attr`](`fill`, `red`);
        $(_0x1646D)[`attr`](`selected`, `selected`);
        selectGchInfo = $(this);
        _0x17B1A = true;
        return true;
      }
    }
  });
  return _0x17B1A;
}
function findNearDeco(_0x16062, _0x1792B, _0x16008, _0x16035) {
  var _0x17B1A = false;
  $(_0x1792B)
  [`find`](`[cat='decos']`)
  [`each`](function (_0x15CDE, _0x1646D) {
    if (!_0x17B1A) {
      var _0x15FDB = $(_0x1646D)[`attr`](`type`);
      var _0x17E9E = $(this)[`attr`](`x`);
      var _0x17ECB = $(this)[`attr`](`y`);
      if (
        _0x15FDB &&
        (_0x15FDB == `invertedturn` ||
          _0x15FDB == `tubrn` ||
          _0x15FDB == `wedge` ||
          _0x15FDB == `accent` ||
          (musicType == 2 && _0x15FDB == `upb`) ||
          (musicType == 2 && _0x15FDB[`indexOf`](`inst_`) == 0) ||
          (musicType == 2 && _0x15FDB == `sldrd2`) ||
          (musicType == 2 && _0x15FDB == `sldrd_spl`) ||
          (musicType == 2 && _0x15FDB == `sldru_spl`) ||
          (musicType == 2 && _0x15FDB == `dnb`) ||
          (musicType == 2 && _0x15FDB == `tenutoup`) ||
          (musicType == 2 && _0x15FDB == `opend`) ||
          (musicType == 2 && _0x15FDB == `dplus`) ||
          (musicType == 2 && _0x15FDB == `snap`) ||
          (musicType == 2 && _0x15FDB == `trl`) ||
          (musicType == 2 && _0x15FDB == `rit`) ||
          (musicType == 2 && _0x15FDB == `accel`) ||
          (musicType == 2 && _0x15FDB == `sphr`) ||
          (musicType == 2 && _0x15FDB == `kew1`) ||
          (musicType == 2 && _0x15FDB == `kew2`) ||
          (musicType == 2 && _0x15FDB == `kew3`) ||
          (musicType == 2 && _0x15FDB == `kew4`) ||
          (musicType == 2 && _0x15FDB == `kew5`) ||
          (musicType == 2 && _0x15FDB == `kew6`) ||
          (musicType == 2 && _0x15FDB == `kew7`) ||
          (musicType == 2 && _0x15FDB == `kew8`) ||
          (musicType == 2 && _0x15FDB == `img`))
      ) {
        var _0x17A39 = $(_0x1646D)[`parent`]()[`attr`](`transform`);
        if (_0x17A39 && _0x17A39 != ``) {
          var _0x168D2 = /translate((.[^(]*))/;
          var _0x168A5 = _0x17A39[`match`](_0x168D2);
          if (_0x168A5 != null) {
            var _0x17B74 = _0x168A5[1][`replace`](/s/g, ``);
            var _0x17B47 = _0x17B74[`split`](`,`);
            _0x17E9E = parseFloat(_0x17B47[0]) + parseFloat(_0x17E9E);
            _0x17ECB = parseFloat(_0x17B47[1]) + parseFloat(_0x17ECB);
          }
        }
      }
      var _0x18006 = parseFloat(_0x17E9E);
      var _0x18033 = parseFloat(_0x17ECB);
      if (_0x15FDB == `img`) {
        _0x18006 = _0x18006 - 5;
      }
      var _0x1649A = $(this)[0][`getBBox`]();
      var _0x17FAC = 0,
        _0x17CDC = 0;
      if (_0x1649A) {
        _0x17FAC = _0x1649A[`width`];
        _0x17CDC = _0x1649A[`height`];
      }
      if (musicType != 2 && _0x15FDB == `accent`) {
        _0x18033 += _0x17CDC;
      }
      if (musicType != 2 && _0x15FDB == `wedge`) {
      }
      if (_0x15FDB == `slur`) {
        var _0x17F25 =
          $(this)[`parents`](`svg`)[`offset`]()[`top`] +
          $(`#target`)[`scrollTop`]();
        var _0x17EF8 = $(this)[`parents`](`svg`)[`offset`]()[
          `left`
        ];
        var _0x17C55 = $(_0x1646D)[`parent`]();
        var _0x17C82 = $(_0x17C55)[`attr`](`transform`);
        var _0x17A66 = getTransformsTranslate(_0x17C82);
        console[`log`](_0x17A66);
        var _0x164C7 = this[`getBoundingClientRect`]();
        var _0x1649A = $(this)[0][`getBBox`]();
        var _0x17E71, _0x17E17, _0x17E44;
        var _0x15F81 = 8;
        _0x18006 = (_0x164C7[`x`] - _0x17EF8) / scale;
        _0x18033 = (_0x164C7[`y`] - _0x17F25) / scale;
        if (
          _0x16008 >= _0x18006 &&
          _0x16008 <= _0x18006 + _0x1649A[`width`] &&
          _0x16035 >= _0x18033 &&
          _0x16035 <= _0x18033 + _0x1649A[`height`]
        ) {
          console[`log`](`点击连句线里面`, _0x16062[`target`]);
          var _0x17F7F = _0x16062[`target`];
          var _0x172D7 = $(_0x17F7F)[`attr`](`dragtype`);
          var _0x17F52 = $(_0x17F7F)[`attr`](`pos`);
          if (_0x172D7 == `slur` && _0x17F52 == `mid`) {
            return;
          }
          selectDecoInfo = $(this);
          if ($(selectDecoInfo)[`hasClass`](`selected_path`)) {
            showProperties(`slur`, _0x16062);
            return;
          }
          console[`log`]($(selectDecoInfo)[`attr`](`d`));
          var _0x17796 = $(selectDecoInfo)[`attr`](`d`);
          var _0x17D36 = getPathInfo(_0x17796);
          var _0x16A3A = $(selectDecoInfo)[`attr`](`id`);
          $(_0x1646D)[`addClass`](`selected_path`);
          $(_0x1646D)[`attr`](`selected`, `selected`);
          _0x17E71 = drawRect(
            _0x15FDB,
            _0x1649A[`x`] - _0x15F81,
            _0x17D36[`start`][`y`],
            _0x15F81,
            `start`,
            $(selectDecoInfo)[`attr`](`start`),
            _0x16A3A
          );
          _0x17E17 = drawRect(
            _0x15FDB,
            _0x1649A[`x`] + _0x1649A[`width`],
            parseFloat(_0x17D36[`start`][`y`]) +
            parseFloat(_0x17D36[`end`][`y`]),
            _0x15F81,
            `end`,
            $(selectDecoInfo)[`attr`](`end`),
            _0x16A3A
          );
          $(selectDecoInfo)[`parent`]()[`append`](_0x17E71);
          $(selectDecoInfo)[`parent`]()[`append`](_0x17E17);
          setPathInfo(selectDecoInfo[0], _0x17D36);
          $(selectDecoInfo)
          [`parent`]()
          [`parent`]()
          [`append`]($(selectDecoInfo)[`parent`]());
          _0x17B1A = true;
          showProperties(`slur`, _0x16062);
          return true;
        }
      } else {
        if (_0x15FDB == `jq` || _0x15FDB == `jr`) {
          var _0x17E9E = $(this)[`attr`](`x`);
          var _0x17ECB = $(this)[`attr`](`y`);
          if (!_0x17E9E || !_0x17ECB) {
            var _0x17A39 = $(_0x1646D)[`attr`](`transform`);
            if (_0x17A39 && _0x17A39 != ``) {
              var _0x168D2 = /translate((.[^(]*))/;
              var _0x168A5 = _0x17A39[`match`](_0x168D2);
              if (_0x168A5 != null) {
                var _0x17B74 = _0x168A5[1][`replace`](/s/g, ``);
                var _0x17B47 = _0x17B74[`split`](`,`);
                _0x17E9E = _0x17B47[0];
                _0x17ECB = _0x17B47[1];
              }
            }
            var _0x17DBD, _0x17DEA;
            var _0x17BA1 = $(_0x1646D)[`attr`](`d`);
            var _0x168D2 = /m(.[^l]*)l/;
            var _0x17D09 = _0x17BA1[`match`](_0x168D2);
            if (_0x17D09['length'] != null) {
              var _0x17B74 = _0x17D09[1][`replace`](/s+/, ` `);
              var _0x17B47 = _0x17B74[`split`](` `);
              _0x17DBD = _0x17B47[0];
              _0x17DEA = _0x17B47[1];
            }
            var _0x17FD9 = _0x17BA1[`match`](/l(.[^l]*)l/);
            var _0x17D90, _0x17D63;
            if (_0x17FD9 != null) {
              var _0x17B74 = _0x17FD9[1][`replace`](/s+/, ` `);
              var _0x17B47 = _0x17B74[`split`](` `);
              _0x17D90 = parseFloat(_0x17B47[0]);
              _0x17D63 = Math[`abs`](parseFloat(_0x17B47[1]));
            }
            if (!_0x17E9E) {
              _0x17E9E = _0x17DBD;
            } else {
              _0x17E9E = parseFloat(_0x17E9E) + parseFloat(_0x17DBD);
            }
            if (!_0x17ECB) {
              _0x17ECB = _0x17DEA;
            } else {
              _0x17ECB = parseFloat(_0x17ECB) + parseFloat(_0x17DEA);
            }
          }
          if ($(this)[`attr`](`type`)) {
            console[`log`]($(this)[`attr`](`type`));
          }
          var _0x18006 = parseFloat(_0x17E9E);
          var _0x18033 = parseFloat(_0x17ECB);
          if (_0x17D90 < 0) {
            _0x18006 = _0x18006 + _0x17D90;
          }
          if (
            _0x16008 >= _0x18006 &&
            _0x16008 <= _0x18006 + Math[`abs`](_0x17D90) &&
            _0x16035 <= _0x18033 &&
            _0x16035 >= _0x18033 - _0x17D63 * 2
          ) {
            selectDecoInfo = $(this);
            if (
              $(selectDecoInfo)[`attr`](`selected`) === `selected`
            ) {
              return;
            }
            $(selectDecoInfo)[`addClass`](`selected_path`);
            $(selectDecoInfo)[`attr`](`selected`, `selected`);
            var _0x17C28 = $(selectDecoInfo)[`attr`](`d`);
            var _0x17BFB = getDinfo(_0x17C28);
            if (_0x17BFB != null) {
              var _0x15F81 = 8;
              var _0x17E71, _0x17E17;
              if (_0x17BFB[`lines`][0][`x`] > 0) {
                _0x17E71 = drawRect(
                  _0x15FDB,
                  _0x17BFB[`m`][`x`] - _0x15F81,
                  _0x17BFB[`m`][`y`] - 8,
                  _0x15F81,
                  `start`,
                  $(selectDecoInfo)[`attr`](`start`)
                );
                _0x17E17 = drawRect(
                  _0x15FDB,
                  _0x17BFB[`m`][`x`] +
                  _0x17BFB[`lines`][0][`x`],
                  _0x17BFB[`m`][`y`] - 8,
                  _0x15F81,
                  `end`,
                  $(selectDecoInfo)[`attr`](`end`)
                );
              } else {
                _0x17E71 = drawRect(
                  _0x15FDB,
                  _0x17BFB[`m`][`x`],
                  _0x17BFB[`m`][`y`] - 8,
                  _0x15F81,
                  `end`,
                  $(selectDecoInfo)[`attr`](`end`)
                );
                _0x17E17 = drawRect(
                  _0x15FDB,
                  _0x17BFB[`m`][`x`] +
                  _0x17BFB[`lines`][0][`x`] -
                  _0x15F81,
                  _0x17BFB[`m`][`y`] - 8,
                  _0x15F81,
                  `start`,
                  $(selectDecoInfo)[`attr`](`start`)
                );
              }
              $(selectDecoInfo)[`parent`]()[`append`](_0x17E71);
              $(selectDecoInfo)[`parent`]()[`append`](_0x17E17);
            }
            _0x17B1A = true;
            return true;
          }
        } else {
          if (
            _0x15FDB == `8va` ||
            _0x15FDB == `8vb` ||
            _0x15FDB == `15ma` ||
            _0x15FDB == `15mb`
          ) {
            var _0x17F25 =
              $(this)[`parents`](`svg`)[`offset`]()[
              `top`
              ] + $(`#target`)[`scrollTop`]();
            var _0x17EF8 = $(this)[`parents`](`svg`)[`offset`]()[
              `left`
            ];
            var _0x164C7 = this[`getBoundingClientRect`]();
            var _0x1649A = $(this)[0][`getBBox`]();
            console[`log`](`box===`, _0x164C7);
            console[`log`](`bbox===`, _0x1649A);
            console[`log`](
              `x:`,
              _0x16008,
              `  y:`,
              _0x16035
            );
            var _0x17E71, _0x17E17;
            var _0x15F81 = 8;
            _0x18006 = (_0x164C7[`x`] - _0x17EF8) / scale;
            _0x18033 = (_0x164C7[`y`] - _0x17F25) / scale;
            console[`log`](
              `wx:`,
              _0x18006,
              `  wy:`,
              _0x18033
            );
            if (
              _0x16008 >= _0x18006 &&
              _0x16008 <= _0x18006 + _0x1649A[`width`] &&
              _0x16035 >= _0x18033 &&
              _0x16035 <= _0x18033 + _0x1649A[`height`]
            ) {
              console[`log`](`点击高8/15度里面`);
              selectDecoInfo = $(this);
              if ($(selectDecoInfo)[`hasClass`](`selected_path`)) {
                return;
              }
              $(_0x1646D)[`addClass`](`selected_path`);
              $(_0x1646D)[`attr`](`selected`, `selected`);
              _0x17E71 = drawRect(
                _0x15FDB,
                _0x1649A[`x`] - 2 * _0x15F81,
                _0x1649A[`y`],
                _0x15F81,
                `start`,
                $(selectDecoInfo)[`attr`](`start`)
              );
              var _0x17BCE = $(
                `path[type='8va'][start='` +
                $(selectDecoInfo)[`attr`](`start`) +
                `']`
              );
              $[`each`](_0x17BCE, function (_0x15CDE, _0x18060) {
                $(_0x18060)[`addClass`](`selected_path`);
              });
              var _0x17CAF = false;
              _0x17E17 = drawRect(
                _0x15FDB,
                _0x1649A[`x`] + _0x1649A[`width`] + _0x15F81,
                _0x1649A[`y`],
                _0x15F81,
                `end`,
                $(selectDecoInfo)[`attr`](`end`)
              );
              $(selectDecoInfo)[`parent`]()[`append`](_0x17E71);
              $(selectDecoInfo)[`parent`]()[`append`](_0x17E17);
              $(selectDecoInfo)
              [`parent`]()
              [`parent`]()
              [`append`]($(selectDecoInfo)[`parent`]());
              _0x17B1A = true;
              return true;
            }
          } else {
            if (_0x15FDB == `stc`) {
              if (
                _0x16008 >= _0x18006 - 3 &&
                _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
                _0x16035 >= _0x18033 - 5 &&
                _0x16035 <= _0x18033 + _0x17CDC
              ) {
                _0x17FAC = 5;
                _0x17CDC = 5;
                $(_0x1646D)[`css`](`color`, `red`);
                $(_0x1646D)[`attr`](`fill`, `red`);
                $(_0x1646D)[`attr`](`selected`, `selected`);
                selectDecoInfo = $(this);
                _0x17B1A = true;
              }
            } else {
              if (_0x15FDB == `emb`) {
                if (
                  _0x16008 >= _0x18006 - 3 &&
                  _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
                  _0x16035 >= _0x18033 &&
                  _0x16035 <= _0x18033 + _0x17CDC
                ) {
                  _0x17CDC = 5;
                  selectDecoInfo = $(this);
                  _0x17B1A = true;
                }
              } else {
                if (musicType == 2 && _0x15FDB == `wedge`) {
                  if (
                    _0x16008 >= _0x18006 - 3 &&
                    _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
                    _0x16035 >= _0x18033 - _0x17CDC &&
                    _0x16035 <= _0x18033
                  ) {
                    selectDecoInfo = $(this);
                    _0x17B1A = true;
                  }
                } else {
                  if (_0x15FDB == `invertedturn`) {
                    if (
                      _0x16008 >= _0x18006 - 3 &&
                      _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
                      _0x16035 >= _0x18033 &&
                      _0x16035 <= _0x18033 + _0x17CDC
                    ) {
                      console[`log`](_0x1646D);
                      $(_0x1646D)[`css`](`color`, `red`);
                      $(_0x1646D)[`attr`](`fill`, `red`);
                      $(_0x1646D)[`attr`](`selected`, `selected`);
                      selectDecoInfo = $(this);
                      _0x17B1A = true;
                      return true;
                    }
                  } else {
                    if (
                      _0x16008 >= _0x18006 - 3 &&
                      _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
                      _0x16035 <= _0x18033 &&
                      _0x16035 >= _0x18033 - _0x17CDC
                    ) {
                      console[`log`](_0x1646D);
                      $(_0x1646D)[`css`](`color`, `red`);
                      $(_0x1646D)[`attr`](`fill`, `red`);
                      $(_0x1646D)[`attr`](`selected`, `selected`);
                      selectDecoInfo = $(this);
                      _0x17B1A = true;
                      return true;
                    } else {
                      if (
                        _0x16008 >= _0x18006 - 3 &&
                        _0x16008 <= _0x18006 + Math[`abs`](_0x17FAC) &&
                        _0x16035 >= _0x18033 &&
                        _0x16035 <= _0x18033 + _0x17CDC
                      ) {
                        selectDecoInfo = $(this);
                        _0x17B1A = true;
                        return true;
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  });
  return _0x17B1A;
}
var dragDecoRect = false;
var decoRectMouseDownTime;
function drawDecoRect(
  _0x16008,
  _0x16035,
  _0x1770F,
  _0x176E2,
  _0x15EFA,
  _0x15FDB
) {
  var _0x15F27 = `http://www.w3.org/2000/svg`;
  var _0x15FAE = document[`createElementNS`](_0x15F27, `rect`);
  _0x15FAE[`setAttribute`](`x`, _0x16008);
  _0x15FAE[`setAttribute`](`y`, _0x16035);
  _0x15FAE[`setAttribute`](`width`, _0x1770F);
  _0x15FAE[`setAttribute`](`height`, _0x176E2);
  _0x15FAE[`setAttribute`](`istart`, _0x15EFA);
  _0x15FAE[`setAttribute`](`type`, _0x15FDB);
  _0x15FAE[`setAttribute`](`recttype`, `movedragger`);
  _0x15FAE[`setAttribute`](`fill`, `red`);
  _0x15FAE[`setAttribute`](`style`, `opacity:0.3`);
  if (_0x15FDB == `tubrn`) {
    for (var _0x15CDE = _0x15EFA; _0x15CDE < syms['length']; _0x15CDE++) {
      var _0x16170 = syms[_0x15CDE];
      if (_0x16170) {
        if (_0x16170[`in_tuplet`]) {
          $(`rect[type='note'][istart='` + _0x15CDE + `']`)[`remove`]();
        } else {
          break;
        }
      }
    }
  }
  _0x15FAE[`addEventListener`](`mousedown`, function (_0x16062) {
    if (user[`mode`] == `editor`) {
      decoRectMouseDownTime = new Date()[`getTime`]();
      dragDecoRect = true;
      _0x16062[`preventDefault`]();
      _0x16062[`stopPropagation`]();
      return false;
    }
    decoRectDrag = true;
  });
  _0x15FAE[`addEventListener`](`mousemove`, function (_0x16062) {
    if (user[`mode`] == `editor`) {
      if (dragDecoRect) {
        var _0x15FDB = $(event[`target`])[`attr`](`type`);
        var _0x17769 = 0;
        var _0x1773C = 0;
        var _0x1792B = $(_0x16062[`target`])[`parents`](`g`)[0];
        var _0x17A39 = $(_0x1792B)[`attr`](`transform`);
        var _0x178A4 = getTransformsTranslate(_0x17A39);
        if (_0x178A4 == null) {
          _0x178A4 = new Object();
          _0x178A4[`x`] = 0;
          _0x178A4[`y`] = 0;
        }
        $(event[`target`])[`attr`](
          `x`,
          _0x16062[`offsetX`] / scale -
          parseInt(_0x178A4[`x`]) -
          $(_0x16062[`target`])[0][`getBBox`]()[`width`] / 2
        );
        if (_0x15FDB == `accent`) {
          if (musicType == 2) {
            _0x1773C = 7 * scale;
            $(event[`target`])[`attr`](
              `y`,
              _0x16062[`offsetY`] / scale -
              parseInt(_0x178A4[`y`]) -
              3 -
              _0x1773C
            );
          } else {
            _0x1773C = $(_0x16062[`target`])[0][`getBBox`]()[`height`];
            $(event[`target`])[`attr`](
              `y`,
              -(
                _0x16062[`offsetY`] / scale -
                parseInt(_0x178A4[`y`]) -
                18 +
                _0x1773C
              )
            );
          }
        } else {
          if (_0x15FDB == `invertedturn`) {
            if (musicType == 2) {
              _0x1773C = 15 * scale;
              $(event[`target`])[`attr`](
                `y`,
                _0x16062[`offsetY`] / scale -
                parseInt(_0x178A4[`y`]) -
                3 -
                _0x1773C
              );
            } else {
              _0x1773C = $(_0x16062[`target`])[0][`getBBox`]()[
                `height`
              ];
              $(event[`target`])[`attr`](
                `y`,
                -(
                  _0x16062[`offsetY`] / scale -
                  parseInt(_0x178A4[`y`]) -
                  28 +
                  _0x1773C
                )
              );
            }
          } else {
            if (_0x15FDB == `8vb`) {
              _0x1773C =
                $(_0x16062[`target`])[0][`getBBox`]()[`height`] - 15;
              $(event[`target`])[`attr`](
                `y`,
                _0x16062[`offsetY`] / scale -
                parseInt(_0x178A4[`y`]) -
                3 -
                _0x1773C
              );
            } else {
              if (_0x15FDB == `img`) {
                $(event[`target`])[`attr`](
                  `y`,
                  _0x16062[`offsetY`] / scale -
                  parseInt(_0x178A4[`y`]) -
                  3 -
                  _0x1773C
                );
              } else {
                $(event[`target`])[`attr`](
                  `y`,
                  _0x16062[`offsetY`] / scale -
                  parseInt(_0x178A4[`y`]) -
                  3 -
                  _0x1773C
                );
              }
            }
          }
        }
        $(event[`target`])[`attr`](`style`, `opacity:0`);
        var _0x15EFA = $(event[`target`])[`attr`](`istart`);
        var _0x179DF = $(
          `[cat='decos'][start='` +
          _0x15EFA +
          `'][type='` +
          _0x15FDB +
          `'],[cat='decos'][istart='` +
          _0x15EFA +
          `'][type='` +
          _0x15FDB +
          `']`
        );
        if (_0x15FDB == `tubrn`) {
          var _0x17958 = $(`path[cat='decos'][istart='` + _0x15EFA + `']`);
          var _0x168D2 = /m(.[^v]*)v/;
          var _0x179B2 = /m(.[^l]*)l/;
          for (var _0x15CDE = 0; _0x15CDE < _0x17958['length']; _0x15CDE++) {
            var _0x17796 = $(_0x17958[_0x15CDE])[`attr`](`d`);
            var _0x16C29 = _0x168D2[`exec`](_0x17796);
            if (_0x16C29) {
              var _0x17985 = _0x16C29[1];
              var _0x16008 = _0x17985[`split`](` `)[0];
              var _0x16035 = _0x17985[`split`](` `)[1];
              var _0x17769 =
                _0x17958[_0x15CDE][`getBBox`]()[`width`] / 2;
              var _0x177C3 =
                parseInt($(event[`target`])[`attr`](`x`)) -
                _0x17769;
              var _0x177F0 =
                parseInt($(event[`target`])[`attr`](`y`)) +
                $(_0x16062[`target`])[0][`getBBox`]()[`height`];
              _0x17796 =
                `m` +
                (_0x177C3 - _0x178A4[`x`]) +
                ` ` +
                _0x177F0 +
                `v` +
                _0x17796[`replace`](_0x16C29[0], ``);
              $(_0x17958[_0x15CDE])[`attr`](`d`, _0x17796);
              var _0x178D1 = $(_0x17958[_0x15CDE])[`attr`](`orix`);
              var _0x178FE = $(_0x17958[_0x15CDE])[`attr`](`oriy`);
              if (!_0x178D1) {
                _0x178D1 = _0x16008;
                _0x178FE = _0x16035;
                $(_0x17958[_0x15CDE])[`attr`](`orix`, _0x16008);
                $(_0x17958[_0x15CDE])[`attr`](`oriy`, _0x16035);
              }
              $(_0x17958[_0x15CDE])[`attr`](
                `disx`,
                _0x177C3 - parseInt(_0x178D1)
              );
              $(_0x17958[_0x15CDE])[`attr`](
                `disy`,
                _0x177F0 - parseInt(_0x178FE)
              );
            } else {
              if ((_0x16C29 = _0x179B2[`exec`](_0x17796))) {
                var _0x17985 = _0x16C29[1];
                var _0x16008 = _0x17985[`split`](` `)[0];
                var _0x16035 = _0x17985[`split`](` `)[1];
                var _0x17769 =
                  _0x17958[_0x15CDE][`getBBox`]()[`width`] / 2;
                var _0x177C3 =
                  parseInt($(event[`target`])[`attr`](`x`)) -
                  _0x17769;
                var _0x177F0 =
                  parseInt($(event[`target`])[`attr`](`y`)) +
                  6 * scale;
                _0x17796 =
                  `m` +
                  (_0x177C3 - _0x178A4[`x`]) +
                  ` ` +
                  _0x177F0 +
                  `l` +
                  _0x17796[`replace`](_0x16C29[0], ``);
                $(_0x17958[_0x15CDE])[`attr`](`d`, _0x17796);
                var _0x178D1 = $(_0x17958[_0x15CDE])[`attr`](`orix`);
                var _0x178FE = $(_0x17958[_0x15CDE])[`attr`](`oriy`);
                if (!_0x178D1) {
                  _0x178D1 = _0x16008;
                  _0x178FE = _0x16035;
                  $(_0x17958[_0x15CDE])[`attr`](`orix`, _0x16008);
                  $(_0x17958[_0x15CDE])[`attr`](`oriy`, _0x16035);
                }
                $(_0x17958[_0x15CDE])[`attr`](
                  `disx`,
                  _0x177C3 - parseInt(_0x178D1)
                );
                $(_0x17958[_0x15CDE])[`attr`](
                  `disy`,
                  _0x177F0 - parseInt(_0x178FE)
                );
              }
            }
          }
        }
        if (_0x179DF[0][`tagName`][`toLowerCase`]() == `path`) {
          if (_0x15FDB == `jq` || _0x15FDB == `jr`) {
            var _0x17796 = $(_0x179DF)[`attr`](`d`);
            var _0x168D2 = /m(.[^l]*)l/;
            var _0x16C29 = _0x168D2[`exec`](_0x17796);
            if (_0x16C29) {
              var _0x17985 = _0x16C29[1];
              var _0x16008 = _0x17985[`split`](` `)[0];
              var _0x16035 = _0x17985[`split`](` `)[1];
              var _0x17769 = 0;
              if (_0x15FDB == `jq`) {
                _0x17769 = $(_0x16062[`target`])[0][`getBBox`]()[
                  `width`
                ];
              }
              var _0x177C3 =
                parseInt($(event[`target`])[`attr`](`x`)) +
                _0x17769;
              var _0x177F0 =
                parseInt($(event[`target`])[`attr`](`y`)) +
                $(_0x16062[`target`])[0][`getBBox`]()[`height`];
              _0x17796 =
                `m` +
                _0x177C3 +
                ` ` +
                _0x177F0 +
                `l` +
                _0x17796[`replace`](_0x16C29[0], ``);
              $(_0x179DF)[`attr`](`d`, _0x17796);
              var _0x178D1 = $(_0x179DF)[`attr`](`orix`);
              var _0x178FE = $(_0x179DF)[`attr`](`oriy`);
              if (!_0x178D1) {
                _0x178D1 = _0x16008;
                _0x178FE = _0x16035;
                $(_0x179DF)[`attr`](`orix`, _0x16008);
                $(_0x179DF)[`attr`](`oriy`, _0x16035);
              }
              $(_0x179DF)[`attr`](
                `disx`,
                _0x177C3 - parseInt(_0x178D1)
              );
              $(_0x179DF)[`attr`](
                `disy`,
                _0x177F0 - parseInt(_0x178FE)
              );
            }
            $(`rect[dragtype]`)[`remove`]();
          } else {
            if (_0x15FDB == `slur`) {
              var _0x17796 = $(_0x179DF)[`attr`](`d`);
              var _0x168D2 = /M(.[^c]*)c/;
              var _0x16C29 = _0x168D2[`exec`](_0x17796);
              if (_0x16C29) {
                var _0x17985 = _0x16C29[1];
                var _0x16008 = _0x17985[`split`](` `)[0];
                var _0x16035 = _0x17985[`split`](` `)[1];
                var _0x17769 = 0;
                var _0x177C3 =
                  parseInt($(event[`target`])[`attr`](`x`)) +
                  _0x17769;
                var _0x177F0 =
                  parseInt($(event[`target`])[`attr`](`y`)) +
                  $(_0x16062[`target`])[0][`getBBox`]()[`height`];
                _0x17796 =
                  `M` +
                  _0x177C3 +
                  ` ` +
                  _0x177F0 +
                  `c` +
                  _0x17796[`replace`](_0x16C29[0], ``);
                $(_0x179DF)[`attr`](`d`, _0x17796);
                var _0x178D1 = $(_0x179DF)[`attr`](`orix`);
                var _0x178FE = $(_0x179DF)[`attr`](`oriy`);
                if (!_0x178D1) {
                  _0x178D1 = _0x16008;
                  _0x178FE = _0x16035;
                  $(_0x179DF)[`attr`](`orix`, _0x16008);
                  $(_0x179DF)[`attr`](`oriy`, _0x16035);
                }
                $(_0x179DF)[`attr`](
                  `disx`,
                  _0x177C3 - parseInt(_0x178D1)
                );
                $(_0x179DF)[`attr`](
                  `disy`,
                  _0x177F0 - parseInt(_0x178FE)
                );
              }
              $(`rect[dragtype]`)[`remove`]();
            }
          }
        } else {
          if (_0x179DF[0][`tagName`][`toLowerCase`]() == `g`) {
            if (
              _0x15FDB == `8va` ||
              _0x15FDB == `8vb` ||
              _0x15FDB == `15ma` ||
              _0x15FDB == `15mb`
            ) {
              $(_0x179DF)[`find`](`rect`)[`remove`]();
              var _0x17A0C = $(_0x179DF)[`attr`](`transform`);
              var _0x17A66 = getTransformsTranslate(_0x17A39);
              if (!_0x17A66) {
                _0x17A66 = new Object();
                _0x17A66[`x`] = 0;
                _0x17A66[`y`] = 0;
              }
              var _0x178D1 = parseInt(
                $(_0x179DF)[`find`](`text`)[`attr`](`x`)
              );
              var _0x178FE = parseInt(
                $(_0x179DF)[`find`](`text`)[`attr`](`y`)
              );
              if (!_0x178D1) {
                $(_0x179DF)[`attr`](`orix`, 0);
                $(_0x179DF)[`attr`](`oriy`, 0);
              }
              if (_0x15FDB == `8va`) {
                _0x1773C = $(_0x16062[`target`])[0][`getBBox`]()[
                  `height`
                ];
              } else {
              }
              var _0x1784A =
                parseInt($(event[`target`])[`attr`](`x`)) -
                _0x178D1 +
                _0x17769;
              var _0x17877 =
                parseInt($(event[`target`])[`attr`](`y`)) -
                _0x178FE +
                _0x1773C;
              $(_0x179DF)[`attr`](`x`, _0x1784A);
              $(_0x179DF)[`attr`](`y`, _0x17877);
              var _0x1781D =
                `translate(` + _0x1784A + `,` + _0x17877 + `)`;
              $(_0x179DF)[`attr`](`disx`, _0x1784A);
              $(_0x179DF)[`attr`](`disy`, _0x17877);
              $(_0x179DF[0])[`attr`](`transform`, _0x1781D);
              $(`rect[dragtype]`)[`remove`]();
            }
          } else {
            switch (_0x15FDB) {
              case `hld`:
                _0x1773C = 5 * scale;
                break;
              case `coda`:
                _0x17769 = 0;
                _0x1773C = 14 * scale;
                break;
              case `accent`:
                if (musicType == `2`) {
                  _0x1773C += 3 * scale;
                } else {
                  _0x1773C += -5 * scale;
                }
                break;
              case `crescword`:
                _0x17769 = 7;
                _0x1773C = 12 * scale;
                break;
              case `dimword`:
                _0x17769 = 5;
                _0x1773C = 12 * scale;
                break;
              case `kew1`:
              case `kew2`:
              case `kew3`:
              case `kew4`:
              case `kew5`:
              case `kew6`:
              case `kew7`:
              case `kew8`:
                _0x17769 = $(_0x179DF)[0][`getBBox`]()[`width`] / 2 - 2;
                _0x1773C = 25 * scale;
                break;
              case `inst_lingu`:
              case `inst_pengl`:
              case `inst_shac`:
              case `inst_shanjt`:
              case `inst_shoul`:
              case `inst_shuanxt`:
              case `inst_xiangb`:
              case `inst_xiaojg`:
              case `inst_feizg`:
                _0x17769 = $(_0x179DF)[0][`getBBox`]()[`width`] / 2;
                _0x1773C = 32 * scale;
                break;
              case `invertedturn`:
                if (musicType == 2) {
                  _0x17769 =
                    $(_0x179DF)[0][`getBBox`]()[`width`] / 2 - 5;
                } else {
                  _0x17769 = $(_0x179DF)[0][`getBBox`]()[`width`] / 2;
                }
                _0x1773C = 15 * scale;
                break;
              case `img`:
                _0x17769 = $(_0x179DF)[0][`getBBox`]()[`width`] / 2;
                _0x1773C = 20 * scale;
                break;
              default:
                _0x17769 = $(_0x179DF)[0][`getBBox`]()[`width`] / 2;
                _0x1773C = 7 * scale;
            }
            var _0x178D1 = $(_0x179DF)[`attr`](`orix`);
            var _0x178FE = $(_0x179DF)[`attr`](`oriy`);
            if (!_0x178D1) {
              $(_0x179DF)[`attr`](
                `orix`,
                $(_0x179DF)[`attr`](`x`)
              );
              $(_0x179DF)[`attr`](
                `oriy`,
                $(_0x179DF)[`attr`](`y`)
              );
            }
            var _0x1784A =
              parseInt($(event[`target`])[`attr`](`x`)) +
              _0x17769;
            var _0x17877 =
              parseInt($(event[`target`])[`attr`](`y`)) +
              _0x1773C;
            $(_0x179DF)[`attr`](`x`, _0x1784A);
            $(_0x179DF)[`attr`](`y`, _0x17877);
            $(_0x179DF)[`attr`](
              `disx`,
              _0x1784A - parseInt(_0x178D1)
            );
            $(_0x179DF)[`attr`](
              `disy`,
              _0x17877 - parseInt(_0x178FE)
            );
          }
        }
      }
      _0x16062[`preventDefault`]();
      _0x16062[`stopPropagation`]();
      return false;
    }
  });
  _0x15FAE[`addEventListener`](`mouseup`, function (_0x16062) {
    if (user[`mode`] == `editor`) {
      dragDecoRect = false;
      var _0x17A93 = new Date()[`getTime`]();
      if (_0x17A93 - decoRectMouseDownTime < 200) {
        return;
      }
      var _0x17AC0 = $(this)[`parents`](`svg`);
      var _0x17688 = _0x17AC0[_0x17AC0['length'] - 1];
      var _0x16008 = parseInt(parseInt($(this)[`attr`](`x`)));
      var _0x16035 = parseInt(parseInt($(this)[`attr`](`y`)) - 15);
      var _0x15EFA = $(this)[`attr`](`istart`);
      var _0x15FDB = $(this)[`attr`](`type`);
      var _0x179DF = $(
        `[cat='decos'][type='` +
        _0x15FDB +
        `'][start='` +
        _0x15EFA +
        `'],[cat='decos'][type='` +
        _0x15FDB +
        `'][istart='` +
        _0x15EFA +
        `']`
      );
      if (_0x179DF['length'] > 0) {
        updateDecoPosInfo(_0x179DF);
      }
      _0x16062[`preventDefault`]();
      _0x16062[`stopPropagation`]();
      return false;
    }
    decoRectDrag = false;
  });
  return _0x15FAE;
}
function updateDecoPosInfo(_0x17AED) {
  var _0x15FDB = $(_0x17AED)[`attr`](`type`);
  var _0x1BBF7 = $(_0x17AED)[`attr`](`disx`);
  var _0x1BC24 = $(_0x17AED)[`attr`](`disy`);
  if (!_0x1BBF7 || !_0x1BC24) {
    return;
  }
  var _0x15EFA = $(_0x17AED)[`attr`](`istart`)
    ? $(_0x17AED)[`attr`](`istart`)
    : $(_0x17AED)[`attr`](`start`);
  switch (_0x15FDB) {
    case `jq`:
    case `jr`:
    case `8va`:
    case `8vb`:
    case `15ma`:
    case `15mb`:
      if (_0x15FDB == `jq`) {
        _0x15FDB = `cresc`;
      } else {
        if (_0x15FDB == `jr`) {
          _0x15FDB = `dim`;
        }
      }
      _0x15EFA = $(_0x17AED)[`attr`](`end`);
      break;
    case `D.C.`:
      break;
  }
  var _0x16170 = syms[_0x15EFA];
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x16AC1 = _0x16170[`a_gch`];
  var _0x1BC51;
  if (_0x16AC1 != null) {
    for (var _0x15CDE = 0; _0x15CDE < _0x16AC1['length']; _0x15CDE++) {
      var _0x17C55 = _0x16AC1[_0x15CDE];
      if (_0x17C55[`text`][`indexOf`](`gchtype`) > -1) {
        var _0x1BCAB = JSON[`parse`](
          _0x17C55[`text`][`replace`](/'/g, `"`)
        );
        if (_0x1BCAB[`gchtype`] == _0x15FDB) {
          _0x1BC51 = _0x17C55;
          break;
        }
      }
    }
  }
  if (_0x1BC51) {
    var _0x1BD05 = _0x15C57[`substring`](
      _0x1BC51[`istart`],
      _0x1BC51[`iend`]
    );
    var _0x1BCD8 = JSON[`parse`](
      _0x1BD05[`replace`](/"/g, ``)[`replace`](
        /'/g,
        `"`
      )
    );
    var _0x1BC7E =
      `"{'gchtype':'` +
      _0x15FDB +
      `','x':` +
      (_0x1BCD8[`x`] + parseInt(_0x1BBF7)) +
      `,'y':` +
      (_0x1BCD8[`y`] - parseInt(_0x1BC24)) +
      `}"`;
    _0x15C57 =
      _0x15C57[`substring`](0, _0x1BC51[`istart`]) +
      _0x1BC7E +
      _0x15C57[`substring`](_0x1BC51[`iend`]);
  } else {
    var _0x1BC7E =
      `"{'gchtype':'` +
      _0x15FDB +
      `','x':` +
      parseInt(_0x1BBF7) +
      `,'y':` +
      -parseInt(_0x1BC24) +
      `}"`;
    _0x15C57 =
      _0x15C57[`substring`](0, _0x15EFA) +
      _0x1BC7E +
      _0x15C57[`substring`](_0x15EFA);
  }
  $(`#source`)[`val`](_0x15C57);
  doLog();
  src_change();
}
function drawRect(
  _0x15FDB,
  _0x16008,
  _0x16035,
  _0x15F81,
  _0x15F54,
  _0x15EFA,
  _0x16A3A
) {
  var _0x15F27 = `http://www.w3.org/2000/svg`;
  var _0x15FAE = document[`createElementNS`](_0x15F27, `rect`);
  _0x15FAE[`setAttribute`](`dragtype`, _0x15FDB);
  _0x15FAE[`setAttribute`](`type`, _0x15F54);
  if (_0x16A3A) {
    _0x15FAE[`setAttribute`](`target`, _0x16A3A);
  }
  _0x15FAE[`setAttribute`](`x`, _0x16008);
  _0x15FAE[`setAttribute`](`y`, _0x16035);
  _0x15FAE[`setAttribute`](`inity`, _0x16035);
  _0x15FAE[`setAttribute`](`width`, _0x15F81);
  _0x15FAE[`setAttribute`](`height`, _0x15F81);
  _0x15FAE[`setAttribute`](`stroke`, `red`);
  _0x15FAE[`setAttribute`](`stroke-width`, 1);
  _0x15FAE[`setAttribute`](`fill`, `white`);
  _0x15FAE[`setAttribute`](`pos`, _0x15F54);
  _0x15FAE[`setAttribute`](`istart`, _0x15EFA);
  if (deco_params[_0x15FDB]) {
    _0x15FAE[`setAttribute`](`str`, deco_params[_0x15FDB][_0x15F54]);
  }
  _0x15FAE[`addEventListener`](`mousedown`, function (_0x16062) {
    $(this)[`attr`](`selected`, `selected`);
    dragDecoFlag = true;
    rectMouseDownTime = new Date()[`getTime`]();
    $(document)
    [`off`](`mouseup`)
    [`on`](`mouseup`, function (_0x16062) {
      console[`log`](`mouseup`, `  dragDecoFlag:`, dragDecoFlag);
      var _0x160BC = new Date()[`getTime`]();
      if (rectMouseDownTime > 0 && _0x160BC - rectMouseDownTime < 100) {
        dragDecoFlag = false;
        return;
      }
      rectMouseDownTime = -1;
      if (dragDecoFlag) {
        if (_0x15FDB == `linkclef`) {
          var _0x1608F = $(`rect[selected='selected']`);
          updateLinkClef(_0x1608F);
          return;
        }
        if (_0x15FDB == `slur` && _0x15F54 == `mid`) {
          var _0x1608F = $(`rect[selected='selected']`);
          updateDecoPosY(_0x1608F);
          return;
        } else {
          var _0x1608F = $(`rect[selected='selected']`);
          updateDecoPos(_0x1608F);
          return;
        }
      }
    });
  });
  _0x15FAE[`addEventListener`](`mouseup`, function (_0x16062) {
    var _0x160BC = new Date()[`getTime`]();
    if (_0x160BC - rectMouseDownTime < 100) {
      return;
    }
    if (_0x15FDB == `linkclef`) {
      updateLinkClef(this);
      return;
    }
    if (_0x15FDB == `slur` && _0x15F54 == `mid`) {
      updateDecoPosY(this);
    } else {
      updateDecoPos(this);
    }
  });
  return _0x15FAE;
}
function updateLinkClef(_0x1608F, _0x1BDB9) {
  console[`log`](`1111`);
  $(_0x1608F)[`removeAttr`](`selected`);
  dragDecoFlag = false;
  var _0x19659 = $(`rect[dragtype="linkclef"][pos="start"]`);
  var _0x1BF21 = parseFloat($(_0x19659)[`attr`](`y`));
  var _0x176E2 = parseFloat($(_0x19659)[`height`]());
  var _0x193B6 = $(`rect[dragtype="linkclef"][pos="end"]`);
  var _0x1BE40 = parseFloat($(_0x193B6)[`attr`](`y`));
  var _0x17688 = $(_0x19659)[`parents`](`svg`);
  var _0x1BE9A = [];
  if (musicType == 0 || musicType == 1) {
    $(_0x17688)
    [`find`](`g[type="staff"]`)
    [`each`](function (_0x15CDE, _0x1646D) {
      var _0x1BF7B = $(_0x1646D)[`attr`](`transform`);
      var _0x17A66 = getTransformsTranslate(_0x1BF7B);
      var _0x1BF4E = parseFloat(_0x17A66[`y`]) - 24;
      _0x1BE9A[`push`](_0x1BF4E);
    });
  } else {
    if (musicType == 2) {
      $(_0x17688)
      [`find`](`g[type="bar_datas"]`)
      [`each`](function (_0x15CDE, _0x1646D) {
        var _0x1BF7B = $(_0x1646D)[`attr`](`transform`);
        var _0x17A66 = getTransformsTranslate(_0x1BF7B);
        var _0x1BF4E = parseFloat(_0x17A66[`y`]) - 24;
        if (_0x1BE9A[`indexOf`](_0x1BF4E) < 0) {
          _0x1BE9A[`push`](_0x1BF4E);
        }
      });
    }
  }
  _0x1BE9A[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1735E - _0x1738B;
  });
  console[`log`](
    `startTop:`,
    _0x1BF21,
    `   endTop:`,
    _0x1BE40,
    _0x1BE9A
  );
  var _0x1BEF4 = 0;
  var _0x1BE13 = 0;
  var _0x1BE6D = -1;
  var _0x15FDB = $(_0x1608F)[`attr`](`istart`);
  for (var _0x15CDE = 0; _0x15CDE < _0x1BE9A['length']; _0x15CDE++) {
    if (_0x1BF21 > _0x1BE6D) {
      _0x1BEF4 = _0x15CDE;
    }
    if (_0x15FDB == `brace`) {
      if (_0x1BE40 > _0x1BE6D) {
        _0x1BE13 = _0x15CDE;
      }
    } else {
      if (_0x15FDB == `bracket`) {
        if (_0x1BE40 > _0x1BE9A[_0x15CDE]) {
          _0x1BE13 = _0x15CDE;
        }
      }
    }
    _0x1BE6D = _0x1BE9A[_0x15CDE] + 24;
  }
  if (musicType == 0 || musicType == 1) {
  } else {
  }
  console[`log`](`startSt:`, _0x1BEF4, `   endSt:`, _0x1BE13);
  $(`rect[dragtype="linkclef"]`)[`remove`]();
  if ($(`.select_staff`)['length'] > 0) {
    var _0x15C57 = $(`#source`)[`val`]();
    var _0x15D92 = getLinesInfo($(`#source`)[`val`]());
    var _0x18D08 = ``;
    var _0x1BEC7 = ``;
    var _0x1BDE6 = ``;
    if (_0x15FDB == `brace`) {
      _0x1BEC7 = `{`;
      _0x1BDE6 = `}`;
    } else {
      if (_0x15FDB == `bracket`) {
        _0x1BEC7 = `[`;
        _0x1BDE6 = `]`;
      } else {
        if (_0x15FDB == `none`) {
        }
      }
    }
    var _0x1638C = ``;
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      var _0x1635F = _0x15D92[_0x15CDE];
      var _0x15DBF = _0x1635F[`lineStr`];
      if (
        _0x15DBF[`indexOf`](`%%score`) > -1 ||
        _0x15DBF[`indexOf`](`%%staves`) > -1
      ) {
        var _0x16C83 = _0x15DBF[`match`](/%%score|%%staves/)[0];
        clefReg = /\s*\(.[^\(]*\)\s*\|{0,1}|\s*\d\s*\|{0,1}/g;
        _0x15DBF = _0x15DBF[`replace`](_0x1BEC7, ``)[`replace`](
          _0x1BDE6,
          ``
        );
        var _0x18D35 = 0;
        var _0x18D62 = 0;
        var _0x188A3 = ``;
        while ((node = clefReg[`exec`](_0x15DBF))) {
          console[`log`](node);
          _0x188A3 += _0x15DBF[`substring`](_0x18D62, node[`index`]);
          if (_0x18D35 == _0x1BEF4) {
            _0x188A3 += _0x1BEC7;
          }
          _0x188A3 += node[0] + `|`;
          if (_0x18D35 == _0x1BE13) {
            _0x188A3 = _0x188A3[`substring`](0, _0x188A3['length'] - 1);
            _0x188A3 += _0x1BDE6;
            _0x188A3 = _0x188A3[`replace`](/|s*|/, `|`);
          }
          _0x18D62 = node[`index`] + node[0]['length'];
          _0x18D35++;
        }
        if (_0x18D62 < _0x15DBF['length']) {
          _0x188A3 += _0x15DBF[`substr`](_0x18D62);
        }
        _0x1638C += _0x188A3 + `
`;
      } else {
        _0x1638C += _0x15DBF + `
`;
      }
    }
    $(`#source`)[`val`](_0x1638C);
    src_change();
    doLog();
  }
}
var rectMouseDownTime = -1;
function addSlurDragRect(
  _0x15FDB,
  _0x16008,
  _0x16035,
  _0x15F81,
  _0x15F54,
  _0x15EFA
) {
  var _0x15F27 = `http://www.w3.org/2000/svg`;
  var _0x15FAE = document[`createElementNS`](_0x15F27, `rect`);
  _0x15FAE[`setAttribute`](`dragtype`, _0x15FDB);
  _0x15FAE[`setAttribute`](`x`, _0x16008);
  _0x15FAE[`setAttribute`](`y`, _0x16035);
  _0x15FAE[`setAttribute`](`width`, _0x15F81);
  _0x15FAE[`setAttribute`](`height`, _0x15F81);
  _0x15FAE[`setAttribute`](`stroke`, `red`);
  _0x15FAE[`setAttribute`](`stroke-width`, 1);
  _0x15FAE[`setAttribute`](`fill`, `black`);
  _0x15FAE[`setAttribute`](`pos`, _0x15F54);
  _0x15FAE[`setAttribute`](`istart`, _0x15EFA);
  _0x15FAE[`setAttribute`](`str`, deco_params[_0x15FDB][_0x15F54]);
  _0x15FAE[`addEventListener`](`mousedown`, function (_0x16062) {
    $(this)[`attr`](`selected`, `selected`);
    dragDecoFlag = true;
    rectMouseDownTime = new Date()[`getTime`]();
    $(document)
    [`off`](`mouseup`)
    [`on`](`mouseup`, function (_0x16062) {
      if (dragDecoFlag) {
        var _0x1608F = $(`rect[selected='selected']`);
        updateDecoPos(_0x1608F);
        return;
      }
    });
  });
  _0x15FAE[`addEventListener`](`mouseup`, function () {
    var _0x160BC = new Date()[`getTime`]();
    if (rectMouseDownTime > 0 && _0x160BC - rectMouseDownTime < 100) {
      return;
    }
    rectMouseDownTime = -1;
    dragDecoFlag = false;
    updateDecoPos(this);
  });
  return _0x15FAE;
}
function updateDecoPos(_0x1608F) {
  $(_0x1608F)[`removeAttr`](`selected`);
  dragDecoFlag = false;
  if (nearDecoNote != null) {
    var _0x1BABC = $(_0x1608F)[`attr`](`dragtype`);
    var _0x15EFA = $(_0x1608F)[`attr`](`istart`);
    var _0x1BB43 = nearDecoNote[`istart`];
    var _0x1BAE9 = syms[_0x1BB43];
    if (
      `8va` == _0x1BABC ||
      `8vb` == _0x1BABC ||
      `15ma` == _0x1BABC ||
      `15mb` == _0x1BABC
    ) {
      if (_0x1BAE9[`next`]) {
        _0x1BB43 = _0x1BAE9[`next`][`istart`];
      }
    }
    if (_0x15EFA != _0x1BB43) {
      var _0x16AEE = $(_0x1608F)[`attr`](`str`);
      var _0x15C57 = $(`#source`)[`val`]();
      var _0x19578 = ``;
      var _0x1BB70 = false;
      var _0x1BB9D = -1;
      if (_0x1BABC == `k_slur` && _0x15EFA == -1) {
        if (_0x15EFA == -1) {
          var _0x1BB16 = syms[_0x1BB43][`next`];
          if (_0x1BB16) {
            var _0x1638C =
              _0x15C57[`substring`](0, _0x1BB16[`istart`]) +
              _0x16AEE +
              _0x15C57[`substring`](_0x1BB16[`istart`]);
            $(`#source`)[`val`](_0x1638C);
            src_change();
            doLog();
            return;
          }
        }
      }
      if (
        eq(`k_slur,slur`, _0x1BABC) &&
        $(_0x1608F)[`attr`](`pos`) == `end`
      ) {
        _0x1BB70 = true;
        var _0x16170 = syms[_0x15EFA];
        _0x1BB9D = _0x16170[`iend`];
        _0x19578 = _0x15C57[`substring`](0, _0x16170[`iend`]);
      } else {
        _0x19578 = _0x15C57[`substring`](0, _0x15EFA);
        if (_0x1BABC == `k_slur`) {
          var _0x18D62 = _0x19578[`lastIndexOf`](`!slur(`);
          _0x19578 =
            _0x19578[`substring`](0, _0x18D62) +
            _0x19578[`substring`](_0x18D62)[`replace`](
              /\!slur\([^\!]*\!/,
              ``
            );
        }
      }
      if (!_0x16AEE) {
        return;
      }
      var _0x1BBCA = _0x16AEE[`replace`](`(`, `\\(`)[
        `replace`
      ](`)`, `\\)`);
      var _0x168D2 = new RegExp(`([^~]*)(` + _0x1BBCA + `)`);
      _0x19578 = _0x19578[`replace`](_0x168D2, `$1`);
      var _0x1638C = ``;
      if (parseInt(_0x15EFA) < parseInt(_0x1BB43)) {
        if (_0x1BB70) {
          var _0x16170 = syms[_0x1BB43];
          if (_0x1BABC == `k_slur`) {
            _0x1638C =
              _0x19578 +
              _0x15C57[`substring`](_0x1BB9D, _0x16170[`iend`])[
                `replace`
              ](_0x16AEE, ``) +
              _0x16AEE +
              _0x15C57[`substr`](_0x16170[`iend`]);
          } else {
            _0x1638C =
              _0x19578 +
              _0x15C57[`substring`](_0x1BB9D, _0x16170[`iend`]) +
              _0x16AEE +
              _0x15C57[`substr`](_0x16170[`iend`]);
          }
        } else {
          _0x1638C =
            _0x19578 +
            _0x15C57[`substring`](_0x15EFA, _0x1BB43) +
            _0x16AEE +
            _0x15C57[`substr`](_0x1BB43);
        }
      } else {
        if (_0x1BB70) {
          var _0x16170 = syms[_0x1BB43];
          _0x1638C =
            _0x19578[`substring`](0, _0x16170[`iend`]) +
            _0x16AEE +
            _0x19578[`substring`](_0x16170[`iend`], _0x15EFA) +
            _0x15C57[`substr`](_0x15EFA)[`replace`](
              _0x16AEE,
              ``
            );
        } else {
          _0x1638C =
            _0x19578[`substring`](0, _0x1BB43) +
            _0x16AEE +
            _0x19578[`substring`](_0x1BB43, _0x15EFA) +
            _0x15C57[`substr`](_0x15EFA);
        }
      }
      $(`#source`)[`val`](_0x1638C);
      src_change();
      doLog();
    }
  }
}
var lastSlurHeight = 1;
function updateDecoPosY(_0x1608F) {
  console[`log`](`updateDecoPosY-----`, moveSlurHeight);
  $(_0x1608F)[`removeAttr`](`selected`);
  dragDecoFlag = false;
  moveSlurHeight = parseInt(moveSlurHeight * 10) / 10;
  if (Math[`abs`](moveSlurHeight - lastSlurHeight) > 0.3) {
    var _0x15EFA = $(_0x1608F)[`attr`](`istart`);
    var _0x15C57 = $(`#source`)[`val`]();
    var _0x1BD5F = `"sh:` + moveSlurHeight + `"`;
    var _0x16170 = syms[_0x15EFA];
    var _0x16AC1 = _0x16170[`a_gch`];
    var _0x1638C = ``;
    if (_0x16AC1 != null) {
      for (var _0x15CDE = 0; _0x15CDE < _0x16AC1['length']; _0x15CDE++) {
        var _0x1BD32 = _0x16AC1[_0x15CDE];
        var _0x1BD8C = _0x1BD32[`text`];
        if (_0x1BD8C[`indexOf`](`sh:`) == 0) {
          _0x1638C = _0x15C57[`substring`](0, _0x1BD32[`istart`]);
        }
      }
    }
    if (_0x1638C == ``) {
      _0x1638C =
        _0x15C57[`substring`](0, _0x15EFA) +
        _0x1BD5F +
        _0x15C57[`substring`](_0x15EFA);
    } else {
      _0x1638C = _0x1638C + _0x1BD5F + _0x15C57[`substring`](_0x15EFA);
    }
    $(`#source`)[`val`](_0x1638C);
    src_change();
    doLog();
  }
}
function findNearNoteWithSelectedDeco(
  _0x1792B,
  _0x16008,
  _0x16035,
  _0x15FDB,
  _0x185A6,
  _0x16062
) {
  var _0x180BA = 9999;
  var _0x18141 = 9999;
  var _0x1816E = null;
  var _0x1827C = ``;
  var _0x18579 = 0;
  var _0x1854C = _0x16062[`target`][`tagName`];
  if (_0x1854C[`toUpperCase`]() == `SVG`) {
    _0x18579 = $(_0x16062[`target`])[`offset`]()[`top`];
  } else {
    _0x18579 = $($(_0x16062[`target`])[`parents`](`svg`)[0])[
      `offset`
    ]()[`top`];
  }
  _0x16035 = _0x18579 + _0x16035;
  console[`log`](
    `parentY:`,
    _0x18579,
    `x:`,
    _0x16008,
    `y:`,
    _0x16035
  );
  if (
    _0x15FDB == `slur` ||
    _0x15FDB == `jq` ||
    _0x15FDB == `jr` ||
    _0x15FDB == `8va` ||
    _0x15FDB == `8vb` ||
    _0x15FDB == `15ma` ||
    _0x15FDB == `15mb`
  ) {
    _0x1827C = `[v='` + _0x185A6 + `']`;
  }
  var _0x185D3 = ``;
  if (
    _0x15FDB == `8va` ||
    _0x15FDB == `8vb` ||
    _0x15FDB == `15ma` ||
    _0x15FDB == `15mb`
  ) {
    _0x185D3 = `,rect[type='bar']` + _0x1827C;
  }
  $(`#target`)
  [`find`](
    `rect[type='rest']` +
    _0x1827C +
    `,rect[type='note']` +
    _0x1827C +
    `,rect[type='splnum_note']` +
    _0x1827C +
    `,rect[type='splnum_rest']` +
    _0x1827C +
    _0x185D3
  )
  [`each`](function (_0x15CDE, _0x1646D) {
    var _0x1835D = $(this)[`attr`](`x`);
    var _0x1838A = $(this)[`attr`](`y`);
    var _0x18600 = $($(this)[`parents`](`svg`)[0])[`offset`]()[
      `top`
    ];
    if (_0x1838A) {
      _0x1838A = parseFloat(_0x1838A);
      _0x1838A = _0x1838A + _0x18600;
    }
    if (musicType == 2) {
      var _0x17C55 = $(_0x1646D)[`parent`]();
      var _0x17C82 = $(_0x17C55)[`attr`](`transform`);
      var _0x17A66 = getTransformsTranslate(_0x17C82);
      _0x1835D = parseFloat(_0x1835D) + parseFloat(_0x17A66[`x`]);
      _0x1838A = parseFloat(_0x1838A) + parseFloat(_0x17A66[`y`]);
    }
    var _0x17CDC = $(this)[`attr`](`height`);
    var _0x182D6 = Math[`abs`](parseFloat(_0x1835D) - _0x16008);
    var _0x18303 = Math[`abs`](_0x1838A - _0x16035);
    if (_0x182D6 > 30) {
      return;
    }
    var _0x182A9 = 0;
    if (_0x16035 > parseFloat(_0x1838A) + parseFloat(_0x17CDC)) {
      var _0x18330 = Math[`abs`](
        _0x16035 - (parseFloat(_0x1838A) + parseFloat(_0x17CDC))
      );
      _0x182A9 = Math[`sqrt`](
        Math[`pow`](_0x182D6, 2) + Math[`pow`](_0x18330, 2)
      );
      console[`log`](`下`);
    } else {
      _0x182A9 = Math[`sqrt`](
        Math[`pow`](_0x182D6, 2) + Math[`pow`](_0x18303, 2)
      );
      console[`log`](`上`);
    }
    console[`log`](
      `istart:`,
      $(this)[`attr`](`istart`),
      ` currParentY:`,
      _0x18600,
      ` y:`,
      _0x16035,
      ` iy:`,
      _0x1838A,
      ` dis:`,
      _0x182A9
    );
    if (_0x182A9 < 60) {
      if (_0x182A9 < _0x18141) {
        _0x18141 = _0x182A9;
        _0x1816E = $(this);
      }
    }
  });
  if (_0x1816E != null) {
    $(`.editor_rect`)[`removeClass`](`editor_rect`);
    $(`rect[type='rest'],rect[type='note'],rect[type='splnum_note'],rect[type='splnum_rest']`)[`css`](`fill-opacity`, `0`);
    $(_0x1816E)[`addClass`](`editor_rect`);
    var _0x17AED = new Object();
    var _0x1716F = $(_0x1816E)[`prev`]();
    while ($(_0x1716F)[`attr`](`type`) == `dot`) {
      _0x1716F = $(_0x1716F)[`prev`]();
    }
    if ($(_0x1716F)[`is`](`g`)) {
      _0x1716F = $(_0x1716F)[`find`](`text`);
    }
    var _0x16008 = $(_0x1716F)[`attr`](`x`);
    _0x17AED[`x`] = _0x16008;
    _0x17AED[`istart`] = $(_0x1816E)[`attr`](`istart`);
    return _0x17AED;
  }
}
function getDinfo(_0x17796) {
  var _0x17AED = new Object();
  var _0x19B9F = /m(.[^l]*)l/;
  var _0x19B45 = _0x17796[`match`](_0x19B9F);
  var _0x19B72 = new Object();
  if (_0x19B45 != null) {
    var _0x17B74 = _0x19B45[1];
    _0x17B74 = _0x17B74[`replace`](/s+/, ` `);
    _0x19B72[`x`] = parseFloat(_0x17B74[`split`](` `)[0]);
    _0x19B72[`y`] = parseFloat(_0x17B74[`split`](` `)[1]);
  }
  _0x17AED[`m`] = _0x19B72;
  var _0x19B18 = /l(.[^l]*)/g;
  var _0x19AEB = _0x17796[`match`](_0x19B18);
  var _0x19ABE = new Array();
  if (_0x19AEB != null) {
    for (
      var _0x15CDE = 0, _0x1881C = _0x19AEB['length'];
      _0x15CDE < _0x1881C;
      _0x15CDE++
    ) {
      var _0x15DBF = _0x19AEB[_0x15CDE];
      _0x15DBF = _0x15DBF[`replace`](/s+/, ` `);
      var _0x17B47 = _0x15DBF[`split`](` `);
      var _0x18849 = new Object();
      _0x18849[`x`] = parseFloat(
        _0x17B47[0][`replace`](`l`, ``)
      );
      _0x18849[`y`] = parseFloat(_0x17B47[1]);
      _0x19ABE[`push`](_0x18849);
    }
  }
  _0x17AED[`lines`] = _0x19ABE;
  return _0x17AED;
}
function delSelNote() {
  if ($(`text.selected_text[type='mytext']`)['length'] > 0) {
    var _0x171F6 = $(`text.selected_text[type='mytext']`);
    delMyTextInfo($(_0x171F6)[`attr`](`id`));
    $(_0x171F6)[`remove`]();
    return;
  }
  if ($(`rect[type='bar'][selected='selected'],rect[type='splnum_bar'][selected='selected']`)['length'] > 0) {
    var _0x17223 = $(`rect[type='bar'][selected='selected'],rect[type='splnum_bar'][selected='selected']`);
    if (_0x17223['length'] > 1) {
      _0x17223 = _0x17223[_0x17223['length'] - 1];
    }
    var _0x15EFA = $(_0x17223)[`attr`](`istart`);
    var _0x16170 = syms[_0x15EFA];
    if (_0x16170) {
      var _0x16F53 = checkBarIsInLineFirst(_0x17223);
      if (_0x16F53) {
        var _0x16F80 = true;
        var _0x170BB = 0;
        var _0x17304 = new Array();
        var _0x1716F = _0x16170[`ts_prev`];
        while (_0x1716F) {
          if (_0x1716F[`type`] != 0) {
            break;
          }
          if (
            _0x1716F[`ts_prev`] &&
            _0x1716F[`ts_prev`][`type`] == 0
          ) {
            _0x1716F = _0x1716F[`ts_prev`];
          } else {
            break;
          }
        }
        var _0x16E72 = null;
        if (_0x1716F[`type`] == 0) {
          _0x16E72 = _0x1716F;
        } else {
          _0x16E72 = _0x16170;
        }
        console[`log`](_0x16E72);
        if (_0x16E72) {
          for (var _0x15CDE = 0; _0x15CDE < _0x16E72[`istart`]; _0x15CDE++) {
            if (
              syms[_0x15CDE] &&
              (syms[_0x15CDE][`type`] == 8 ||
                syms[_0x15CDE][`type`] == 10)
            ) {
              _0x16F80 = false;
            }
          }
        }
        if (_0x16F80) {
          var _0x15C57 = $(`#source`)[`val`]();
          var _0x1638C = _0x15C57[`substring`](0, _0x16E72[`istart`]);
          var _0x16FAD = abc[`clone`](_0x16E72, 2);
          var _0x17007 = _0x16E72[`ts_next`];
          while (_0x17007 && _0x17007[`type`] == 0) {
            _0x1638C += _0x15C57[`substring`](
              _0x16FAD[`iend`],
              _0x17007[`istart`]
            );
            _0x16FAD = abc[`clone`](_0x17007, 2);
            _0x17007 = _0x17007[`ts_next`];
          }
          _0x1638C += _0x15C57[`substring`](_0x16FAD[`iend`]);
          $(`#source`)[`val`](_0x1638C);
          doLog();
          src_change();
          return;
        } else {
          var _0x15C57 = $(`#source`)[`val`]();
          var _0x1638C =
            _0x15C57[`substring`](0, _0x16E72[`istart`]) + `|`;
          var _0x16FAD = abc[`clone`](_0x16E72, 2);
          var _0x17007 = _0x16E72[`ts_next`];
          while (_0x17007 && _0x17007[`type`] == 0) {
            _0x1638C +=
              _0x15C57[`substring`](
                _0x16FAD[`iend`],
                _0x17007[`istart`]
              ) + `|`;
            _0x16FAD = abc[`clone`](_0x17007, 2);
            _0x17007 = _0x17007[`ts_next`];
          }
          _0x1638C += _0x15C57[`substring`](_0x16FAD[`iend`]);
          $(`#source`)[`val`](_0x1638C);
          doLog();
          src_change();
          return;
        }
      }
    }
    console[`log`](`不允许删除这个小节线`);
    return;
  }
  if ($(`text[type='zs'][selected='selected']`)['length'] > 0) {
    var _0x16EF9 = $(`text[type='zs'][selected='selected']`)[`attr`](`gch_istart`);
    var _0x16ECC = $(`text[type='zs'][selected='selected']`)[`attr`](`gch_iend`);
    var _0x15C57 = $(`#source`)[`val`]();
    _0x15C57 =
      _0x15C57[`substring`](0, _0x16EF9) + _0x15C57[`substring`](_0x16ECC);
    $(`#source`)[`val`](_0x15C57);
    doLog();
    src_change();
    return;
  }
  if ($(`.selected_text[type="bracket"]`)['length'] > 0 || $(`.selected_text[type="brace"]`)['length'] > 0) {
    var _0x16DEB = ``;
    var _0x16DBE = ``;
    if ($(`.selected_text[type="bracket"]`)['length'] > 0) {
      _0x16DEB = `[`;
      _0x16DBE = `]`;
    } else {
      if ($(`.selected_text[type="brace"]`)['length'] > 0) {
        _0x16DEB = `{`;
        _0x16DBE = `}`;
      }
    }
    var _0x15C57 = $(`#source`)[`val`]();
    var _0x15D92 = getLinesInfo(_0x15C57);
    var _0x1638C = ``;
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      var _0x1635F = _0x15D92[_0x15CDE];
      var _0x15DBF = _0x1635F[`lineStr`];
      if (
        _0x15DBF[`indexOf`](`%%score`) > -1 ||
        _0x15DBF[`indexOf`](`%%staves`) > -1
      ) {
        _0x15DBF = _0x15DBF[`replace`](_0x16DEB, ``)[`replace`](
          _0x16DBE,
          ``
        );
      }
      _0x1638C += _0x15DBF + `
`;
    }
    $(`#source`)[`val`](_0x1638C);
    src_change(doLog);
    return;
  }
  if ($(`text[type='lyric'][selected='selected']`)['length'] > 0) {
    var _0x171C9 = $(`text[type='lyric'][selected='selected']`);
    var _0x15EFA = $(_0x171C9)[`attr`](`lyric_istart`);
    var _0x16F26 = $(_0x171C9)[`attr`](`lyric_iend`);
    var _0x15C57 = $(`#source`)[`val`]();
    _0x15C57 =
      _0x15C57[`substring`](0, _0x15EFA) +
      `*` +
      _0x15C57[`substring`](_0x16F26);
    $(`#source`)[`val`](_0x15C57);
    doLog();
    src_change();
    return;
  }
  if (selectDecoInfo != null) {
    delSelectDeco();
    return;
  }
  if ($(`rect[type='startpoint']`)['length'] > 0) {
    var _0x16A3A = $(`rect[type='startpoint']`)[`attr`](`target`);
    var _0x172D7 = $(`#` + _0x16A3A)[`attr`](`type`);
    if (_0x172D7 == `bracketgch`) {
      var _0x17250 = $(`#` + _0x16A3A)[`attr`](`seq`);
      var _0x1727D = $(`#` + _0x16A3A)[`attr`](`subtype`);
      delBracketGch(_0x17250, _0x1727D);
    } else {
      delCuntomSlur();
    }
    return;
  }
  if (delObj == null) {
    if (typeof window[`top`][`swAutoAlert`] == `function`) {
      window[`top`][`swAutoAlert`](`请选中需删除的音符`);
    } else {
      window[`top`][`alert`](`请选中需删除的音符`);
    }
    return;
  }
  if (delObj[`click_obj`] == null) {
    return;
  }
  var _0x15EFA = $(delObj[`click_obj`])[`attr`](`istart`);
  if (!_0x15EFA) {
    return;
  }
  cen = syms[_0x15EFA];
  if (cen[`type`] == 14) {
    var _0x15C57 = $(`#source`)[`val`]();
    _0x15C57 = `%%hiddenspeed
` + _0x15C57;
    $(`#source`)[`val`](_0x15C57);
    src_change();
    doLog();
    return;
  }
  var _0x170E8 = cen[`notes`];
  if (!_0x170E8) {
    return;
  }
  var _0x15C57 = $(`#source`)[`val`]();
  if (_0x170E8['length'] == 1) {
    var _0x16AEE = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
    if (_0x16AEE[`indexOf`](`:`) > -1) {
      if (_0x16AEE[`indexOf`](`M:`) > -1) {
      } else {
        _0x15C57 =
          _0x15C57[`substr`](0, cen[`istart`]) +
          _0x15C57[`substr`](cen[`iend`]);
      }
      $(`#source`)[`val`](_0x15C57);
      src_change();
      return;
    }
    var _0x17331 = _0x16AEE[`replace`](/[[]_^=,']/g, ``)[
      `replace`
    ](/[a-gA-G]/, `z,`);
    if (cen[`type`] == 10) {
    } else {
      if (cen[`grace`]) {
        var _0x1719C = -1;
        var _0x17061 = -1;
        for (var _0x15CDE = cen[`istart`] - 1; _0x15CDE > 0; _0x15CDE--) {
          var _0x16D91 = _0x15C57[`charAt`](_0x15CDE);
          if (_0x16D91 != ` `) {
            _0x1719C = _0x15CDE;
            break;
          }
        }
        for (
          var _0x15CDE = cen[`iend`] + 1;
          _0x15CDE < syms['length'];
          _0x15CDE++
        ) {
          var _0x16D91 = _0x15C57[`charAt`](_0x15CDE);
          if (_0x16D91 != ` `) {
            _0x17061 = _0x15CDE;
            break;
          }
        }
        var _0x16E45 = _0x15C57[`substring`](_0x1719C, _0x17061);
        var _0x17115 = _0x15C57[`substring`](
          cen[`istart`],
          cen[`iend`]
        );
        if (
          _0x16E45[`replace`](/s/, ``)[`replace`](
            /[{}]/g,
            ``
          ) == _0x17115
        ) {
          var _0x167F1 = _0x16E45[`replace`](/{.*}/, ``);
          if (cen[`sl2`]) {
            var _0x17142 = -1,
              _0x17034 = -1;
            for (var _0x15CDE = _0x1719C; _0x15CDE > _0x1719C - 5; _0x15CDE--) {
              var _0x16D91 = _0x15C57[`charAt`](_0x15CDE);
              if (_0x16D91 == `(`) {
                _0x17142 = _0x15CDE;
                break;
              }
            }
            for (_0x15CDE = _0x17061; _0x15CDE < _0x17061 + 5; _0x15CDE++) {
              var _0x16D91 = _0x15C57[`charAt`](_0x15CDE);
              if (_0x16D91 == `)`) {
                _0x17034 = _0x15CDE;
              }
            }
            var _0x172AA = _0x15C57[`substring`](_0x17142 + 1, _0x17034);
            _0x15C57 =
              _0x15C57[`substr`](0, _0x17142) +
              _0x172AA[`replace`](/{.*}/, ``) +
              _0x15C57[`substr`](_0x17034 + 1);
          } else {
            _0x15C57 =
              _0x15C57[`substr`](0, _0x1719C) +
              _0x167F1 +
              _0x15C57[`substr`](_0x17061);
          }
        } else {
          _0x15C57 =
            _0x15C57[`substr`](0, cen[`istart`]) +
            _0x15C57[`substr`](cen[`iend`]);
        }
      } else {
        _0x15C57 =
          _0x15C57[`substr`](0, cen[`istart`]) +
          _0x17331 +
          _0x15C57[`substr`](cen[`iend`]);
      }
    }
    $(`#source`)[`val`](_0x15C57);
    src_change();
    doLog();
  } else {
    if (_0x170E8['length'] > 1) {
      var _0x16AEE = _0x15C57[`substring`](
        cen[`istart`],
        cen[`iend`]
      );
      var _0x1708E = str2notes(_0x16AEE);
      var _0x16FDA = ``;
      var _0x16C56 = $(delObj[`click_obj`])
      [`parents`](`svg`)
      [`find`](
        `text[type='hd'].` +
        _0x15EFA +
        `,text[type='Hd'].` +
        _0x15EFA +
        `,text[type='HD'].` +
        _0x15EFA +
        `,text[type='note'][istart='` +
        _0x15EFA +
        `']`
      )
      [`sort`](function (_0x1735E, _0x1738B) {
        return (
          $(_0x1738B)[`attr`](`y`) -
          $(_0x1735E)[`attr`](`y`)
        );
      });
      var _0x16E18 = $(delObj[`click_obj`])[`attr`](`y`);
      var _0x16E9F = false;
      for (var _0x15CDE = 0; _0x15CDE < _0x16C56['length']; _0x15CDE++) {
        if (
          _0x16E18 == $(_0x16C56[_0x15CDE])[`attr`](`y`) &&
          !_0x16E9F
        ) {
          _0x16E9F = true;
        } else {
          _0x16FDA += _0x1708E[_0x15CDE][`note`];
        }
      }
      var _0x168A5 = 0;
      if (_0x170E8['length'] == 2) {
        _0x168A5 = 1;
      }
      _0x16FDA =
        _0x16AEE[`substring`](
          0,
          _0x16AEE[`indexOf`](`[`) + 1 - _0x168A5
        ) +
        _0x16FDA +
        _0x16AEE[`substring`](_0x16AEE[`indexOf`](`]`) + _0x168A5);
      _0x15C57 =
        _0x15C57[`substr`](0, cen[`istart`]) +
        _0x16FDA +
        _0x15C57[`substr`](cen[`iend`]);
      $(`#source`)[`val`](_0x15C57);
      src_change();
      doLog();
    }
  }
}
function delCuntomSlur() {
  var _0x16A3A = $(`rect[type='startpoint']`)[`attr`](`target`);
  var _0x16986 = $(`path[id='` + _0x16A3A + `']`);
  var _0x169E0 = $(_0x16986)[`attr`](`ss_istart`);
  var _0x16959 = $(_0x16986)[`attr`](`es_istart`);
  var _0x169B3 = syms[_0x169E0];
  var _0x1692C = syms[_0x16959];
  var _0x16A0D = `"` + getGch(_0x169B3, `(slur-`) + `"`;
  var _0x168FF = `"` + getGch(_0x1692C, `)slur-`) + `"`;
  var _0x15C57 = $(`#source`)[`val`]();
  _0x15C57 = _0x15C57[`replace`](_0x16A0D, ``)[`replace`](
    _0x168FF,
    ``
  );
  $(`#source`)[`val`](_0x15C57);
  doLog();
  src_change();
}
function delSelectDeco() {
  var _0x15FDB = $(selectDecoInfo)[`attr`](`type`);
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x1638C = ``;
  if (_0x15FDB[`indexOf`](`sd8`) == 0) {
    var _0x15EFA = $(selectDecoInfo)[`attr`](`istart`);
    var _0x16C83 = _0x15C57[`substring`](0, _0x15EFA);
    _0x16C83 = replaceLast(_0x16C83, `!showsd8!`, ``);
    var _0x16D37 = _0x15C57[`substring`](_0x15EFA);
    _0x1638C = _0x16C83 + _0x16D37;
  } else {
    if (eqs(`jq,jr,slur,8va,8vb,15ma,15mb`, _0x15FDB)) {
      var _0x16C83, _0x16BFC, _0x16D37;
      var _0x16D0A = deco_params[_0x15FDB][`start`];
      var _0x16BCF = deco_params[_0x15FDB][`end`];
      var _0x16CB0 = $(selectDecoInfo)[`attr`](`start`);
      var _0x16B75 = $(selectDecoInfo)[`attr`](`end`);
      _0x16D0A = _0x16D0A[`replace`](`(`, `\\(`)[
        `replace`
      ](`)`, `\\)`);
      _0x16BCF = _0x16BCF[`replace`](`(`, `\\(`)[
        `replace`
      ](`)`, `\\)`);
      var _0x16D64 = -1;
      if (parseInt(_0x16B75) < parseInt(_0x16CB0)) {
        _0x16D64 = _0x16CB0 + 0;
        _0x16CB0 = _0x16B75 + 0;
        _0x16B75 = _0x16D64;
      }
      var _0x16CDD = new RegExp(`([\\s\\S]*)(` + _0x16D0A + `)`);
      var _0x16BA2 = new RegExp(`(.*)(` + _0x16BCF + `)`);
      _0x16C83 = _0x15C57[`substring`](0, _0x16CB0);
      var _0x16C29 = _0x16CDD[`exec`](_0x16C83);
      _0x16C83 = _0x16C83[`replace`](_0x16CDD, `$1`);
      _0x16BFC = _0x15C57[`substring`](_0x16CB0, _0x16B75);
      if (_0x15FDB == `slur`) {
        _0x16D37 = _0x15C57[`substr`](_0x16B75)[`replace`](
          `)`,
          ``
        );
      } else {
        _0x16BFC = _0x16BFC[`replace`](_0x16BA2, `$1`);
        _0x16D37 = _0x15C57[`substr`](_0x16B75);
      }
      _0x1638C = _0x16C83 + _0x16BFC + _0x16D37;
      switch (_0x15FDB) {
        case `jq`:
          _0x15FDB = `cresc`;
          break;
        case `jr`:
          _0x15FDB = `dim`;
          break;
      }
      _0x1638C = delDecoPosInfo(_0x1638C, syms[_0x16B75], _0x15FDB);
    } else {
      if (eqs(`0,1,2,3,4,5`, _0x15FDB)) {
        var _0x15EFA = $(selectDecoInfo)[`attr`](`istart`);
        var _0x16170 = syms[_0x15EFA];
        if (_0x16170) {
          var _0x16B48 = getA_ddInfo(_0x16170, `fng`);
          for (var _0x15CDE = 0; _0x15CDE < _0x16B48['length']; _0x15CDE++) {
            var _0x16B1B = _0x16B48[_0x15CDE];
            if (_0x16B1B[`str`] == _0x15FDB) {
              _0x1638C =
                _0x15C57[`substring`](0, _0x16B1B[`istart`]) +
                _0x15C57[`substring`](_0x16B1B[`iend`]);
              _0x1638C = delDecoPosInfo(_0x1638C, syms[_0x15EFA], _0x15FDB);
              break;
            }
          }
        }
      } else {
        if (_0x15FDB == `tubrn`) {
          var _0x15EFA = $(selectDecoInfo)[`attr`](`istart`);
          var _0x16C56 = deco_params[_0x15FDB];
          var _0x16AEE = ``;
          if (_0x16C56) {
            _0x16AEE = deco_params[_0x15FDB][`start`];
          }
          _0x16AEE = _0x16AEE[`replace`](`(`, `\\(`)
          [`replace`](`)`, `\\)`)
          [`replace`](/./g, `\\.`);
          var _0x16CDD = new RegExp(`(.*)` + _0x16AEE);
          var _0x16C83;
          _0x16C83 = _0x15C57[`substring`](0, _0x15EFA);
          _0x16C83 = _0x16C83[`replace`](_0x16CDD, `$1`);
          _0x1638C = _0x16C83 + _0x15C57[`substring`](_0x15EFA);
          _0x1638C = delDecoPosInfo(_0x1638C, syms[_0x15EFA], _0x15FDB);
        } else {
          if (
            abc2svg[`diag`] &&
            abc2svg[`diag`][`cd`][_0x15FDB]
          ) {
            var _0x15EFA = $(selectDecoInfo)[`attr`](`istart`);
            var _0x16170 = syms[_0x15EFA];
            var _0x16AC1 = _0x16170[`a_gch`];
            if (_0x16AC1) {
              for (
                var _0x15CDE = 0;
                _0x15CDE < _0x16AC1['length'];
                _0x15CDE++
              ) {
                if (_0x16AC1[_0x15CDE][`text`] == _0x15FDB) {
                  _0x1638C =
                    _0x15C57[`substring`](0, _0x16AC1[_0x15CDE][`istart`]) +
                    _0x15C57[`substring`](_0x16AC1[_0x15CDE][`iend`]);
                  _0x1638C = delDecoPosInfo(_0x1638C, syms[_0x15EFA], _0x15FDB);
                }
              }
            }
          } else {
            var _0x15EFA = $(selectDecoInfo)[`attr`](`istart`);
            var _0x16170 = syms[_0x15EFA];
            if (_0x16170) {
              var _0x16B48 = getA_ddInfo(_0x16170, _0x15FDB);
              if (_0x16B48['length'] > 0) {
                var _0x16B1B = _0x16B48[0];
                _0x1638C =
                  _0x15C57[`substring`](0, _0x16B1B[`istart`]) +
                  _0x15C57[`substring`](_0x16B1B[`iend`]);
                _0x1638C = delDecoPosInfo(_0x1638C, syms[_0x15EFA], _0x15FDB);
              }
            }
          }
        }
      }
    }
  }
  if (_0x1638C == ``) {
    return;
  }
  $(`#source`)[`val`](_0x1638C);
  doLog();
  src_change();
  return;
}
function delDecoPosInfo(_0x16AEE, _0x16170, _0x15FDB) {
  var _0x16A94 = getDecoPos(_0x16170[`istart`], _0x15FDB);
  if (_0x16A94) {
    var _0x16A67 = _0x16170[`a_gch`];
    for (var _0x15CDE = 0; _0x15CDE < _0x16A67['length']; _0x15CDE++) {
      var _0x16AC1 = _0x16A67[_0x15CDE];
      if (_0x16AC1[`text`][`indexOf`](`{'gchtype':`) > -1) {
        _0x16AEE = _0x16AEE[`replace`](
          `"` + _0x16AC1[`text`] + `"`,
          ``
        );
      }
    }
  }
  return _0x16AEE;
}
var d_reg = /m(.*)v/;
function graphMouseMoveHandle(_0x16062) {
  var _0x1A5FE = new Date()[`getTime`]();
  if (_0x1A5FE - clickTimeMill < 200) {
    return;
  }
  var _0x15C57 = $(`#source`)[`val`]();
  if (musicType == `2`) {
    var _0x1962C = getSelectText(`source`);
    if (_0x1962C == ``) {
      var _0x1A7ED = $(`.selected_text[type='note']`);
      if (_0x1A7ED['length'] > 0) {
        var _0x1A6B2 = $(_0x1A7ED)[`attr`](`istart`);
        var _0x16170 = syms[_0x1A6B2];
        if (_0x16170) {
          _0x1962C = _0x15C57[`substring`](
            _0x16170[`istart`],
            _0x16170[`iend`]
          );
        }
      }
    }
    if (_0x1962C != `` && dragNumNoteFlag) {
      try {
        numStaffDrag(_0x16062);
      } catch (_0x16062) {
        console[`log`](_0x16062);
      }
    }
    return;
  }
  if (select_note_info == null || select_note_info[`click_obj`] == null) {
    return;
  }
  if (rest) {
    return;
  }
  if ($(select_note_info[`click_obj`])[`attr`](`type`)) {
    if (
      $(select_note_info[`click_obj`])
      [`attr`](`type`)
      [`indexOf`](`r`) == 0
    ) {
      return;
    }
  }
  var _0x17688 = _0x16062[`target`];
  if (_0x17688[`tagName`][`toLowerCase`]() == `rect`) {
    _0x17688 = $(_0x17688)[`parents`](`svg`);
  } else {
    _0x17688 = $(_0x17688);
  }
  if (_0x16062[`touches`]) {
    _0x16062[`offsetX`] =
      _0x16062[`touches`][0][`pageX`] -
      _0x17688[`offset`]()[`left`];
    _0x16062[`offsetY`] =
      _0x16062[`touches`][0][`pageY`] -
      _0x17688[`offset`]()[`top`];
  }
  var _0x176B5 = getYinfo(
    $(select_note_info[`click_obj`])[`parents`](`svg`),
    _0x16062[`offsetY`] / scale
  );
  console[`log`](_0x176B5);
  if (_0x176B5 == null || !_0x176B5) {
    return;
  }
  if (!_0x176B5 || _0x176B5 == null || _0x176B5 == undefined) {
    return;
  }
  var _0x15EFA = $(select_note_info[`click_obj`])[`attr`](`istart`);
  if (syms[_0x15EFA] && syms[_0x15EFA][`type`] == 14) {
    return;
  }
  $(`use[type='demo_hl']`)[`remove`]();
  $(select_note_info[`click_obj`])[0][`setAttribute`](
    `y`,
    _0x176B5[`y`]
  );
  var _0x16E18 = $(select_note_info[`click_obj`])[`attr`](`y`);
  var _0x16986 = $(`path[type='stem'][istart='` + _0x15EFA + `']`);
  cen = syms[_0x15EFA];
  if (!cen) {
    return;
  }
  if (cen && cen[`notes`] && cen[`notes`]['length'] == 1) {
    if (_0x16986['length'] > 0) {
      var _0x17BA1 = $(_0x16986)[`attr`](`d`);
      var _0x1A793 = /m(.*)v/;
      var _0x1A766 = _0x17BA1[`match`](_0x1A793);
      var _0x1A739 = _0x1A766[1];
      var _0x1A6DF = _0x1A739[`split`](` `);
      var _0x1A7C0 = _0x17BA1[`replace`](
        _0x1A739,
        _0x1A6DF[0] + ` ` + _0x16E18
      );
      $(_0x16986)[`attr`](`d`, _0x1A7C0);
    }
    var _0x1A62B = $(
      `text[type^='flu'][istart='` + _0x15EFA + `'],text[type^='fld'][istart='` + _0x15EFA + `']`
    );
    if (_0x1A62B['length'] > 0) {
      var _0x1A658 = $(_0x1A62B)[`attr`](`ori_y`);
      if (!_0x1A658) {
        $(_0x1A62B)[`attr`](
          `ori_y`,
          $(_0x1A62B)[`attr`](`y`)
        );
      }
      var _0x1843E = parseFloat(
        $(select_note_info[`click_obj`])[`attr`](`ori_y`)
      );
      var _0x1A70C = parseFloat(_0x16E18) - _0x1843E;
      var _0x1A685 = parseFloat($(_0x1A62B)[`attr`](`ori_y`));
      $(_0x1A62B)[`attr`](`y`, _0x1A685 + _0x1A70C);
    }
  }
  cen[`mouse_pos`] = _0x176B5[`mouse_pos`];
  var _0x1A81A = $(cen)[`attr`](`x`);
  if (_0x176B5) {
    var _0x175D4 = _0x176B5[`num`];
    console[`log`](`lineNum:`, _0x175D4);
    if (_0x175D4 != 0) {
      draw_short_line(
        _0x175D4,
        parseFloat($(select_note_info[`click_obj`])[`attr`](`x`)),
        _0x176B5,
        $(_0x17688)[`parents`](`svg`)
      );
    }
  }
  console[`log`](`graphMouseMoveHandle-end:`, new Date()[`getTime`]());
  rest = true;
  setTimeout(function () {
    rest = false;
  }, 33);
}
var note_reg = /(^){0,2}(_){0,2}(=){0,1}[A-Ya-y][,'/|1-9]*/g;
var staff_order = [
  `c`,
  `d`,
  `e`,
  `f`,
  `g`,
  `a`,
  `b`,
];
function str2notes(_0x16AEE) {
  var _0x170E8 = _0x16AEE[`match`](note_reg);
  var _0x1B8FA = new Array();
  if (_0x170E8 != null) {
    for (var _0x15CDE = 0; _0x15CDE < _0x170E8['length']; _0x15CDE++) {
      var _0x18AEC = _0x170E8[_0x15CDE];
      var _0x18D35 = findIndexByNote(_0x18AEC[`replace`](/d/, ``));
      var _0x17AED = new Object();
      _0x17AED[`note`] = _0x18AEC;
      _0x17AED[`index`] = _0x18D35;
      _0x1B8FA[`push`](_0x17AED);
    }
  }
  return _0x1B8FA[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1735E[`index`] - _0x1738B[`index`];
  });
}
function synStem(_0x16170, _0x1BA62, _0x1B9AE) {
  if (_0x16170[`beam_st`] && _0x16170[`beam_end`]) {
    if ($(_0x1BA62)['length'] > 0) {
      var _0x17BA1 = $(_0x1BA62)[`attr`](`d`);
      var _0x168A5 = d_reg[`exec`](_0x17BA1);
      if (_0x168A5 != null) {
        if (_0x16170[`notes`]['length'] == 0) {
          var _0x1BA35 = _0x168A5[1];
          var _0x1B9DB = _0x168A5[1];
          var _0x17B47 = _0x1B9DB[`split`](` `);
          var _0x1BA08 = 0;
          if (_0x17B47['length'] > 0) {
            _0x1BA08 = parseFloat(_0x17B47[1]) - _0x1B9AE;
          }
          _0x17BA1 = _0x17BA1[`replace`](
            _0x1BA35,
            _0x17B47[0] + ` ` + _0x1BA08
          );
        } else {
        }
      }
      $(_0x1BA62)[0][`setAttribute`](`d`, _0x17BA1);
    }
  }
}
function synTail(_0x16170, _0x1BA8F, _0x1B9AE) {
  if ($(_0x1BA8F)['length'] > 0) {
    $(_0x1BA8F)[0][`setAttribute`](
      `y`,
      parseFloat($(_0x1BA8F)[`attr`](`y`)) - _0x1B9AE
    );
  }
}
function graphMouseUpHandle(_0x16062) {
  console.log(_0x16062)
  var _0x1A5FE = new Date()[`getTime`]();
  if (_0x1A5FE - clickTimeMill < 200) {
    select_note_info = null;
    return;
  }
  console[`log`](`graphMouseUpHandle:`, select_note_info);
  if (select_note_info != null && cen != null) {
    if (cen[`type`] == 0) {
      return;
    }
    var notes = cen[`notes`];
    var sourceVal = $(`#source`)[`val`]();
    var isStart = $(select_note_info[`click_obj`])[`attr`](`istart`);
    var oldY = $(select_note_info[`click_obj`])[`attr`](`ori_y`);
    var newY = $(select_note_info[`click_obj`])[`attr`](`y`);
    if (oldY && oldY == newY) {
      select_note_info = null;
      return;
    }
    if (notes && notes['length'] == 1) {
      var _0x18C81 = getNewNote(cen);
      console[`log`](`noteobj:`, _0x18C81[`note`]);
      var _0x18AEC = _0x18C81[`note`];
      var _0x18C54 = genNoteAndDur(_0x18AEC, cen);
      _0x18C54[`note`] = _0x18AEC;
      update_note_istart = isStart;
      update_note_index = 0;
      console[`log`](`2:graphMouseMoveHandle-start:`, new Date()[`getTime`]());
      replaceNote(`source`, cen[`istart`], cen[`iend`], _0x18C54);
    } else {
      var _0x1846B = $(select_note_info[`click_obj`])[`attr`](
        `update_index`
      );
      if (!_0x1846B) {
        select_note_info = null;
        return;
      }
      var _0x18C81 = getNewNote(cen);
      var _0x18AEC = _0x18C81[`note`];
      update_note_istart = isStart;
      var _0x16AEE = sourceVal[`substring`](
        cen[`istart`],
        cen[`iend`]
      );
      var _0x1708E = str2notes(_0x16AEE);
      var _0x1881C = ``;
      if (_0x1708E[0] != ``) {
        _0x1881C = _0x1708E[0][`note`]
        [`replace`](/[a-zA-Z]/g, ``)
        [`replace`](/[,'=^_]/g, ``);
      }
      var _0x16FDA = ``;
      for (var _0x15CDE = 0; _0x15CDE < _0x1708E['length']; _0x15CDE++) {
        if (_0x15CDE != parseInt(_0x1846B)) {
          _0x16FDA += _0x1708E[_0x15CDE][`note`];
        } else {
          _0x16FDA += _0x18AEC + _0x1881C;
        }
      }
      var _0x1A874 = str2notes(_0x16FDA);
      _0x16FDA = ``;
      for (var _0x15CDE = 0; _0x15CDE < _0x1A874['length']; _0x15CDE++) {
        _0x16FDA += _0x1A874[_0x15CDE][`note`];
      }
      _0x16FDA =
        _0x16AEE[`substring`](0, _0x16AEE[`indexOf`](`[`) + 1) +
        _0x16FDA +
        _0x16AEE[`substring`](_0x16AEE[`indexOf`](`]`));
      sourceVal =
        sourceVal[`substr`](0, cen[`istart`]) +
        _0x16FDA +
        sourceVal[`substr`](cen[`iend`]);
      if (_0x16FDA != _0x16AEE) {
        $(`#source`)[`val`](sourceVal);
        doLog();
        render();
      }
    }
  }
  select_note_info = null;
}
function restoreRest() {
  if ($(`.reststatus`)[`hasClass`](`selected`)) {
    $(`.reststatus`)[`click`]();
  }
}
function restoreChord() {
  if ($(`.chord.selected`)['length'] > 0) {
    $(`.chord.selected`)[`click`]();
  }
}
var dragObj = null;
// TODO
function initDecoDrag() {
  var _0x1A928 = false;
  var _0x1A8FB = false;
  var _0x1A955 = null;
  var cmenuClass = `.cmenu`;
  $(cmenuClass)[`attr`](`draggable`, false);
  $(cmenuClass)[`off`](`touchstart`)[`on`](`touchstart`, _0x1A8A1);
  $(cmenuClass)[`off`](`mousedown`)[`mousedown`](_0x1A8A1);
  function _0x1A8A1(dragEl) {
    if ($(`rect[type='startpoint']`)['length'] > 0) {
      src_change();
    }
    if ($(`#graphEditorMenuInsert`)[`hasClass`](`menu-pressed`)) {
      graph_update = true;
      draw_editor = false;
      $(`#use_black`)[`remove`]();
      if ($(`#graphEditorMenuInsert`)) {
        $(`#graphEditorMenuInsert`)[`removeClass`](`menu-pressed`);
      }
      if ($(`#graphEditorMenuUpdate`)) {
        $(`#graphEditorMenuUpdate`)[`addClass`](`menu-pressed`);
      }
      $(`#selectedStatus`)[`removeClass`](`menu-pressed`);
    }
    var _0x1A9DC = dragEl[`touches`]
      ? dragEl[`touches`][0][`pageX`]
      : dragEl[`pageX`];
    var _0x1AA09 = dragEl[`touches`]
      ? dragEl[`touches`][0][`pageY`]
      : dragEl[`pageY`];
    var _0x1A9AF = dragEl[`touches`] ? `touchmove` : `mousemove`;
    var _0x193B6 = dragEl[`touches`] ? `touchend` : `mouseup`;
    var $that = $(this);
    dragObj = this;
    var _0x1AA36 = $that[`attr`](`src`);
    _0x1A955 = setTimeout(function () {
      isSelectDeco = true;
      var _0x1AB71 = {
        left: $(`#target`)[`offset`]()[`left`],
        top: $(`#target`)[`offset`]()[`top`],
        width: $(`#target`)[`width`](),
        height: $(`#target`)[`height`](),
      };
      var _0x1AAEA = true;
      var _0x1AABD = `<img draggable="false" ondragstart="return false;" src="_src" class="drag-note-img" style="top:_top;left:_left;"/>`;
      var code = $that[`attr`](`data-code`);
      var type = $that[`attr`](`data-type`);
      var musicType = $that[`attr`](`data-music-type`);
      var value = $that[`attr`](`value`);
      var value2 = $that[`attr`](`value2`);
      var dur = $that[`attr`](`dur`);
      var knowId = $that[`attr`](`data-know-id`);
      var position = $that[`attr`](`position`);
      var type = $that[`attr`](`type`);
      console[`log`](`----------`, type);
      selectDecoType = type;
      var _0x1AA63 = $that[`attr`](`class`);
      if (typeof draw_editor != undefined) {
        draw_editor = true;
      }
      _0x1AABD = _0x1AABD[`replace`](`_top`, _0x1AA09 + `px`)
      [`replace`](`_left`, _0x1A9DC + `px`)
      [`replace`](`_src`, _0x1AA36);
      $(`.drag-note-img`)[`remove`]();
      $(`body`)[`append`](_0x1AABD);
      if (dragEl && dragEl[`stopPropagation`]) {
        dragEl[`stopPropagation`]();
      } else {
        window[`event`][`cancelBubble`] = true;
      }
      $(document)
      [`off`](_0x1A9AF)
      [`on`](_0x1A9AF, function (_0x16062) {
        _0x1A9DC = _0x16062[`touches`]
          ? _0x16062[`touches`][0][`pageX`]
          : _0x16062[`pageX`];
        _0x1AA09 = _0x16062[`touches`]
          ? _0x16062[`touches`][0][`pageY`]
          : _0x16062[`pageY`];
        if (_0x1AAEA) {
          $(`.drag-note-img`)[`css`]({ top: _0x1AA09, left: _0x1A9DC });
          if (
            _0x1A9DC > _0x1AB71[`left`] &&
            _0x1A9DC < _0x1AB71[`left`] + _0x1AB71[`width`] &&
            _0x1AA09 > _0x1AB71[`top`] &&
            _0x1AA09 < _0x1AB71[`top`] + _0x1AB71[`height`]
          ) {
            _0x1A928 = false;
            _0x1A8FB = true;
            if (_0x16062[`touches`]) {
              var _0x1ABF8 = $(`svg`);
              for (
                var _0x15CDE = 0;
                _0x15CDE < _0x1ABF8['length'];
                _0x15CDE++
              ) {
                var _0x1646D = _0x1ABF8[`eq`](_0x15CDE);
                if (
                  _0x1A9DC > _0x1646D[`offset`]()[`left`] &&
                  _0x1AA09 > _0x1646D[`offset`]()[`top`] &&
                  _0x1A9DC <
                  _0x1646D[`offset`]()[`left`] +
                  _0x1646D[`width`]() &&
                  _0x1AA09 <
                  _0x1646D[`offset`]()[`top`] +
                  _0x1646D[`height`]()
                ) {
                  _0x16062[`target`] = _0x1646D[0];
                  break;
                }
              }
              var _0x17688 = _0x16062[`target`];
              _0x16062[`offsetX`] =
                _0x16062[`touches`][0][`pageX`] -
                $(_0x17688)[`offset`]()[`left`];
              _0x16062[`offsetY`] =
                _0x16062[`touches`][0][`pageY`] -
                $(_0x17688)[`offset`]()[`top`];
              console[`log`](`decoType:`, type);
              if (type == `linkclef`) {
                movingRenderStaff(_0x16062);
              } else {
                if (type == `nodeline`) {
                  moveingRenderBar(_0x16062);
                } else {
                  mousemovehandler(_0x16062);
                }
              }
            }
          }
        }
      })
      [`off`](_0x193B6)
      [`on`](_0x193B6, function (_0x16062) {
        _0x1AAEA = false;
        if (!isSelectDeco) {
          return;
        }
        $(`.drag-note-img`)[`remove`]();
        console[`log`](`---end`);
        dragObj = null;
        console[`log`](`value:`, value, `position`, position);
        genNoteDeco(value, value2, position, type);
        isSelectDeco = false;
        selectDecoType = ``;
        if (!$(`#graphEditorMenu`)[`hasClass`](`menu-pressed`)) {
          draw_editor = false;
        }
      });
    }, 200);
  }
  $(cmenuClass)
  [`off`](`mouseup`)
  [`mouseup`](function () {
    if (_0x1A955 != null) {
      clearTimeout(_0x1A955);
    }
    if (typeof draw_editor != undefined) {
      draw_editor = false;
    }
  })
  [`off`](`touchend`)
  [`on`](`touchend`, function () {
    if (_0x1A955 != null) {
      clearTimeout(_0x1A955);
    }
  });
}
function selectBar(_0x17688, _0x1A4C3, _0x199B0, _0x1B549) {
  if (graphEditor[`pianoImpro`] && graphEditor[`pianoImpro`][`isOpen`]) {
    return;
  }
  var _0x16008 = _0x1A4C3[`offsetX`];
  var _0x16035 = _0x1A4C3[`offsetY`];
  var _0x175D4 = $(_0x17688)[`attr`](`index`);
  var _0x1A2A7 = getClickBarIndex(_0x16008, _0x16035, _0x199B0, _0x175D4);
  if (_0x1A2A7 == -1) {
    return;
  }
  var _0x19875 = new Array();
  if (user[`isShift`]) {
    if (lastSelectBarIndex != -1) {
      var _0x1B5A3 = -1;
      if (lastSelectBarIndex > _0x1A2A7) {
        _0x1B5A3 = lastSelectBarIndex + 0;
        lastSelectBarIndex = _0x1A2A7;
        _0x1A2A7 = _0x1B5A3;
      }
      for (
        var _0x15CDE = lastSelectBarIndex;
        _0x15CDE <= _0x1A2A7;
        _0x15CDE++
      ) {
        var _0x1738B = new Object();
        _0x1738B[`bar_num`] = _0x15CDE;
        _0x1738B[`color`] = `red`;
        _0x1738B[`stroke`] = `red`;
        _0x19875[`push`](_0x1738B);
      }
    }
  } else {
    var _0x1738B = new Object();
    _0x1738B[`bar_num`] = _0x1A2A7;
    _0x1738B[`color`] = `red`;
    _0x1738B[`stroke`] = `red`;
    _0x19875[`push`](_0x1738B);
  }
  lastSelectBarIndex = _0x1A2A7;
  $(`svg[type='rectbar']`)[`remove`]();
  renderByBarIndex(_0x19875, `bar`);
  $(`#mysvgbar` + _0x1A2A7)[`attr`](`barIndex`, _0x1A2A7);
  if (!$(`#mysvgbar` + _0x1A2A7)[`offset`]()) {
    return;
  }
  var _0x1619D = $(`#mysvgbar` + _0x1A2A7)[`offset`]()[`top`];
  var _0x19BCC = $(`#mysvgbar` + _0x1A2A7)[`offset`]()[`left`];
  var _0x1B51C = getSelectBarContent(_0x1A2A7, 0);
  var _0x1B4EF = getPreBarInfo(_0x1A2A7, 0);
  if (_0x1B51C == null) {
    return;
  }
  if (
    _0x1B51C[`indexOf`](`$`) > -1 ||
    (_0x1B4EF && _0x1B4EF[`nextBr`])
  ) {
    $(`#btnAddBr`)[`html`](`取消换行`);
  } else {
    $(`#btnAddBr`)[`html`](`换行`);
  }
  if (_0x1A2A7 == 0) {
    $(`#btnAddBr`)[`hide`]();
    $(`#changeInstrBtn`)[`show`]();
    var _0x1B576 = getStaffInfo();
    if (_0x1B576[`vocalCount`] > 1) {
      $(`#delStaff`)[`show`]();
    } else {
      $(`#delStaff`)[`hide`]();
    }
  } else {
    $(`#changeInstrBtn`)[`hide`]();
    $(`#btnAddBr`)[`show`]();
    $(`#delStaff`)[`hide`]();
  }
  var _0x1673D = $(`.abc-content`)[`offset`]()[`top`];
  var _0x16710 = $(`.abc-content`)[`offset`]()[`left`];
  if (_0x1B549) {
    $(`#nodeMenu`)
    [`css`](`position`, `absolute`)
    [`css`](
      `top`,
      _0x1619D - _0x1673D - $(`#nodeMenu`)[`height`]()
    )
    [`css`](`left`, _0x19BCC - _0x16710);
    $(`#nodeMenu`)[`attr`](`barIndex`, _0x1A2A7);
  }
}
function selectNode(_0x17688, _0x1A4C3, _0x199B0, _0x1B549) {
  if (graphEditor[`pianoImpro`] && graphEditor[`pianoImpro`][`isOpen`]) {
    return;
  }
  var _0x16008 = _0x1A4C3[`offsetX`];
  var _0x16035 = _0x1A4C3[`offsetY`];
  var _0x175D4 = $(_0x17688)[`attr`](`index`);
  var _0x1B5FD = getClickNodeInfo(_0x16008, _0x16035, _0x199B0, _0x175D4);
  if (_0x1B5FD == null) {
    return;
  }
  var _0x1A2A7 = _0x1B5FD[`node_index`];
  var _0x1B5D0 = _0x1B5FD[`v`];
  var _0x1B62A = $(_0x17688)[`find`](`g[type='staff']`)['length'];
  var _0x19875 = new Array();
  if (_0x1A4C3[`shiftKey`]) {
    if (lastSelectBarIndex != -1) {
      var _0x1B5A3 = -1;
      if (lastSelectBarIndex > _0x1A2A7) {
        _0x1B5A3 = lastSelectBarIndex + 0;
        lastSelectBarIndex = _0x1A2A7;
        _0x1A2A7 = _0x1B5A3;
      }
      for (
        var _0x15CDE = lastSelectBarIndex;
        _0x15CDE <= _0x1A2A7;
        _0x15CDE++
      ) {
        if (_0x1B5D0 == lastSelectNodeV) {
          var _0x1738B = new Object();
          _0x1738B[`bar_num`] = _0x15CDE;
          _0x1738B[`color`] = `red`;
          _0x1738B[`stroke`] = `red`;
          _0x1738B[`v`] = _0x1B5D0;
          _0x19875[`push`](_0x1738B);
        } else {
          selectBar(_0x17688, _0x1A4C3, _0x199B0, _0x1B549);
          return;
        }
      }
    }
  } else {
    var _0x1738B = new Object();
    _0x1738B[`bar_num`] = _0x1B5FD[`node_index`];
    _0x1738B[`v`] = _0x1B5FD[`v`];
    _0x1738B[`color`] = `red`;
    _0x1738B[`stroke`] = `red`;
    _0x19875[`push`](_0x1738B);
  }
  lastSelectBarIndex = _0x1A2A7;
  lastSelectNodeV = _0x1B5D0;
  $(`svg[type='rectbar']`)[`remove`]();
  renderStaffNodeBySt(_0x19875, `node`);
  $(`#mysvgnode` + _0x1B5D0 + `_` + _0x1A2A7)[`attr`](
    `barIndex`,
    _0x1A2A7
  );
  var _0x1619D = $(`#mysvgnode` + _0x1B5D0 + `_` + _0x1A2A7)[
    `offset`
  ]()[`top`];
  var _0x19BCC = $(`#mysvgnode` + _0x1B5D0 + `_` + _0x1A2A7)[
    `offset`
  ]()[`left`];
  var _0x1B51C = getSelectBarContent(_0x1A2A7, 0);
  var _0x1B4EF = getPreBarInfo(_0x1A2A7, 0);
  if (_0x1B51C == null) {
    return;
  }
  if (
    _0x1B51C[`indexOf`](`$`) > -1 ||
    (_0x1B4EF && _0x1B4EF[`nextBr`])
  ) {
    $(`#btnAddBr`)[`html`](`取消换行`);
    $(`#notebr`)[`prop`](`checked`, true);
  } else {
    $(`#btnAddBr`)[`html`](`换行`);
    $(`#notebr`)[`prop`](`checked`, false);
  }
  if (_0x1A2A7 == 0) {
    $(`#btnAddBr`)[`hide`]();
    var _0x1B576 = getStaffInfo();
    $(`#changeInstrBtn`)[`show`]();
    if (_0x1B576[`vocalCount`] > 1) {
      $(`#delStaff`)[`show`]();
    } else {
      $(`#delStaff`)[`hide`]();
    }
  } else {
    $(`#changeInstrBtn`)[`hide`]();
    $(`#btnAddBr`)[`show`]();
    $(`#delStaff`)[`hide`]();
  }
  var _0x1673D = $(`.abc-content`)[`offset`]()[`top`];
  var _0x16710 = $(`.abc-content`)[`offset`]()[`left`];
  if (_0x1B549) {
    $(`#nodeMenu`)
    [`css`](`position`, `absolute`)
    [`css`](
      `top`,
      _0x1619D - _0x1673D - $(`#nodeMenu`)[`height`]()
    )
    [`css`](`left`, _0x19BCC - _0x16710)
    [`show`]();
    $(`#nodeMenu`)[`attr`](`barIndex`, _0x1A2A7);
  }
}
function getSelectNodeContent(_0x1A2A7, _0x185A6) {
  var _0x168D2 = new RegExp(`.*%V` + _0x185A6 + `end`);
  var _0x1A2D4 = $(`#source`)[`val`]()[`match`](_0x168D2);
}
var lastSelectBarIndex = -1;
var lastSelectNodeV = -1;
function getClickBarIndex(_0x16008, _0x16035, _0x199B0, _0x175D4) {
  var _0x198CF = getBarLineCoor(_0x199B0);
  for (var _0x15CDE = 0; _0x15CDE < _0x198CF['length']; _0x15CDE++) {
    if (_0x198CF[_0x15CDE][`line`] == parseInt(_0x175D4)) {
      var _0x199DD = _0x198CF[_0x15CDE][`barline_start`][0];
      var _0x19A37 = _0x198CF[_0x15CDE][`barline_start`][1];
      var _0x19A0A = _0x198CF[_0x15CDE][`barline_start`][2];
      var _0x19A64 = _0x198CF[_0x15CDE][`barline_start`][3];
      var _0x198FC = _0x198CF[_0x15CDE][`barline_end`][0];
      var _0x19956 = _0x198CF[_0x15CDE][`barline_end`][1];
      var _0x19929 = _0x198CF[_0x15CDE][`barline_end`][2];
      var _0x19983 = _0x198CF[_0x15CDE][`barline_end`][3];
      if (
        _0x16008 >= _0x199DD &&
        _0x16008 <= _0x198FC &&
        _0x16035 >= _0x19A37 &&
        _0x16035 <= _0x19A64
      ) {
        return _0x15CDE;
      }
    }
  }
  return -1;
}
function getClickNodeInfo(_0x16008, _0x16035, _0x199B0, _0x175D4) {
  var _0x19A91 = getStaffNodeCoor(_0x199B0);
  for (var _0x15CDE = 0; _0x15CDE < _0x19A91['length']; _0x15CDE++) {
    if (_0x19A91[_0x15CDE][`line`] == parseInt(_0x175D4)) {
      var _0x199DD = _0x19A91[_0x15CDE][`nodeline_start`][0];
      var _0x19A37 = _0x19A91[_0x15CDE][`nodeline_start`][1];
      var _0x19A0A = _0x19A91[_0x15CDE][`nodeline_start`][2];
      var _0x19A64 = _0x19A91[_0x15CDE][`nodeline_start`][3];
      var _0x198FC = _0x19A91[_0x15CDE][`nodeline_end`][0];
      var _0x19956 = _0x19A91[_0x15CDE][`nodeline_end`][1];
      var _0x19929 = _0x19A91[_0x15CDE][`nodeline_end`][2];
      var _0x19983 = _0x19A91[_0x15CDE][`nodeline_end`][3];
      if (
        _0x16008 >= _0x199DD &&
        _0x16008 <= _0x198FC &&
        _0x16035 >= _0x19A37 &&
        _0x16035 <= _0x19A64
      ) {
        return _0x19A91[_0x15CDE];
      }
    }
  }
  return null;
}
function setBarsPerstaffWithLineBreak() {
  var _0x15BFD = $(`#nodeMenu`)[`attr`](`barIndex`);
}
function genTremlo(_0x16170, _0x16251) {
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x1981B = _0x16170[`prev`];
  var _0x17007 = _0x16170[`next`];
  var _0x19794 = ``;
  var _0x19578 = ``;
  var _0x19848 = ``;
  var _0x1638C = ``;
  if (_0x1981B) {
    _0x19578 = _0x15C57[`substring`](0, _0x1981B[`iend`]);
    _0x1638C = _0x19578;
    _0x19794 = _0x15C57[`substring`](
      _0x1981B[`iend`],
      _0x16170[`istart`]
    );
    _0x19794 = _0x19794[`replace`](/![/]*-!/, ``);
    _0x1638C += _0x19794;
    var _0x19767 = _0x15C57[`substring`](
      _0x16170[`istart`],
      _0x16170[`iend`]
    );
    _0x19767 = _0x19767[`replace`](/d/g, ``)[`replace`](
      /[/]/g,
      ``
    );
    var _0x1973A = getDurStrByNoteDur(
      _0x16170[`dur`] * 2,
      _0x16170[`my_ulen`]
    );
    if (_0x1973A == `1`) {
      _0x1973A = ``;
    }
    _0x19767 = _0x19767 + _0x1973A;
    _0x1638C += _0x16251 + _0x19767;
    var _0x197EE = _0x15C57[`substring`](
      _0x17007[`istart`],
      _0x17007[`iend`]
    );
    _0x197EE = _0x197EE[`replace`](/d/g, ``)[`replace`](
      /[/]/g,
      ``
    );
    var _0x197C1 = _0x1973A;
    _0x197EE = _0x197EE + _0x1973A;
    _0x1638C += _0x15C57[`substring`](
      _0x16170[`iend`],
      _0x17007[`istart`]
    );
    _0x1638C += _0x197EE;
    _0x1638C += _0x15C57[`substring`](_0x17007[`iend`]);
    $(`#source`)[`val`](_0x1638C);
    doLog();
    src_change();
  }
}
function genNoteDeco(value, value2, position, type) {
  console[`log`](`cen`, cen);
  var rectBarEl = $(`svg[type='rectbar']`);
  if (rectBarEl['length'] > 0) {
    console[`log`](`这里拖动的是小节类型的----选中的小节序号：`, $(rectBarEl)[`attr`](`barIndex`));
    genBarDeco(
      value,
      value2,
      position,
      type,
      $(rectBarEl)[`attr`](`barIndex`)
    );
    return;
  }
  if (value == `"(slur"`) {
    if (cen == null || !cen[`istart`]) {
      return;
    }
    console[`log`](`自定义连音线`);
    var _0x17250 = customSlur[`size`];
    var _0x1943D = -1;
    customSlur[`forEach`](function (_0x1824F, _0x18795) {
      _0x1943D = parseInt(_0x18795[`replace`](`slur`, ``));
    });
    _0x17250 = _0x1943D + 1;
    var _0x19659 = `"(slur-` + _0x17250 + `[sx:0,sy:0,c1x:0,c1y:0,c2x:0,c2y:0]"`;
    var _0x193B6 = `")slur-` + _0x17250 + `[x:0,y:0]"`;
    var _0x15C57 = $(`#source`)[`val`]();
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      _0x19659 +
      _0x15C57[`substring`](cen[`istart`], cen[`iend`]) +
      _0x193B6 +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x15C57);
    doLog();
    src_change();
    return;
  }
  if (value == `"[-num-"` || value == `"_[-num-"`) {
    console[`log`](`自定义标注`);
    var _0x17250 = bracketGch[`size`];
    while (bracketGch[`get`](`bracketgch` + _0x17250) != null) {
      _0x17250++;
    }
    var _0x19659 = `"[-` + _0x17250 + `-文字"`;
    var _0x193B6 = `"` + _0x17250 + `-]"`;
    if (value == `"_[-num-"`) {
      _0x19659 = `"_[-` + _0x17250 + `-文字"`;
    }
    var _0x15C57 = $(`#source`)[`val`]();
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      _0x19659 +
      _0x15C57[`substring`](cen[`istart`], cen[`iend`]) +
      _0x193B6 +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x15C57);
    doLog();
    src_change();
    return;
  }
  if (value == `"[~num~"` || value == `"_[~num~"`) {
    console[`log`](`自定义标注`);
    var _0x17250 = waveGch[`size`];
    while (waveGch[`get`](`wavegch` + _0x17250) != null) {
      _0x17250++;
    }
    var _0x19659 = `"[~` + _0x17250 + `~文字"`;
    var _0x193B6 = `"` + _0x17250 + `~]"`;
    if (value == `"_[~num~"`) {
      _0x19659 = `"_[~` + _0x17250 + `~文字"`;
    }
    var _0x15C57 = $(`#source`)[`val`]();
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      _0x19659 +
      _0x15C57[`substring`](cen[`istart`], cen[`iend`]) +
      _0x193B6 +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x15C57);
    doLog();
    src_change();
    return;
  }
  if (type == `linkclef`) {
    if ($(`.select_staff`)['length'] > 0) {
      $(`g[type='staff']`)
      [`find`](`path`)
      [`css`](`stroke`, `black`);
      genLinkClef(value);
    }
    return;
  }
  if (cen == null) {
    return;
  }
  if (
    value == `!/-!` ||
    value == `!//-!` ||
    value == `!///-!`
  ) {
    if (!cen[`next`]) {
      return;
    }
    if (cen[`next`] && cen[`next`][`type`] != 8) {
      return;
    }
    genTremlo(cen, value);
    return;
  }
  if (value == `arp_link`) {
    setArpLink(`source`);
    return;
  }
  if (type == `spl`) {
    dragSplNum = true;
    updateNextNote(value, cen[`istart`], chordInput, true);
    dragSplNum = false;
    lastMidiReplaceNoteIstart = -1;
    lastMidiReplaceNoteV = -1;
    return;
  }
  var _0x15C57 = $(`#source`)[`val`]();
  if (position == `rhythm`) {
    var _0x18C54 = genNoteAndDur(value, cen, true, 384);
    replaceNote(`source`, cen[`istart`], cen[`iend`], _0x18C54);
    return;
  }
  if (value[`indexOf`](`[K:`) == 0 && cen[`type`] == 1) {
    var _0x18D08 = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
    var _0x19302 = /(treble)|(bass)|(alto)|(tenor)/;
    if (_0x19302[`test`](_0x18D08)) {
      _0x18D08 = _0x18D08[`replace`](
        _0x19302,
        value[`replace`](`[K:`, ``)[`replace`](
          `]`,
          ``
        )
      );
    } else {
      _0x18D08 =
        _0x18D08 +
        ` ` +
        value[`replace`](`[K:`, ``)[`replace`](
          `]`,
          ``
        );
    }
    var _0x1638C =
      _0x15C57[`substring`](0, cen[`istart`]) +
      _0x18D08 +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x1638C);
    src_change();
    doLog();
    return;
  }
  var _0x15C57 = $(`#source`)[`val`]();
  if (type == `lyric`) {
    updateLyrics(cen, [value]);
    return;
  }
  if (value == `{}` || value == `{/}`) {
    var _0x1962C = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
    if (`before` == position) {
      if (type == `syy`) {
        value =
          value[`replace`](`}`, ``) +
          _0x1962C[`replace`](/d/g, ``)[`replace`](
            ///g,
            ``
          ) +
          _0x1962C[`replace`](/d/g, ``)[`replace`](
            ///g,
            ``
          ) +
          `}` +
          _0x1962C;
      } else {
        if (/d+/[`test`](type)) {
          var _0x19389 = getDurStrByNoteDur(
            1536 / parseInt(type),
            cen[`my_ulen`]
          );
          if (_0x19389 == `1`) {
            _0x19389 = ``;
          }
          value =
            value[`replace`](`}`, ``) +
            _0x1962C[`replace`](/d/g, ``)[`replace`](
              ///g,
              ``
            ) +
            _0x19389 +
            `}` +
            _0x1962C;
        }
      }
    } else {
      if (`after` == position) {
        if (type == `syy`) {
          value =
            `(` +
            _0x1962C +
            `{` +
            _0x1962C[`replace`](/d/g, ``)[`replace`](
              /[/)]/g,
              ``
            ) +
            _0x1962C[`replace`](/d/g, ``)[`replace`](
              /[/)]/g,
              ``
            ) +
            `})`;
        } else {
          if (/d+/[`test`](type)) {
            var _0x19389 = getDurStrByNoteDur(1536 / parseInt(type),
              cen[`my_ulen`]
            );
            if (_0x19389 == `1`) { _0x19389 = ``; }
            value = `(` + _0x1962C + `{` + _0x1962C[`replace`](/d/g, ``)[`replace`](/[/)]/g,``) +_0x19389 +`})`;
          }
        }
      }
    }
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      value +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x15C57);
    if (musicType == 2) {
      src_change();
    } else {
      render();
    }
    doLog();
    return;
  }
  var _0x195FF = /\((\d)/;

  if (_0x195FF[`test`](value)) {
    var _0x17D09 = value[`match`](_0x195FF);
    var _0x18BCD = _0x17D09[1];
    console[`log`](cen);
    var _0x1927B = cen[`dur`];
    var _0x17115 = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
    var _0x1946A = _0x1927B / 2;
    var _0x19497 = ``;
    var _0x18BA0 = cen[`my_ulen`];
    if (_0x1946A > _0x18BA0) {
      var _0x1738B = parseInt(_0x1946A / _0x18BA0);
      if (_0x1738B != 1) {
        _0x19497 = _0x1738B + ``;
      }
    } else {
      if (_0x1946A < _0x18BA0) {
        var _0x1738B = parseInt(_0x18BA0 / _0x1946A);
        if (_0x1738B > 1) {
          for (var _0x15CDE = 1; _0x15CDE < _0x1738B; _0x15CDE = _0x15CDE * 2) {
            _0x19497 += `/`;
          }
        }
      }
    }
    if (/\d{1,}|\/{1,}/[`test`](_0x17115)) {
      _0x17115 = _0x17115[`replace`](/d{1,}|\/{1,}/, _0x19497);
    } else {
      _0x17115 = _0x17115 + _0x19497;
    }
    for (var _0x15CDE = 0; _0x15CDE < _0x18BCD - 1; _0x15CDE++) {
      _0x17115 += `z` + _0x19497;
    }
    var _0x1638C =
      _0x15C57[`substring`](0, cen[`istart`]) +
      value +
      _0x17115 +
      ` ` +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x1638C);
    if (musicType == 2) {
      src_change();
    } else {
      render();
    }
    doLog();
    return;
  }
  if (value == `!~(!note!~)!`) {
    var _0x1962C = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
    value = value[`replace`](`note`, _0x1962C);
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      value +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x15C57);
    if (musicType == 2) {
      src_change();
    } else {
      render();
    }
    doLog();
    return;
  }
  if (value == `(note)`) {
    var _0x17007 = cen[`next`];
    var _0x192A8 = cen[`istart`];
    var _0x1951E = -1;
    for (
      var _0x15CDE = _0x192A8 + 1;
      _0x15CDE < syms['length'];
      _0x15CDE++
    ) {
      _0x17007 = syms[_0x15CDE];
      if (_0x17007) {
        if (_0x17007[`type`] == 8 || _0x17007[`type`] == 10) {
          if (_0x17007[`v`] == cen[`v`]) {
            _0x1951E = _0x17007[`iend`];
            break;
          }
        }
      }
    }
    if (_0x1951E == -1) {
      return;
    }
    var _0x1962C = _0x15C57[`substring`](cen[`istart`], _0x1951E);
    value = value[`replace`](`note`, _0x1962C);
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      value +
      _0x15C57[`substring`](_0x1951E);
    $(`#source`)[`val`](_0x15C57);
    if (musicType == 2) {
      src_change();
    } else {
      render();
    }
    doLog();
    return;
  }
  if (value == `3/` || value == `7//`) {
    var _0x1935C = 1;
    if (value == `3/`) {
      _0x1935C = 1.5;
    } else {
      if (value == `7//`) {
        _0x1935C = 1.75;
      }
    }
    genDotInfo(cen, _0x1935C);
    return;
    var _0x195D2 = _0x15C57[`substring`](cen[`istart`], cen[`iend`]);
    var _0x18C54 = new Object();
    var _0x1954B = cen[`dur`];
    var _0x1932F = /([/0-9]+)/g;
    var _0x17D09 = _0x195D2[`match`](_0x1932F);
    if (_0x17D09 != null) {
      var _0x19686 = _0x17D09[0];
      var _0x193E3 = _0x19686[`indexOf`](`/`);
      var _0x19410 = /d/[`test`](_0x19686);
      if (_0x193E3 > 0 && !_0x19410) {
        _0x195D2 =
          _0x195D2[`substring`](0, _0x193E3) +
          value +
          _0x195D2[`substring`](_0x193E3);
      } else {
        if (_0x193E3 == -1 && _0x19410) {
          var _0x18BCD = parseInt(_0x19686);
          var _0x194F1 = 1;
          if (value == `7//`) {
            _0x194F1 = 7 / 4;
          } else {
            if (value == `3/`) {
              _0x194F1 = 3 / 2;
            }
          }
          var _0x194C4 = _0x18BCD * _0x194F1;
          _0x194C4 = decimalsToFractional(_0x194C4) + ``;
          _0x194C4 = _0x194C4[`replace`](`/4`, `//`)
          [`replace`](`/2`, `/`)
          [`replace`](`/1`, ``);
          _0x195D2 = _0x195D2[`replace`](/d/g, _0x194C4);
        }
      }
    } else {
      _0x195D2 += value;
    }
    _0x15C57 =
      _0x15C57[`substring`](0, cen[`istart`]) +
      _0x195D2 +
      _0x15C57[`substring`](cen[`iend`]);
    $(`#source`)[`val`](_0x15C57);
    if (musicType == 2) {
      src_change();
    } else {
      render();
    }
    doLog();
    return;
  }
  if (cen[`type`] == 0) {
    if (!position) {
      _0x15C57 =
        _0x15C57[`substring`](0, cen[`istart`]) +
        value +
        _0x15C57[`substring`](cen[`iend`]);
    } else {
      if (position == `after`) {
        if (value[`indexOf`](`[M:`) > -1) {
          var _0x1746C = value;
          _0x15C57 = dragMeter(_0x15C57, cen, _0x1746C);
        } else {
          _0x15C57 =
            _0x15C57[`substring`](0, cen[`iend`]) +
            value +
            _0x15C57[`substring`](cen[`iend`]);
        }
      } else {
        if (position == `before`) {
          _0x15C57 =
            _0x15C57[`substring`](0, cen[`istart`]) +
            value +
            _0x15C57[`substring`](cen[`istart`]);
        }
      }
    }
  } else {
    if (position == `before`) {
      if (
        `^` == value ||
        `^^` == value ||
        `_` == value ||
        `__` == value ||
        `=` == value
      ) {
        if (cen[`notes`]['length'] > 1) {
          return;
        }
      }
      if (
        `^` == value ||
        `^^` == value ||
        `_` == value ||
        `__` == value ||
        `=` == value
      ) {
        var _0x192D5 = _0x15C57[`substring`](
          cen[`istart`],
          cen[`iend`]
        );
        _0x192D5 = _0x192D5[`replace`](/[^_=]/g, ``);
        _0x15C57 =
          _0x15C57[`substring`](0, cen[`istart`]) +
          value +
          _0x192D5 +
          _0x15C57[`substring`](cen[`iend`]);
      } else {
        if (value[`indexOf`](`[M:`) > -1) {
          var _0x1746C = value;
          _0x15C57 = dragMeter(_0x15C57, cen, _0x1746C);
        } else {
          if (value == `".up"` || value == `".down"`) {
            if (hasGch(cen, `.up`) && value == `".up"`) {
              return;
            }
            if (hasGch(cen, `.down`) && value == `".down"`) {
              return;
            }
            if (hasGch(cen, `.up`) && value == `".down"`) {
              var _0x19578 = _0x15C57[`substring`](0, cen[`istart`]);
              var _0x18D62 = _0x19578[`lastIndexOf`](`".up"`);
              _0x15C57 =
                _0x19578[`substring`](0, _0x18D62) +
                _0x19578[`substring`](_0x18D62)[`replace`](
                  `".up"`,
                  ``
                ) +
                value +
                _0x15C57[`substring`](cen[`istart`]);
              $(`#source`)[`val`](_0x15C57);
              if (musicType == 2) {
                src_change();
              } else {
                render();
              }
              doLog();
              return;
            } else {
              if (hasGch(cen, `.down`) && value == `".up"`) {
                var _0x19578 = _0x15C57[`substring`](0, cen[`istart`]);
                var _0x18D62 = _0x19578[`lastIndexOf`](`".down"`);
                _0x15C57 =
                  _0x19578[`substring`](0, _0x18D62) +
                  _0x19578[`substring`](_0x18D62)[`replace`](
                    `".down"`,
                    ``
                  ) +
                  value +
                  _0x15C57[`substring`](cen[`istart`]);
                $(`#source`)[`val`](_0x15C57);
                if (musicType == 2) {
                  src_change();
                } else {
                  render();
                }
                doLog();
                return;
              }
            }
          }
          var _0x16BFC = getMidStr(cen);
          if (_0x16BFC[`indexOf`](value) < 0) {
            _0x15C57 =
              _0x15C57[`substring`](0, cen[`istart`]) +
              value +
              _0x15C57[`substring`](cen[`istart`]);
          }
          if (type == `pgt`) {
            if (_0x15C57[`indexOf`](`%%diagram`) < 0) {
              _0x15C57 = `%%diagram 1
` + _0x15C57;
            }
          }
        }
      }
    } else {
      if (position == `surround`) {
        _0x15C57 =
          _0x15C57[`substring`](0, cen[`istart`]) +
          value +
          _0x15C57[`substring`](cen[`istart`], cen[`iend`]) +
          value2 +
          _0x15C57[`substring`](cen[`iend`]);
      } else {
        if (position == `after`) {
          _0x15C57 =
            _0x15C57[`substring`](0, cen[`iend`]) +
            value +
            _0x15C57[`substring`](cen[`iend`]);
        }
      }
    }
  }
  $(`#source`)[`val`](_0x15C57);
  if (musicType == 2) {
    src_change();
  } else {
    render();
  }
  doLog();
}
function dragMeter(_0x15C57, _0x1627E, _0x1746C) {
  var _0x173E5 = new Array();
  var _0x173B8 = new Array();
  var _0x1757A = new Object();
  _0x1757A[`v`] = _0x1627E[`v`];
  _0x1757A[`istart`] = _0x1627E[`istart`];
  _0x1757A[`iend`] = _0x1627E[`iend`];
  _0x1757A[`isLineEnd`] = false;
  if (_0x1627E[`next`] == null) {
    _0x1757A[`isLineEnd`] = true;
  }
  _0x173E5[`push`](_0x1627E[`istart`]);
  _0x173B8[`push`](_0x1627E[`iend`]);
  var _0x17520 = new Array();
  _0x17520[`push`](_0x1757A);
  var _0x1638C = ``;
  var _0x17412 = _0x1627E[`v`];
  var _0x174F3 = _0x1627E[`ts_prev`];
  while (_0x174F3) {
    if (_0x174F3[`type`] == 0 && _0x17412 != _0x174F3[`v`]) {
      _0x17412 = _0x174F3[`v`];
      _0x173E5[`push`](_0x174F3[`istart`]);
      _0x173B8[`push`](_0x174F3[`iend`]);
      var _0x1754D = new Object();
      _0x1754D[`v`] = _0x174F3[`v`];
      _0x1754D[`istart`] = _0x174F3[`istart`];
      _0x1754D[`iend`] = _0x174F3[`iend`];
      _0x1754D[`isLineEnd`] = _0x1757A[`isLineEnd`];
      _0x17520[`push`](_0x1754D);
      _0x174F3 = _0x174F3[`ts_prev`];
    } else {
      break;
    }
  }
  _0x17412 = _0x1627E[`v`];
  var _0x174C6 = _0x1627E[`ts_next`];
  while (_0x174C6) {
    if (_0x174C6[`type`] == 0 && _0x17412 != _0x174C6[`v`]) {
      _0x17412 = _0x174C6[`v`];
      _0x173E5[`push`](_0x174C6[`istart`]);
      _0x173B8[`push`](_0x174C6[`iend`]);
      var _0x1754D = new Object();
      _0x1754D[`v`] = _0x174C6[`v`];
      _0x1754D[`istart`] = _0x174C6[`istart`];
      _0x1754D[`iend`] = _0x174C6[`iend`];
      _0x1754D[`isLineEnd`] = _0x1757A[`isLineEnd`];
      _0x17520[`push`](_0x1754D);
      _0x174C6 = _0x174C6[`ts_next`];
    } else {
      break;
    }
  }
  _0x173E5[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1735E - _0x1738B;
  });
  _0x173B8[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1735E - _0x1738B;
  });
  _0x17520[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1738B[`istart`] - _0x1735E[`istart`];
  });
  var _0x1743F = 0;
  _0x1638C = _0x15C57;
  for (var _0x15CDE = 0; _0x15CDE < _0x17520['length']; _0x15CDE++) {
    var _0x1754D = _0x17520[_0x15CDE];
    var _0x175A7 = _0x1754D[`istart`];
    var _0x17499 = _0x1746C;
    if (_0x1746C[`indexOf`](`M:C|`) > -1) {
      _0x17499 = `[M:2/2]`;
    } else {
      if (_0x1746C[`indexOf`](`M:C`) > -1) {
        _0x17499 = `[M:4/4]`;
      }
    }
    _0x1638C = resetBarStrByMeter(_0x1754D, _0x17499, _0x1638C);
  }
  return _0x1638C;
}
function getDragBarInfo(_0x1627E) {
  var _0x173E5 = new Array();
  var _0x173B8 = new Array();
  var _0x1757A = new Object();
  _0x1757A[`v`] = _0x1627E[`v`];
  _0x1757A[`istart`] = _0x1627E[`istart`];
  _0x1757A[`iend`] = _0x1627E[`iend`];
  _0x173E5[`push`](_0x1627E[`istart`]);
  _0x173B8[`push`](_0x1627E[`iend`]);
  var _0x17520 = new Array();
  _0x17520[`push`](_0x1757A);
  var _0x1638C = ``;
  var _0x17412 = _0x1627E[`v`];
  var _0x174F3 = _0x1627E[`ts_prev`];
  while (_0x174F3) {
    if (_0x174F3[`type`] == 0 && _0x17412 != _0x174F3[`v`]) {
      _0x17412 = _0x174F3[`v`];
      _0x173E5[`push`](_0x174F3[`istart`]);
      _0x173B8[`push`](_0x174F3[`iend`]);
      var _0x1754D = new Object();
      _0x1754D[`v`] = _0x174F3[`v`];
      _0x1754D[`istart`] = _0x174F3[`istart`];
      _0x1754D[`iend`] = _0x174F3[`iend`];
      _0x17520[`push`](_0x1754D);
      _0x174F3 = _0x174F3[`ts_prev`];
    } else {
      break;
    }
  }
  _0x17412 = _0x1627E[`v`];
  var _0x174C6 = _0x1627E[`ts_next`];
  while (_0x174C6) {
    if (_0x174C6[`type`] == 0 && _0x17412 != _0x174C6[`v`]) {
      _0x17412 = _0x174C6[`v`];
      _0x173E5[`push`](_0x174C6[`istart`]);
      _0x173B8[`push`](_0x174C6[`iend`]);
      var _0x1754D = new Object();
      _0x1754D[`v`] = _0x174C6[`v`];
      _0x1754D[`istart`] = _0x174C6[`istart`];
      _0x1754D[`iend`] = _0x174C6[`iend`];
      _0x17520[`push`](_0x1754D);
      _0x174C6 = _0x174C6[`ts_next`];
    } else {
      break;
    }
  }
  _0x173E5[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1735E - _0x1738B;
  });
  _0x173B8[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1735E - _0x1738B;
  });
  _0x17520[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1738B[`istart`] - _0x1735E[`istart`];
  });
  return _0x17520;
}
function resetBarStrByMeter(_0x1754D, _0x1B3E1, _0x15C57) {
  var _0x15D92 = getLinesInfo(_0x15C57);
  console[`log`](`vo:`, _0x1754D);
  console[`log`](`lines:`, _0x15D92);
  var _0x15EFA = _0x1754D[`istart`];
  var _0x16F26 = _0x1754D[`iend`];
  var _0x1892A = ``;
  var _0x15C84 = 0;
  var _0x1B40E = ``;
  var _0x1B3B4 = /linebreak (.)/;
  var _0x1B387 = ``;
  if (_0x1B3B4[`test`](_0x15C57)) {
    _0x1B387 = _0x1B3B4[`exec`](_0x15C57)[1];
  }
  var _0x1B43B = /(:||:)|(:|:)|(:|)|(::)|(|:)|(||)|(|])|(|)/g;
  var _0x1B300 = new Array();
  for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
    var _0x1635F = _0x15D92[_0x15CDE];
    var _0x15DBF = _0x1635F[`lineStr`];
    if (
      _0x1635F[`v`] == _0x1754D[`v`] &&
      _0x1635F[`type`] == `note`
    ) {
      if (_0x1B300[_0x1754D[`v`]]) {
        _0x1892A += _0x15DBF + `
`;
        continue;
      }
      _0x1B300[_0x1754D[`v`]] = false;
      var _0x1B495 = _0x1635F[`startSeq`];
      var _0x1B35A = _0x1635F[`endSeq`];
      if (_0x1B35A > _0x16F26) {
        var _0x16AEE = ``;
        if (_0x1B495 < _0x15EFA) {
          if (
            _0x1754D[`isLineEnd`] &&
            _0x15C84 == 0 &&
            _0x15C57[`indexOf`](`linebreak`) < 0
          ) {
            _0x1B40E = _0x1B3E1;
          } else {
            if (
              _0x1754D[`isLineEnd`] &&
              _0x15C84 == 0 &&
              _0x1B387 != ``
            ) {
              _0x16F26 += 1;
            }
            _0x16AEE = _0x15DBF[`substring`](_0x16F26 - _0x1B495);
            _0x16AEE = _0x16AEE[`replace`](`:||:`, `:|:`)[
              `replace`
            ](`::`, `:|:`);
            var _0x16C29 = ``;
            var _0x1B468 = ``;
            var _0x18D62 = 0;
            var _0x1B4C2 = ``;
            while ((_0x16C29 = _0x1B43B[`exec`](_0x16AEE))) {
              _0x1B468 = _0x16AEE[`substring`](
                _0x18D62,
                _0x16C29[`index`]
              );
              var _0x1B32D = replaceNodeContentToRestWithMeter(
                _0x1B468,
                _0x1B3E1
              );
              if (_0x1B468[`indexOf`](`$`) > -1) {
                _0x1B32D = `$` + _0x1B32D;
              }
              if (_0x1B32D == _0x1B468) {
                _0x1B300[_0x1754D[`v`]] = true;
                _0x1B4C2 +=
                  _0x1B32D + _0x16AEE[`substring`](_0x16C29[`index`]);
                break;
              }
              _0x1B4C2 += _0x1B32D + _0x16C29[0];
              _0x18D62 = _0x16C29[`index`] + _0x16C29[0]['length'];
            }
            if (_0x1B4C2[`trim`]()[`indexOf`](`$`) == 0) {
              _0x15DBF =
                _0x15DBF[`substring`](0, _0x16F26 - _0x1B495) +
                `$` +
                _0x1B3E1 +
                _0x1B4C2[`substring`](_0x1B4C2[`indexOf`](`$`) + 1);
            } else {
              _0x15DBF =
                _0x15DBF[`substring`](0, _0x16F26 - _0x1B495) +
                _0x1B3E1 +
                _0x1B4C2;
            }
          }
          _0x15C84++;
        } else {
          _0x16AEE = _0x1635F[`lineStr`];
          _0x16AEE = _0x16AEE[`replace`](`:||:`, `:|:`)[
            `replace`
          ](`::`, `:|:`);
          var _0x16C29 = ``;
          var _0x1B468 = ``;
          var _0x18D62 = 0;
          var _0x1B4C2 = ``;
          while ((_0x16C29 = _0x1B43B[`exec`](_0x16AEE))) {
            _0x1B468 += _0x16AEE[`substring`](
              _0x18D62,
              _0x16C29[`index`]
            );
            _0x1B4C2 +=
              replaceNodeContentToRestWithMeter(_0x1B468, _0x1B3E1) +
              _0x16C29[0];
          }
          _0x15DBF =
            _0x15DBF[`substring`](0, _0x16F26 - _0x1B495) +
            _0x1B3E1 +
            _0x1B4C2;
          if (_0x1B40E != ``) {
            _0x1B4C2 = _0x1B40E + _0x1B4C2;
            _0x1B40E = ``;
          }
          _0x15DBF = _0x1B4C2;
        }
      }
    }
    _0x1892A += _0x15DBF + `
`;
  }
  console[`log`](`result:`, _0x1892A);
  return _0x1892A;
}
var moveSlurHeight = 1;
function moveDeco(_0x16062) {
  $(`.editor_rect`)[`removeClass`](`editor_rect`);
  var _0x15FAE = $(`rect[selected='selected']`);
  var _0x15EFA = $(_0x15FAE)[`attr`](`istart`);
  var _0x185A6 = 0;
  if (syms[_0x15EFA]) {
    _0x185A6 = syms[_0x15EFA][`v`];
  }
  var _0x15FDB = $(_0x15FAE)[`attr`](`dragtype`);
  var _0x15F54 = $(_0x15FAE)[`attr`](`pos`);
  if (_0x15FDB == `linkclef`) {
    var _0x1ACD9 = $(_0x15FAE)[`parents`](`g`)[0];
    var _0x17A39 = $(_0x1ACD9)[`attr`](`transform`);
    var _0x17A66 = getTransformsTranslate(_0x17A39);
    var _0x1AC52 = 0;
    if (_0x17A66 != null) {
      _0x1AC52 = parseFloat(
        _0x16062[`offsetY`] / scale - _0x17A66[`y`]
      );
    } else {
      _0x1AC52 = parseFloat(_0x16062[`offsetY`] / scale);
    }
    var _0x1AC25 = -1;
    var _0x15F54 = $(_0x15FAE)[`attr`](`pos`);
    if (_0x15F54 == `start`) {
      _0x1AC25 = $(`rect[dragtype="linkclef"][pos="end"]`)[`attr`](`inity`);
      if (_0x1AC52 > _0x1AC25) {
        return;
      }
    }
    if (_0x15F54 == `end`) {
      _0x1AC25 = $(`rect[dragtype="linkclef"][pos="start"]`)[`attr`](`inity`);
      if (_0x1AC52 < _0x1AC25) {
        return;
      }
    }
    var _0x16A3A = _0x16062[`target`];
    if (_0x16A3A[`tagName`] == `svg`) {
      var _0x17688 = _0x16A3A;
      $(_0x17688)
      [`find`](`g[type='staff']`)
      [`find`](`path`)
      [`css`](`stroke`, `black`);
      selectStaff(_0x17688, _0x16062);
    } else {
      _0x16A3A = $(_0x16062[`target`])[`parents`](`svg`);
      var _0x17688 = _0x16A3A;
      $(_0x17688)
      [`find`](`g[type='staff']`)
      [`find`](`path`)
      [`css`](`stroke`, `black`);
      selectStaff(_0x17688, _0x16062);
    }
    selectStaff(_0x17688, _0x16062);
    $(_0x15FAE)[`attr`](`y`, _0x1AC52);
    return;
  }
  if (_0x15FDB == `slur` && _0x15F54 == `mid`) {
    var _0x1AD06 = $(_0x15FAE)[`parents`](`g`)[0];
    var _0x17A39 = $(_0x1AD06)[`attr`](`transform`);
    var _0x17A66 = getTransformsTranslate(_0x17A39);
    var _0x1AC52 = parseFloat(
      _0x16062[`offsetY`] / scale - _0x17A66[`y`]
    );
    var _0x1AC7F = parseFloat($(_0x15FAE)[`attr`](`y`));
    var _0x1ACAC = Math[`abs`](_0x1AC52 - _0x1AC7F) / _0x1AC7F;
    console[`log`](`present:`, _0x1ACAC);
    moveSlurHeight = _0x1ACAC * 100;
    if (moveSlurHeight > 3) {
      moveSlurHeight = 3;
    } else {
      if (moveSlurHeight < 1) {
        moveSlurHeight = 1;
      }
    }
    $(_0x15FAE)[`attr`](`y`, _0x1AC52);
    return;
  }
  if (_0x15FDB == `k_slur`) {
    $(_0x15FAE)[`attr`](`x`, _0x16062[`offsetX`]);
  } else {
    $(_0x15FAE)[`attr`](`x`, _0x16062[`offsetX`] / scale);
  }
  var _0x16C56 = $(_0x15FAE)[`parents`](`svg`)[0];
  nearDecoNote = findNearNoteWithSelectedDeco(
    _0x16C56,
    _0x16062[`offsetX`] / scale,
    _0x16062[`offsetY`] / scale,
    _0x15FDB,
    _0x185A6,
    _0x16062
  );
  console[`log`](`---`, nearDecoNote);
  var _0x15EFA = $(_0x15FAE)[`attr`](`istart`);
}
var lastMidiReplaceNoteIstart = -1;
var lastMidiReplaceNoteV = -1;
var midiInStatus = false;
function updateNextNote(_0x1C16A, _0x1B13E, chordInput, _0x1C197) {
  if (!graph_update) {
    return;
  }
  console[`log`](`notestr:`, _0x1C16A);
  var _0x1C21E = $(`.selected_text`)['length'];
  if (dragSplNum) {
    _0x1C21E = 1;
  }
  if (!dragSplNum && _0x1C21E == 0 && lastMidiReplaceNoteIstart == -1) {
    var _0x1C24B = null;
    for (var _0x15CDE = 0; _0x15CDE < syms['length']; _0x15CDE++) {
      var _0x16170 = syms[_0x15CDE];
      if (_0x16170) {
        if (_0x16170[`type`] == 10 || _0x16170[`type`] == 8) {
          _0x1C24B = _0x16170;
          break;
        }
      }
    }
    if (_0x1C24B != null) {
      $(`text[istart='` + _0x16170[`istart`] + `']`)[`addClass`](
        `selected_text`
      );
    }
    _0x1C21E = $(`.selected_text`)['length'];
  }
  if (_0x1C21E > 0 || lastMidiReplaceNoteIstart != -1) {
    midiInStatus = true;
    if (_0x1C21E > 0) {
      lastMidiReplaceNoteIstart = -1;
      lastMidiReplaceNoteV = -1;
    }
    var _0x1C1F1 = -1;
    if (lastMidiReplaceNoteIstart > 0) {
      if (!syms[lastMidiReplaceNoteIstart]) {
        return;
      }
      var _0x17007 = syms[lastMidiReplaceNoteIstart][`next`];
      while (_0x17007) {
        if (_0x17007[`type`] == 8 || _0x17007[`type`] == 10) {
          _0x1C1F1 = _0x17007[`istart`];
          break;
        } else {
          _0x17007 = _0x17007[`next`];
          if (_0x17007 == null) {
            break;
          }
        }
      }
      if (_0x1C1F1 === -1) {
        var _0x1C13D = syms[lastMidiReplaceNoteIstart][`my_line`] + 1;
        for (
          var _0x15CDE = 0, _0x1881C = syms['length'];
          _0x15CDE < _0x1881C;
          _0x15CDE++
        ) {
          var _0x1C1C4 = syms[_0x15CDE];
          if (
            _0x1C1C4 &&
            _0x1C1C4[`v`] == lastMidiReplaceNoteV &&
            _0x1C1C4[`my_line`] == _0x1C13D &&
            (_0x1C1C4[`type`] == 8 || _0x1C1C4[`type`] == 10)
          ) {
            _0x1C1F1 = _0x1C1C4[`istart`];
            break;
          }
        }
      }
    } else {
      _0x1C1F1 = $($(`.selected_text`)[$(`.selected_text`)['length'] - 1])[
        `attr`
      ](`istart`);
      if (dragSplNum) {
        _0x1C1F1 = _0x1B13E;
      }
    }
    if (_0x1C1F1 === -1) {
      console[`log`](`没有了----`);
      if (
        graphEditor[`pianoImpro`] &&
        graphEditor[`pianoImpro`][`isOpen`]
      ) {
        return;
      }
      appendNodes(1);
      setTimeout(function () {
        updateNextNote(_0x1C16A, _0x1B13E);
      }, 500);
      midiInStatus = false;
      return;
    }
    var _0x16170 = syms[_0x1C1F1];
    if (_0x16170) {
      lastMidiReplaceNoteIstart = _0x1C1F1;
      lastMidiReplaceNoteV = _0x16170[`v`];
      var _0x18C54 = genNoteAndDur(_0x1C16A, _0x16170);
      console[`log`](`noteInfo:`, _0x18C54);
      if (_0x18C54[`noteStr`][`startWith`](` `)) {
        lastMidiReplaceNoteIstart++;
      }
      _0x18C54[`note`] = _0x1C16A;
      var _0x18BFA = _0x18C54[`noteStr`];
      midiInStatus = false;
      if (_0x16170[`type`] == 10) {
        replaceNote(
          `source`,
          _0x16170[`istart`],
          _0x16170[`iend`],
          _0x18C54
        );
      } else {
        if (_0x16170[`type`] == 8) {
          var _0x18C27 = _0x16170[`dur`];
          if (_0x16170[`tie_s`]) {
            _0x18C27 += _0x16170[`tie_s`][`dur`];
          }
          if (_0x18C27 == durSetting) {
            var _0x18A0B = genChordNote(_0x16170, _0x1C16A, durSetting);
            if (
              rest_status == `` &&
              chordNote == `` &&
              chordInput
            ) {
              _0x18C54[`noteStr`] = _0x18A0B[`chordNoteStr`];
            }
            replaceNote(
              `source`,
              _0x16170[`istart`],
              _0x16170[`iend`],
              _0x18C54
            );
          } else {
            _0x18C54[`note_dur`] = durSetting;
            replaceNote(
              `source`,
              _0x16170[`istart`],
              _0x16170[`iend`],
              _0x18C54
            );
          }
        }
      }
    }
    if (chordInput) {
      $(`rect[istart='` + _0x1C1F1 + `']`)
      [`css`](`fill-opacity`, `0.4`)
      [`click`]();
      $(`text[istart='` + _0x1C1F1 + `']`)[`addClass`](`selected_text`);
      clearFocus();
      return _0x1C1F1;
    }
    if (!syms[_0x1C1F1]) {
      _0x1C1F1++;
    }
    if (!_0x1C197) {
      update_note_istart = -1;
      if (!syms[_0x1C1F1]) {
        return;
      }
      var _0x1C1C4 = syms[_0x1C1F1][`next`];
      if (_0x1C1C4) {
        while (_0x1C1C4[`type`] != 8 && _0x1C1C4[`type`] != 10) {
          _0x1C1C4 = _0x1C1C4[`next`];
          if (!_0x1C1C4) {
            break;
          }
        }
        if (_0x1C1C4) {
          $(`rect[istart='` + _0x1C1C4[`istart`] + `']`)
          [`css`](`fill-opacity`, `0.4`)
          [`click`]();
          $(`text[istart='` + _0x1C1C4[`istart`] + `']`)[`addClass`](
            `selected_text`
          );
          if (showHelpNote) {
            addHelpAssessant(_0x1C1C4[`istart`]);
          }
          clearFocus();
        }
      }
    }
  } else {
    console[`log`](`没有选中音符`);
    window[`top`][`alert`](`请选中1个音符开始输入`);
  }
  return _0x1C1F1;
}
function showLyricInput() {
  var _0x1B738 = new Array();
  var _0x1673D = $(`#target`)[`offset`]()[`top`];
  var _0x16710 = $(`#target`)[`offset`]()[`left`];
  $(`svg`)
  [`find`](`rect[type='note'],rect[type='splnum_note']`)
  [`each`](function (_0x15CDE, _0x1646D) {
    var _0x15EFA = $(_0x1646D)[`attr`](`istart`);
    var _0x16170 = syms[_0x15EFA];
    var _0x164C7 = this[`getBoundingClientRect`]();
    var _0x1665C = _0x16170[`a_ly`];
    var _0x1B792 = ``;
    if (_0x1665C) {
      for (
        var _0x15CDE = 0, _0x1881C = _0x1665C['length'];
        _0x15CDE < _0x1881C;
        _0x15CDE++
      ) {
        var _0x1B819 = _0x1665C[_0x15CDE];
        if (!_0x1B819) {
          _0x1B792 += `<br>`;
          continue;
        }
        if (_0x15CDE > 0) {
          _0x1B792 += `<br>`;
        }
        _0x1B792 += _0x1B819[`t`];
      }
    }
    var _0x1657B = document[`createElement`](`div`);
    $(_0x1657B)
    [`css`](`z-index`, 2)
    [`css`](`position`, `absolute`)
    [`css`](`background-color`, `white`);
    $(_0x1657B)[`attr`](`contenteditable`, `true`);
    $(_0x1657B)[`addClass`](`editor-div`);
    $(_0x1657B)[`attr`](`istart`, _0x15EFA);
    $(_0x1657B)[`attr`](`line`, _0x16170[`my_line`]);
    $(_0x1657B)[`attr`](`v`, _0x16170[`v`]);
    $(_0x1657B)[`html`](_0x1B792);
    $(_0x1657B)[`on`](`keyup`, function (_0x16062) {
      _0x16062[`preventDefault`]();
    });
    $(_0x1657B)[0][`addEventListener`](`paste`, function (_0x1A4C3) {
      clipdata = _0x1A4C3[`clipboardData`] || window[`clipboardData`];
      clipdataContent = clipdata[`getData`](`text/plain`);
      console[`log`](`粘贴内容：`, clipdataContent);
      if (clipdataContent != ``) {
        var _0x168D2 = /\[(.[^\[]*)\]/g;
        var _0x15F81 = null;
        var _0x16C83 = ``;
        var _0x18D62 = 0;
        var _0x1B873 = new Array();
        while ((_0x15F81 = _0x168D2[`exec`](clipdataContent))) {
          console[`log`](_0x15F81, _0x15F81[0], _0x15F81[`index`]);
          _0x16C83 = clipdataContent[`substring`](
            _0x18D62,
            _0x15F81[`index`]
          );
          if (_0x16C83 != ``) {
            var _0x1B846 = _0x16C83[`split`](``);
            for (
              var _0x15CDE = 0;
              _0x15CDE < _0x1B846['length'];
              _0x15CDE++
            ) {
              _0x1B873[`push`](_0x1B846[_0x15CDE]);
            }
          }
          _0x1B873[`push`](_0x15F81[1]);
          _0x18D62 = _0x15F81[`index`] + _0x15F81[0]['length'];
        }
        if (_0x18D62 < clipdataContent['length']) {
          var _0x16D37 = clipdataContent[`substring`](
            _0x18D62,
            clipdataContent['length']
          );
          if (_0x16D37 != ``) {
            var _0x1B846 = _0x16D37[`split`](``);
            for (
              var _0x15CDE = 0;
              _0x15CDE < _0x1B846['length'];
              _0x15CDE++
            ) {
              _0x1B873[`push`](_0x1B846[_0x15CDE]);
            }
          }
        }
        console[`log`]($(this)[`attr`](`istart`));
        var _0x15EFA = $(this)[`attr`](`istart`);
        var _0x185A6 = $(this)[`attr`](`v`);
        var _0x1B8A0 = 0;
        for (
          var _0x15D0B = parseInt(_0x15EFA), _0x1B8CD = syms['length'];
          _0x15D0B < _0x1B8CD;
          _0x15D0B++
        ) {
          if (syms[_0x15D0B] && syms[_0x15D0B][`v`] == _0x185A6) {
            var _0x16CB0 = syms[_0x15D0B][`istart`];
            if (
              _0x16CB0 &&
              $(`.editor-div[istart=` + _0x16CB0 + `]`)['length'] > 0
            ) {
              if (_0x1B8A0 < _0x1B873['length']) {
                $(`.editor-div[istart=` + _0x16CB0 + `]`)[`html`](
                  _0x1B873[_0x1B8A0++]
                );
              } else {
                break;
              }
            }
          }
        }
      }
      _0x1A4C3[`preventDefault`]();
    });
    var _0x1B7EC = new Object();
    _0x1B7EC[`lineNum`] = _0x16170[`my_line`];
    _0x1B7EC[`v`] = _0x16170[`v`];
    _0x1B7EC[`top`] =
      parseFloat(_0x164C7[`top`]) +
      parseFloat(_0x164C7[`height`]) +
      $(`#target`)[`scrollTop`]();
    var _0x1B7BF = _0x1B738[`find`](function (_0x1646D) {
      return (
        _0x1646D[`lineNum`] == _0x16170[`my_line`] &&
        _0x1646D[`v`] == _0x16170[`v`]
      );
    });
    if (_0x1B7BF == null) {
      _0x1B738[`push`](_0x1B7EC);
    } else {
      if (_0x1B7BF[`top`] < _0x1B7EC[`top`]) {
        _0x1B7BF[`top`] = _0x1B7EC[`top`];
      }
    }
    $(_0x1657B)
    [`css`]({
      left: _0x164C7[`left`] + 10 - _0x16710,
      "min-width": 40,
      "min-height": 30,
    })
    [`show`]();
    $(`#target`)[`append`]($(_0x1657B));
  });
  var _0x1B765 = 0;
  if (musicType == 2) {
    _0x1B765 = 20;
  }
  $(`.editor-div`)[`each`](function (_0x15CDE, _0x1646D) {
    var _0x1635F = $(_0x1646D)[`attr`](`line`);
    var _0x185A6 = $(_0x1646D)[`attr`](`v`);
    var _0x1B7BF = _0x1B738[`find`](function (_0x1646D) {
      return (
        _0x1646D[`lineNum`] == _0x1635F && _0x1646D[`v`] == _0x185A6
      );
    });
    $(_0x1646D)[`css`]({
      top: _0x1B7BF[`top`] + 20 - _0x1673D + _0x1B765,
    });
  });
}
function genLyric() {
  var _0x18E43 = 0,
    _0x18D8F = [];
  var _0x18E16 = new Array();
  var _0x18DE9 = getLineIndexArr();
  $(`.editor-div`)[`each`](function (_0x15CDE, _0x1646D) {
    var _0x1665C = new Object();
    _0x1665C[`str`] = $(_0x1646D)
    [`html`]()
    [`replaceAll`](`<div><br></div>`, `<br>`)
    [`replaceAll`](`<div>`, `<br>`)
    [`replaceAll`](`</div>`, ``);
    _0x1665C[`istart`] = parseInt($(_0x1646D)[`attr`](`istart`));
    _0x1665C[`line`] = getLineIndex(_0x18DE9, _0x1665C[`istart`]);
    _0x1665C[`update`] = false;
    var _0x16170 = syms[_0x1665C[`istart`]];
    if (_0x16170[`a_ly`]) {
      var _0x18EF7 = ``;
      for (
        var _0x15D0B = 0;
        _0x15D0B < _0x16170[`a_ly`]['length'];
        _0x15D0B++
      ) {
        var _0x18F24 = _0x16170[`a_ly`][_0x15D0B];
        if (!_0x18F24) {
          _0x18EF7 += `<br><br>`;
          continue;
        }
        var _0x18F51 = _0x18F24[`t`];
        if (_0x15D0B == 0) {
          _0x18EF7 = _0x18F51;
        } else {
          _0x18EF7 += `<br>` + _0x18F51;
        }
        if (_0x18F51 != _0x1665C[`str`]) {
          _0x1665C[`update`] = true;
        }
      }
    } else {
      _0x1665C[`update`] = true;
    }
    if (_0x18D8F[`indexOf`](_0x1665C[`line`]) == -1) {
      _0x18D8F[`push`](_0x1665C[`line`]);
    }
    _0x18E16[`push`](_0x1665C);
    if (
      _0x1665C[`str`] &&
      _0x1665C[`str`][`split`](`<br>`)['length'] > _0x18E43
    ) {
      _0x18E43 = _0x1665C[`str`][`split`](`<br>`)[
        'length'
      ];
    }
  });
  if (!_0x18E16 || _0x18E16['length'] <= 0) {
    return;
  }
  _0x18E16[`sort`](function (_0x1735E, _0x1738B) {
    return _0x1738B[`line`] == _0x1735E[`line`]
      ? _0x1738B[`istart`] - _0x1735E[`istart`]
      : _0x1738B[`line`] - _0x1735E[`line`];
  });
  var _0x1635F = _0x18E16[0][`line`];
  var _0x18E9D = [];
  _0x18E9D[`push`]([]);
  for (
    var _0x15CDE = 0, _0x1881C = _0x18E16['length'];
    _0x15CDE < _0x1881C;
    _0x15CDE++
  ) {
    if (_0x1635F != _0x18E16[_0x15CDE][`line`]) {
      _0x18E9D[`push`]([]);
      _0x1635F = _0x18E16[_0x15CDE][`line`];
    }
    _0x18E9D[_0x18E9D['length'] - 1][`push`](_0x18E16[_0x15CDE]);
  }
  var _0x18E70;
  for (
    var _0x15D0B = 0, _0x18DBC = _0x18E9D['length'];
    _0x15D0B < _0x18DBC;
    _0x15D0B++
  ) {
    _0x18E70 = _0x18E9D[_0x15D0B];
    for (var _0x16332 = _0x18E43 - 1; _0x16332 >= 0; _0x16332--) {
      for (
        var _0x15CDE = 0, _0x1881C = _0x18E70['length'];
        _0x15CDE < _0x1881C;
        _0x15CDE++
      ) {
        if (
          graphEditor[`pianoImpro`] &&
          typeof graphEditor[`pianoImpro`][`noteUpdate`] == `function`
        ) {
          var _0x16AEE = _0x18E70[_0x15CDE][`str`];
          var _0x18ECA = _0x16AEE[`split`](`<br>`);
          if (!_0x18E70[_0x15CDE][`update`]) {
            continue;
          }
          if (_0x16332 < _0x18ECA['length'] && _0x18ECA[_0x16332]) {
            graphEditor[`pianoImpro`][`noteUpdate`](
              _0x18E70[_0x15CDE][`istart`],
              _0x18ECA[_0x16332],
              _0x16332
            );
          } else {
            graphEditor[`pianoImpro`][`noteUpdate`](
              _0x18E70[_0x15CDE][`istart`],
              `*`,
              _0x16332
            );
          }
        }
      }
    }
  }
  $(`.lyric`)[`removeClass`](`menu-pressed`);
  var _0x15C57 = $(`#source`)[`val`]();
  _0x15C57 = replaceBlankLine(_0x15C57);
  $(`#source`)[`val`](_0x15C57);
  src_change();
  doLog();
}
function getLineIndex(_0x19875, _0x15EFA) {
  if (!_0x19875 || _0x19875['length'] <= 0 || !_0x15EFA) {
    return 0;
  }
  var _0x19BCC = 0;
  var _0x19C26 = _0x19875['length'];
  var _0x19BF9 = 0;
  var _0x15C84 = _0x19875['length'];
  while (_0x19BCC < _0x19C26 && _0x15C84 > 0) {
    _0x19BF9 = _0x19BCC + parseInt((_0x19C26 - _0x19BCC) / 2);
    if (
      _0x15EFA >= _0x19875[_0x19BF9][`start`] &&
      _0x15EFA <= _0x19875[_0x19BF9][`end`]
    ) {
      break;
    } else {
      if (_0x15EFA < _0x19875[_0x19BF9][`start`]) {
        _0x19C26 = _0x19BF9;
      } else {
        if (_0x15EFA > _0x19875[_0x19BF9][`end`]) {
          _0x19BCC = _0x19BF9;
        }
      }
    }
    _0x15C84--;
  }
  return _0x19BF9;
}
function getLineIndexArr() {
  var _0x19C53 = $(`#source`)[`val`]();
  var _0x15D92 = _0x19C53[`split`](`
`);
  var _0x1635F = ``;
  var _0x19659 = 0;
  var _0x18DE9 = [];
  var _0x19C80 = false,
    _0x19CAD = false;
  for (
    var _0x15CDE = 0, _0x1881C = _0x15D92['length'];
    _0x15CDE < _0x1881C;
    _0x15CDE++
  ) {
    if (
      _0x1635F[`indexOf`](`w:`) == -1 &&
      _0x1635F[`replaceAll`](/".*"/g, ``)
      [`replace`](/[.[^]]*]/, ``)
      [`replace`](/{.[^}]*}/, ``)
      [`indexOf`](`|`) > -1
    ) {
      _0x19CAD = true;
    } else {
      _0x19CAD = false;
    }
    _0x1635F = _0x15D92[_0x15CDE];
    var _0x17AED = { start: _0x19659, end: _0x19659 + _0x1635F['length'] };
    if (_0x19C80 && _0x19CAD) {
      _0x18DE9[_0x18DE9['length'] - 1][`end`] =
        _0x17AED[`end`];
    } else {
      _0x18DE9[`push`](_0x17AED);
    }
    _0x19659 = _0x17AED[`end`] + 1;
    _0x19C80 = _0x19CAD;
  }
  return _0x18DE9;
}
function enabledEditor(_0x17AED) {
  user[`clickAddText`] = false;
  $(`#target`)[`css`](`cursor`, `default`);
  if ($(_0x17AED)[`hasClass`](`menu-pressed`)) {
    $(_0x17AED)[`removeClass`](`menu-pressed`);
    graph_update = true;
    draw_editor = false;
    $(`#graphEditorMenuInsert`)[`remove`](`menu-pressed`);
    $(`#graphEditorMenuUpdate`)[`addClass`](`menu-pressed`);
  } else {
    if ($(`#insertWord`)[`hasClass`](`menu-pressed`)) {
      $(`#insertWord`)[`removeClass`](`menu-pressed`);
    }
    $(_0x17AED)[`addClass`](`menu-pressed`);
    $(`#graphEditorMenu`)[`removeClass`](`menu-pressed`);
    graph_update = false;
    draw_editor = false;
    $(`#graphEditorMenuInsert`)[`removeClass`](`menu-pressed`);
    $(`#graphEditorMenuUpdate`)[`removeClass`](`menu-pressed`);
  }
}
function showSpeedDiv() {
  $(`#QC_div .modal-content`)[`css`](
    `left`,
    ($(window)[`width`]() - $(`#Q_div .modal-content`)[`width`]()) / 2
  );
  $(`#speedtype`)[`val`](`node`);
  $(`#QC_div`)[`modal`]();
}
function addNodeSpeed() {
  var _0x15BFD = $(`#nodeMenu`)[`attr`](`barIndex`);
  if (!_0x15BFD) {
    return;
  }
  _0x15BFD = parseInt(_0x15BFD);
  var _0x15C57 = $(`#source`)[`val`]();
  if (_0x15BFD == 0) {
    var _0x15ECD = /Q:.*(\d\/\d=\d{1,3})/;
    var _0x15E46 = $(`#selectSpeedImg2`)[`attr`](`speed`);
    var _0x15E73 = $(`#NOTE_Q_V`)[`val`]();
    var _0x15EA0 = _0x15C57[`match`](_0x15ECD);
    if (_0x15EA0 != null) {
      var _0x15E19 = _0x15EA0[0][`replace`](
        _0x15EA0[1],
        _0x15E46 + `=` + _0x15E73
      );
      _0x15C57 = _0x15C57[`replace`](_0x15EA0[0], _0x15E19);
      $(`#source`)[`val`](_0x15C57);
      src_change();
      doLog();
      return;
    }
  }
  var _0x15D92 = getLinesInfo(_0x15C57);
  var _0x15D65 = ``;
  var _0x15C84 = 0;
  if (_0x15D92 != null) {
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      if (_0x15D92[_0x15CDE][`type`] == `note`) {
        var _0x15DBF = _0x15D92[_0x15CDE][`lineStr`];
        _0x15D65 = _0x15DBF[`replace`](/%V1lined+(end)?/, ``);
        var _0x15CB1 = _0x15DBF[`match`](/\$?%V1line\d+(end)?/);
        var _0x15D38 = ``;
        if (_0x15CB1 != null) {
          _0x15D38 = _0x15CB1[0];
        }
        var _0x15C2A = getBarsArray(_0x15D65, false);
        var _0x15DEC = ``;
        for (var _0x15D0B = 0; _0x15D0B < _0x15C2A['length']; _0x15D0B++) {
          _0x15DEC += _0x15C2A[_0x15D0B][`replace`](
            /[Q:.[^[]*]/,
            ``
          );
          if (_0x15C84 == _0x15BFD - 1) {
            var _0x15E46 = $(`#selectSpeedImg2`)[`attr`](`speed`);
            var _0x15E73 = $(`#NOTE_Q_V`)[`val`]();
            _0x15DEC +=
              `[Q: ` + _0x15E46 + `=` + _0x15E73 + `]`;
          }
          _0x15C84++;
        }
        _0x15C57 = _0x15C57[`replace`](_0x15DBF, _0x15DEC + _0x15D38);
        if (_0x15C84 > _0x15BFD) {
          break;
        }
      }
    }
    $(`#source`)[`val`](_0x15C57);
    src_change();
    doLog();
  }
}
function showNodeBgColorPicker() {
  $(`#nodecolorselecter`)[`val`](`000000`);
  $(`#nodecolorselecter`)[`click`]();
}
function setNodeBgColor() {
  var _0x15BFD = $(`#nodeMenu`)[`attr`](`barIndex`);
  if (!_0x15BFD) {
    return;
  }
  _0x15BFD = parseInt(_0x15BFD);
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x15D92 = getNodesInfo(_0x15C57);
  var _0x15D65 = ``;
  var _0x15C84 = 0;
  var _0x162D8 = /"-mb-.[^(]*"/;
  var _0x163E6 = new Array();
  var _0x16305 = /mysvgbar([d]+)/;
  $(`svg[type=rectbar],svg[type=rectnode]`)[`each`](function (_0x15CDE, _0x1646D) {
    var _0x16413 = $(_0x1646D)[`attr`](`id`);
    var _0x15FDB = $(_0x1646D)[`attr`](`type`);
    if (_0x15FDB == `rectnode`) {
      var _0x15BFD = $(_0x1646D)[`attr`](`barIndex`);
      _0x163E6[`push`](_0x15BFD);
    } else {
      var _0x16440 = _0x16413[`match`](_0x16305);
      if (_0x16440 != null) {
        _0x163E6[`push`](_0x16440[1]);
      }
    }
  });
  if (_0x15D92 != null) {
    var _0x1638C = ``;
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      var _0x18849 = _0x15D92[_0x15CDE];
      if (_0x18849[`type`] == `note`) {
        var _0x15DEC = ``;
        var _0x1A112 = _0x18849[`nodes`];
        for (var _0x15D0B = 0; _0x15D0B < _0x1A112['length']; _0x15D0B++) {
          var _0x16C29 = _0x1A112[_0x15D0B];
          var _0x162AB = _0x16C29[`nodeStr`];
          for (var _0x16332 = 0; _0x16332 < _0x163E6['length']; _0x16332++) {
            if (_0x16C29[`nodeIndex`] == _0x163E6[_0x16332]) {
              $(`.nodecolorli`)[`css`](
                `background-color`,
                $(`#nodecolorselecter`)[`val`]()
              );
              var _0x1B684 = $(`.nodecolorli`)[`css`](`background-color`);
              _0x162AB = _0x162AB[`replace`](_0x162D8, ``);
              _0x162AB =
                _0x162AB[`substring`](0, _0x162AB[`indexOf`](`|`)) +
                `"-mb-` +
                _0x1B684 +
                `"` +
                _0x162AB[`substring`](_0x162AB[`indexOf`](`|`));
            }
          }
          _0x15DEC += _0x162AB;
          _0x1638C += _0x15DEC;
        }
      } else {
        _0x1638C += _0x18849[`lineStr`] + `
`;
      }
    }
    $(`#source`)[`val`](_0x1638C);
    src_change();
    doLog();
  }
}
function setNodeBgColor(_0x1B684) {
  var _0x15BFD = $(`#nodeMenu`)[`attr`](`barIndex`);
  if (!_0x15BFD) {
    return;
  }
  _0x15BFD = parseInt(_0x15BFD);
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x15D92 = getNodesInfo(_0x15C57);
  var _0x15D65 = ``;
  var _0x15C84 = 0;
  var _0x162D8 = /"-mb-.[^)]*"/;
  var _0x163E6 = new Array();
  var _0x16305 = /mysvgbar([d]+)/;
  $(`svg[type='rectbar'],svg[type='rectnode']`)[`each`](function (_0x15CDE, _0x1646D) {
    var _0x16413 = $(_0x1646D)[`attr`](`id`);
    var _0x15FDB = $(_0x1646D)[`attr`](`type`);
    if (_0x15FDB == `rectnode`) {
      var _0x181C8 = parseInt($(_0x1646D)[`attr`](`barindex`));
      if (_0x181C8 == undefined) {
        _0x181C8 = parseInt($(_0x1646D)[`attr`](`barIndex`));
      }
      _0x163E6[`push`](_0x181C8);
    } else {
      var _0x16440 = _0x16413[`match`](_0x16305);
      if (_0x16440 != null) {
        _0x163E6[`push`](_0x16440[1]);
      }
    }
  });
  if (_0x163E6['length'] == 0) {
    window[`top`][`swAutoAlert`](`未选择小节`);
    return;
  }
  if (_0x15D92 != null) {
    var _0x1638C = ``;
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      var _0x18849 = _0x15D92[_0x15CDE];
      if (_0x18849[`type`] == `note`) {
        var _0x15DEC = ``;
        var _0x1A112 = _0x18849[`nodes`];
        var _0x1B6B1 = -1;
        for (var _0x15D0B = 0; _0x15D0B < _0x1A112['length']; _0x15D0B++) {
          var _0x16C29 = _0x1A112[_0x15D0B];
          var _0x162AB = _0x16C29[`nodeStr`];
          for (var _0x16332 = 0; _0x16332 < _0x163E6['length']; _0x16332++) {
            if (_0x16C29[`nodeIndex`] == _0x163E6[_0x16332]) {
              _0x162AB = _0x162AB[`replace`](_0x162D8, ``);
              _0x162AB = _0x162AB[`replace`](/(\"-mb).*(\)\")/g, ``);
              _0x162AB =
                _0x162AB[`substring`](
                  0,
                  _0x162AB[`indexOf`](_0x16C29[`barLineStr`])
                ) +
                `"-mb-` +
                colorRGB(_0x1B684) +
                `"` +
                _0x162AB[`substring`](
                  _0x162AB[`indexOf`](_0x16C29[`barLineStr`])
                );
            }
          }
          _0x15DEC += _0x162AB;
          _0x1B6B1 = _0x16C29[`endSeq`];
        }
        _0x1638C +=
          _0x15DEC + _0x15C57[`substring`](_0x1B6B1, _0x18849[`endSeq`]);
      } else {
        _0x1638C += _0x18849[`lineStr`] + `
`;
      }
    }
    $(`#source`)[`val`](_0x1638C);
    src_change();
    doLog();
  }
}
function clearNodeBgColor() {
  var _0x15BFD = $(`#nodeMenu`)[`attr`](`barIndex`);
  if (!_0x15BFD) {
    return;
  }
  _0x15BFD = parseInt(_0x15BFD);
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x15D92 = getNodesInfo(_0x15C57);
  var _0x15D65 = ``;
  var _0x15C84 = 0;
  var _0x162D8 = /\"-mb-.[^\)]*\)\"/;
  var _0x163E6 = new Array();
  var _0x16305 = /mysvgbar([d]+)/;
  $(`svg[type=rectbar],svg[type=rectnode]`)[`each`](function (_0x15CDE, _0x1646D) {
    var _0x16413 = $(_0x1646D)[`attr`](`id`);
    var _0x15FDB = $(_0x1646D)[`attr`](`type`);
    if (_0x15FDB == `rectnode`) {
      var _0x15BFD = $(_0x1646D)[`attr`](`barIndex`);
      if (typeof _0x15BFD == `undefined`) {
        _0x15BFD = $(_0x1646D)[`attr`](`barindex`);
      }
      _0x163E6[`push`](_0x15BFD);
    } else {
      var _0x16440 = _0x16413[`match`](_0x16305);
      if (_0x16440 != null) {
        _0x163E6[`push`](_0x16440[1]);
      }
    }
  });
  var _0x1638C = ``;
  if (_0x15D92 != null) {
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      var _0x1635F = _0x15D92[_0x15CDE];
      _0x15D65 = _0x1635F[`lineStr`];
      if (_0x1635F[`type`] == `note`) {
        var _0x15C2A = _0x1635F[`nodes`];
        var _0x15DEC = ``;
        for (var _0x15D0B = 0; _0x15D0B < _0x15C2A['length']; _0x15D0B++) {
          var _0x1627E = _0x15C2A[_0x15D0B];
          var _0x162AB = _0x1627E[`nodeStr`];
          for (var _0x16332 = 0; _0x16332 < _0x163E6['length']; _0x16332++) {
            if (_0x1627E[`nodeIndex`] == _0x163E6[_0x16332]) {
              _0x162AB = _0x162AB[`replace`](_0x162D8, ``);
              break;
            }
          }
          _0x15DEC += _0x162AB;
        }
        var _0x163B9 = ``;
        if (
          _0x15C2A['length'] > 0 &&
          _0x15C2A[_0x15C2A['length'] - 1][`endSeq`] <
          _0x1635F[`endSeq`]
        ) {
          _0x163B9 = _0x15C57[`substring`](
            _0x15C2A[_0x15C2A['length'] - 1][`endSeq`],
            _0x1635F[`endSeq`]
          )[`replace`](`
`, ``);
        }
        _0x1638C += _0x15DEC + _0x163B9 + `
`;
      } else {
        _0x1638C += _0x15D65 + `
`;
      }
    }
    $(`#source`)[`val`](_0x1638C);
    doLog();
    src_change();
  }
}
function showKeyDiv() {
  $(`#K_div .modal-content`)[`css`](
    `left`,
    ($(window)[`width`]() - $(`#K_div .modal-content`)[`width`]()) / 2
  );
  $(`#K_div`)[`modal`]();
}
function changeNodeKey() {
  var _0x16251 = $(`.keyChoice.selected`)[`attr`](`value`);
  if (!_0x16251) {
    return;
  }
  console[`log`](`selected key:`, _0x16251);
  var _0x15BFD = $(`#nodeMenu`)[`attr`](`barIndex`);
  if (!_0x15BFD) {
    return;
  }
  _0x15BFD = parseInt(_0x15BFD);
  var _0x15C57 = $(`#source`)[`val`]();
  if (_0x15BFD == 0) {
    var _0x161F7 = /K:s*[CDEFGABb#]{1,2}/;
    var _0x161CA = _0x15C57[`match`](_0x161F7);
    if (_0x161CA != null) {
      var _0x16224 = _0x161CA[0][`replace`](
        _0x161CA[0],
        _0x16251[`replace`](`[`, ``)[`replace`](
          `]`,
          ``
        )
      );
      _0x15C57 = _0x15C57[`replace`](_0x161CA[0], _0x16224);
      $(`#source`)[`val`](_0x15C57);
      src_change();
      doLog();
      return;
    }
  }
  var _0x15D92 = _0x15C57[`match`](/.*%V1lined+(end)?/g);
  var _0x15D65 = ``;
  var _0x15C84 = 0;
  if (_0x15D92 != null) {
    for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
      _0x15D65 = _0x15D92[_0x15CDE][`replace`](
        /%V1lined+(end)?/,
        ``
      );
      var _0x15CB1 = _0x15D92[_0x15CDE][`match`](/\$?%V1line\d+(end)?/);
      var _0x15D38 = ``;
      if (_0x15CB1 != null) {
        _0x15D38 = _0x15CB1[0];
      }
      var _0x15C2A = getBarsArray(_0x15D65, false);
      var _0x15DEC = ``;
      for (var _0x15D0B = 0; _0x15D0B < _0x15C2A['length']; _0x15D0B++) {
        _0x15DEC += _0x15C2A[_0x15D0B];
        if (_0x15C84 == _0x15BFD - 1) {
          _0x15DEC += _0x16251;
        }
        _0x15C84++;
      }
      _0x15C57 = _0x15C57[`replace`](
        _0x15D92[_0x15CDE],
        _0x15DEC + _0x15D38
      );
      if (_0x15C84 > _0x15BFD) {
        break;
      }
    }
    $(`#source`)[`val`](_0x15C57);
    src_change();
    doLog();
  }
}
function showMeterDiv() {
  $(`#M_div .modal-content`)[`css`](
    `left`,
    ($(window)[`width`]() - $(`#M_div .modal-content`)[`width`]()) / 2
  );
  $(`#M_div`)[`modal`]();
}
function changeNodeMeter() { }
function switchRhythm(_0x17AED) {
  var _0x15C57 = switchRhythmContent(_0x17AED);
  $(`#source`)[`val`](_0x15C57);
  src_change();
  doLog();
}
function switchRhythmContent(_0x17AED) {
  var _0x1B954 = $(_0x17AED)[`attr`](`staffnum`);
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x1B981 = new RegExp(`V:\\s*` + _0x1B954 + `.*`);
  var _0x1B927 = new Array();
  var _0x17D09 = _0x15C57[`match`](_0x1B981);
  if (_0x17D09 != null) {
    for (var _0x15CDE = 0; _0x15CDE < _0x17D09['length']; _0x15CDE++) {
      var _0x16AEE = _0x17D09[_0x15CDE];
      if ($(_0x17AED)[`is`](`:checked`)) {
        _0x15C57 = _0x15C57[`replace`](_0x16AEE, _0x16AEE + ` perc stafflines=1`);
      } else {
        _0x15C57 = _0x15C57[`replace`](
          _0x16AEE,
          _0x16AEE[`replace`](`perc stafflines=1`, ``)
        );
      }
    }
  }
  return _0x15C57;
}
function genBarDeco(_0x16251, _0x189B1, _0x15F54, _0x1873B, _0x15BFD) {
  var _0x188FD = _0x15BFD;
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x1892A = ``;
  var _0x186E1 = ``;
  var _0x1743F = 0;
  var _0x18768 = false;
  if (
    (_0x16251 == `|:` ||
      _0x16251 == `!coda!` ||
      _0x16251 == `!segno!`) &&
    parseInt(_0x15BFD) == 0
  ) {
    var _0x15D92 = getNodesInfo(_0x15C57);
    var _0x1892A = ``;
    for (var _0x16008 = 0; _0x16008 < _0x15D92['length']; _0x16008++) {
      var _0x18849 = _0x15D92[_0x16008];
      var _0x15DBF = _0x18849[`lineStr`];
      if (
        _0x18849[`type`] == `note` &&
        _0x18849[`nodes`][0][`nodeIndex`] == 0
      ) {
        _0x15DBF = _0x16251 + _0x15DBF;
      }
      _0x1892A += _0x15DBF + `
`;
    }
    $(`#source`)[`val`](_0x1892A);
    doLog();
    src_change();
    return;
  }
  if (_0x16251[`indexOf`](`[M:`) > -1) {
    if (_0x15BFD == 0) {
      var _0x1746C = _0x16251;
      _0x1746C = _0x1746C[`replace`](/[[]]/g, ``)
      [`replace`](/M:/, ``)
      [`replace`](/s/g, ``);
      $(`#M_type`)[`val`](`1`);
      if (_0x1746C == `C|`) {
        _0x1746C = `2/2`;
        $(`#M_type`)[`val`](`C|`);
      } else {
        if (_0x1746C == `C`) {
          _0x1746C = `4/4`;
          $(`#M_type`)[`val`](`C`);
        }
      }
      $(`#M_mol`)[`val`](_0x1746C[`split`](`/`)[0]);
      $(`#M_den`)[`val`](_0x1746C[`split`](`/`)[1]);
      setMValue();
      genInitStaff();
      return;
    } else {
      var _0x15D92 = getNodesInfo(_0x15C57);
      var _0x1892A = ``;
      for (
        var _0x15CDE = 0, _0x1881C = _0x15D92['length'];
        _0x15CDE < _0x1881C;
        _0x15CDE++
      ) {
        var _0x18849 = _0x15D92[_0x15CDE];
        var _0x15DBF = _0x18849[`lineStr`];
        var _0x188A3 = ``;
        var _0x187EF = -1;
        var _0x18984 = 99999;
        if (_0x18849[`type`] == `note`) {
          for (
            var _0x15D0B = 0;
            _0x15D0B < _0x18849[`nodes`]['length'];
            _0x15D0B++
          ) {
            var _0x16C29 = _0x18849[`nodes`][_0x15D0B];
            if (
              _0x16C29[`nodeIndex`] >= _0x15BFD &&
              _0x16C29[`nodeIndex`] < _0x18984
            ) {
              if (
                _0x16C29[`nodeStr`][`indexOf`](`[M:`) > -1 &&
                _0x18984 == 99999
              ) {
                _0x18984 = _0x16C29[`ondeIndex`];
                _0x188A3 += _0x16C29[`nodeStr`];
                continue;
              }
              var _0x188D0 = replaceNodeContentToRestWithMeter(
                _0x16C29[`nodeStr`],
                _0x16251
              );
              if (_0x16C29[`nodeIndex`] == _0x15BFD) {
                _0x188D0 = _0x16251 + _0x188D0;
              }
              if (_0x16C29[`nodeStr`][`indexOf`](`$`) > -1) {
                _0x188D0 =
                  _0x16C29[`nodeStr`][`substring`](
                    0,
                    _0x16C29[`nodeStr`][`indexOf`](`$`) + 1
                  ) + _0x188D0;
              }
              _0x188A3 += _0x188D0 + _0x16C29[`barLineStr`];
            } else {
              _0x188A3 += _0x16C29[`nodeStr`];
            }
            _0x187EF = _0x16C29[`endSeq`];
          }
          _0x188A3 += _0x15C57[`substring`](_0x187EF, _0x18849[`endSeq`]);
          _0x1892A += _0x188A3;
        } else {
          _0x1892A += _0x15DBF + `
`;
        }
      }
      $(`#source`)[`val`](_0x1892A);
      src_change();
      doLog();
      return;
    }
  }
  if (_0x16251[`indexOf`](`K:`) > -1 && _0x15BFD == 0) {
    var _0x187C2 = _0x16251[`replace`](/[[]]/g, ``);
    var _0x18795 = _0x187C2[`replace`](/K:/, ``)[`replace`](
      /s/g,
      ``
    );
    $(`#K`)[`val`](_0x18795);
    $(`#K`)[`change`]();
    return;
  }
  var _0x18957 = $(`svg[type='rectbar']`);
  var _0x15C57 = $(`#source`)[`val`]();
  if (_0x15F54 == `preReplace` || _0x15F54 == `preInsert`) {
    _0x15BFD--;
  }
  if (_0x18957['length'] > 0) {
    var _0x15D92 = getNodesInfo(_0x15C57);
    var _0x1892A = ``;
    for (
      var _0x15CDE = 0, _0x1881C = _0x15D92['length'];
      _0x15CDE < _0x1881C;
      _0x15CDE++
    ) {
      var _0x18849 = _0x15D92[_0x15CDE];
      var _0x15DBF = _0x18849[`lineStr`];
      var _0x188A3 = ``;
      var _0x187EF = -1;
      if (_0x18849[`type`] == `note`) {
        var _0x18876 = false;
        for (
          var _0x15D0B = 0;
          _0x15D0B < _0x18849[`nodes`]['length'];
          _0x15D0B++
        ) {
          var _0x16C29 = _0x18849[`nodes`][_0x15D0B];
          if (_0x16C29[`nodeIndex`] == _0x15BFD) {
            _0x18876 = true;
            if (_0x15F54 == `afterReplace` || _0x15F54 == `preReplace`) {
              var _0x1870E = _0x16C29[`barLineStr`][`replace`](
                /./g,
                function (_0x1735E) {
                  return `\\` + _0x1735E;
                }
              );
              var _0x168D2 = new RegExp(`(.*)` + _0x1870E);
              _0x188A3 += _0x16C29[`nodeStr`][`replace`](
                _0x168D2,
                function (_0x189DE, _0x15E46) {
                  return _0x15E46 + _0x16251;
                }
              );
            } else {
              if (_0x15F54 == `beforeInsert`) {
                if (
                  _0x16C29[`nodeStr`]
                  [`trim`]()
                  [`indexOf`](`$`) == 0
                ) {
                  _0x188A3 +=
                    `$` +
                    _0x16251 +
                    _0x16C29[`nodeStr`][`substring`](
                      _0x16C29[`nodeStr`][`indexOf`](`$`) + 1
                    );
                } else {
                  _0x188A3 += _0x16251 + _0x16C29[`nodeStr`];
                }
              } else {
                if (_0x15F54 == `preInsert` || _0x15F54 == `afterInsert`) {
                  var _0x1870E = _0x16C29[`barLineStr`][`replace`](
                    /./g,
                    function (_0x1735E) {
                      return `\\` + _0x1735E;
                    }
                  );
                  var _0x168D2 = new RegExp(`(.*)` + _0x1870E);
                  _0x188A3 += _0x16C29[`nodeStr`][`replace`](
                    _0x168D2,
                    function (_0x189DE, _0x15E46) {
                      return _0x15E46 + _0x16251 + _0x16C29[`barLineStr`];
                    }
                  );
                }
              }
            }
          } else {
            _0x188A3 += _0x16C29[`nodeStr`];
          }
          _0x187EF = _0x16C29[`endSeq`];
        }
        _0x188A3 += _0x15C57[`substring`](_0x187EF, _0x18849[`endSeq`]);
        _0x1892A += _0x188A3 + `
`;
      } else {
        _0x1892A += _0x18849[`lineStr`] + `
`;
      }
    }
    _0x1892A = replaceBlankLine(_0x1892A);
    $(`#source`)[`val`](_0x1892A);
    src_change();
    doLog();
    return;
  }
}
function selectSimpleNode(_0x17688, _0x1A4C3, _0x199B0, _0x1B549) {
  if (graphEditor[`pianoImpro`] && graphEditor[`pianoImpro`][`isOpen`]) {
    return;
  }
  var _0x16008 = _0x1A4C3[`offsetX`];
  var _0x16035 = _0x1A4C3[`offsetY`];
  var _0x175D4 = $(_0x17688)[`attr`](`index`);
  var _0x1B5FD = getClickNodeInfo(_0x16008, _0x16035, _0x199B0, _0x175D4);
  if (_0x1B5FD == null) {
    return;
  }
  var _0x1A2A7 = _0x1B5FD[`node_index`];
  var _0x1B5D0 = _0x1B5FD[`v`];
  var _0x1B62A = $(_0x17688)[`find`](`g[type='staff']`)['length'];
  var _0x19875 = new Array();
  if (_0x1A4C3[`shiftKey`]) {
    if (lastSelectBarIndex != -1) {
      var _0x1B5A3 = -1;
      if (lastSelectBarIndex > _0x1A2A7) {
        _0x1B5A3 = lastSelectBarIndex + 0;
        lastSelectBarIndex = _0x1A2A7;
        _0x1A2A7 = _0x1B5A3;
      }
      for (
        var _0x15CDE = lastSelectBarIndex;
        _0x15CDE <= _0x1A2A7;
        _0x15CDE++
      ) {
        if (_0x1B5D0 == lastSelectNodeV) {
          var _0x1738B = new Object();
          _0x1738B[`bar_num`] = _0x15CDE;
          _0x1738B[`color`] = `red`;
          _0x1738B[`stroke`] = `red`;
          _0x1738B[`v`] = _0x1B5D0;
          _0x19875[`push`](_0x1738B);
        } else {
          selectBar(_0x17688, _0x1A4C3, _0x199B0, _0x1B549);
          return;
        }
      }
    }
  } else {
    var _0x1738B = new Object();
    _0x1738B[`bar_num`] = _0x1B5FD[`node_index`];
    _0x1738B[`v`] = _0x1B5FD[`v`];
    _0x1738B[`color`] = `red`;
    _0x1738B[`stroke`] = `red`;
    _0x19875[`push`](_0x1738B);
  }
  lastSelectBarIndex = _0x1A2A7;
  lastSelectNodeV = _0x1B5D0;
  $(`svg[type='rectbar']`)[`remove`]();
  renderStaffNodeBySt(_0x19875, `node`);
  showProperties(`bar`, _0x1A4C3);
  $(`#mysvgnode` + _0x1B5D0 + `_` + _0x1A2A7)[`attr`](
    `barIndex`,
    _0x1A2A7
  );
  var _0x1619D = $(`#mysvgnode` + _0x1B5D0 + `_` + _0x1A2A7)[
    `offset`
  ]()[`top`];
  var _0x19BCC = $(`#mysvgnode` + _0x1B5D0 + `_` + _0x1A2A7)[
    `offset`
  ]()[`left`];
  var _0x1B51C = getSelectBarContent(_0x1A2A7, 0);
  var _0x1B4EF = getPreBarInfo(_0x1A2A7, 0);
  if (_0x1B51C == null) {
    return;
  }
  if (
    _0x1B51C[`indexOf`](`$`) > -1 ||
    (_0x1B4EF && _0x1B4EF[`nextBr`])
  ) {
    $(`#btnAddBr`)[`html`](`取消换行`);
  } else {
    $(`#btnAddBr`)[`html`](`换行`);
  }
  if (_0x1A2A7 == 0) {
    $(`#btnAddBr`)[`hide`]();
    var _0x1B576 = getStaffInfo();
    if (_0x1B576[`vocalCount`] > 1) {
      $(`#delStaff`)[`show`]();
    } else {
      $(`#delStaff`)[`hide`]();
    }
  } else {
    $(`#btnAddBr`)[`show`]();
    $(`#delStaff`)[`hide`]();
  }
  var _0x1673D = $(`.abc-content`)[`offset`]()[`top`];
  var _0x16710 = $(`.abc-content`)[`offset`]()[`left`];
  if (_0x1B549) {
    $(`#nodeMenu`)
    [`css`](`position`, `absolute`)
    [`css`](
      `top`,
      _0x1619D - _0x1673D - $(`#nodeMenu`)[`height`]()
    )
    [`css`](`left`, _0x19BCC - _0x16710)
    [`show`]();
    $(`#nodeMenu`)[`attr`](`barIndex`, _0x1A2A7);
  }
}
function genLinkClef(_0x15FDB) {
  var _0x15C57 = $(`#source`)[`val`]();
  var _0x15D92 = getLinesInfo($(`#source`)[`val`]());
  var _0x18D08 = ``;
  if (musicType == 2) {
    _0x15FDB = `bracket`;
  }
  if (_0x15FDB == `brace`) {
    _0x18D08 = `{NUM}`;
  } else {
    if (_0x15FDB == `bracket`) {
      _0x18D08 = `[NUM]`;
    } else {
      if (_0x15FDB == `none`) {
      }
    }
  }
  var _0x1638C = ``;
  for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
    var _0x1635F = _0x15D92[_0x15CDE];
    var _0x15DBF = _0x1635F[`lineStr`];
    if (
      _0x15DBF[`indexOf`](`%%score`) > -1 ||
      _0x15DBF[`indexOf`](`%%staves`) > -1
    ) {
      var _0x16C83 = _0x15DBF[`match`](/%%score|%%staves/)[0];
      clefReg = /\s*\(.[^\(]*\)\s*\|{0,1}|\s*\d\s*\|{0,1}/g;
      var _0x18D35 = 0;
      var _0x18D62 = 0;
      var _0x188A3 = ``;
      while ((node = clefReg[`exec`](_0x15DBF))) {
        console[`log`](node);
        _0x188A3 += _0x15DBF[`substring`](_0x18D62, node[`index`]);
        if (_0x18D35 == selectedStaffNum) {
          _0x188A3 += _0x18D08[`replace`](`NUM`, node[0]);
        } else {
          _0x188A3 += node[0];
        }
        _0x18D62 = node[`index`] + node[0]['length'];
        _0x18D35++;
      }
      if (_0x18D62 < _0x15DBF['length']) {
        _0x188A3 += _0x15DBF[`substr`](_0x18D62);
      }
      _0x1638C += _0x188A3 + `
`;
    } else {
      _0x1638C += _0x15DBF + `
`;
    }
  }
  $(`#source`)[`val`](_0x1638C);
  src_change();
  doLog();
}
function createLyricEditor(_0x167C4) {
  console[`log`](user[`showLyricEditor`]);
  if (!user[`editorAnnot`]) {
    return;
  }
  var _0x16797 = $(`.selected_text[type*='HD'],.selected_text[type^='r'],.selected_text[type='note']`);
  var _0x16710 = $(`#target`)[`offset`]()[`left`];
  var _0x1673D = $(`#target`)[`offset`]()[`top`];
  var _0x15EFA = parseInt($(_0x16797)[`attr`](`istart`));
  if (user[`showLyricEditor`]) {
    user[`showLyricEditor`] = false;
    _0x15EFA = lastEditLyricIstart;
    var _0x164F4 = syms[_0x15EFA];
    for (
      var _0x15CDE = _0x15EFA + 1;
      _0x15CDE < syms['length'];
      _0x15CDE++
    ) {
      var _0x16170 = syms[_0x15CDE];
      if (_0x16170) {
        if (
          (_0x16170[`type`] == 8 || _0x16170[`type`] == 10) &&
          _0x16170[`v`] == _0x164F4[`v`]
        ) {
          _0x15EFA = _0x16170[`istart`];
          $(_0x16797)[`removeClass`](`selected_text`);
          $(`text[istart=` + _0x15EFA + `]`)[`addClass`](`selected_text`);
          _0x16797 = $(`.selected_text[type*='HD'],.selected_text[type^='r'],.selected_text[type='note']`);
          break;
        }
      }
    }
  }
  lastEditLyricIstart = _0x15EFA;
  if (_0x16797['length'] > 0) {
    _0x15EFA = $(_0x16797)[`attr`](`istart`);
    var _0x16170 = syms[_0x15EFA];
    if (_0x16170) {
      var _0x15FAE = $(`rect[istart=` + _0x15EFA + `]`);
      var _0x1657B = document[`createElement`](`div`);
      $(_0x1657B)
      [`css`](`z-index`, 99999)
      [`css`](`position`, `absolute`)
      [`css`](`background-color`, `white`);
      $(_0x1657B)[`attr`](`contenteditable`, `true`);
      $(_0x1657B)[`addClass`](`editor-div`);
      $(_0x1657B)[`attr`](`sistart`, _0x15EFA);
      $(_0x1657B)[`attr`](`line`, _0x16170[`my_line`]);
      $(_0x1657B)[`attr`](`v`, _0x16170[`v`]);
      $(_0x1657B)[`on`](`keyup`, function (_0x16062) {
        _0x16062[`preventDefault`]();
      });
      var _0x16602 = false;
      $(_0x1657B)[`focus`](function (_0x16062) {
        console[`log`](`聚焦`);
        _0x16602 = true;
      });
      $(_0x1657B)[`blur`](function (_0x16062) {
        console[`log`](`失焦`, _0x16062);
        _0x16602 = false;
        var _0x1684B = this;
        setTimeout(function () {
          if (_0x16602) {
            return;
          }
          var _0x16251 = $(_0x1684B)[`html`]();
          var _0x168A5 = null;
          var _0x168D2 = /\<div(([\s\S])*?)\<\/div\>/g;
          var _0x16878 = [];
          var _0x15C84 = 0;
          while ((_0x168A5 = _0x168D2[`exec`](_0x16251))) {
            if (_0x15C84 == 0) {
              if (_0x168A5[`index`] != 0) {
                _0x16878[`push`](
                  _0x16251[`substring`](0, _0x168A5[`index`])
                );
              }
            }
            _0x16878[`push`](
              _0x168A5[1]
              [`replaceAll`](`<br>`, ``)
              [`replace`](`>`, ``)
              [`replace`](/s/g, ``)
            );
            _0x15C84++;
          }
          if (_0x15C84 == 0) {
            _0x16878[`push`](
              _0x16251[`replace`](/s/g, ``)[`replaceAll`](
                `<br>`,
                ``
              )
            );
          }
          while (_0x16878[_0x16878['length'] - 1] == ``) {
            _0x16878[`splice`](_0x16878['length'] - 1, 1);
          }
          updateLyrics(_0x16170, _0x16878);
          $(_0x1684B)[`remove`]();
        }, 50);
      });
      var _0x1649A = $(_0x15FAE)[0][`getBBox`]();
      var _0x164C7 = $(_0x15FAE)[0][`getBoundingClientRect`]();
      var _0x165D5 = 0;
      var _0x165A8 = 30;
      var _0x166E3 = -1;
      if (_0x16170[`a_ly`]) {
        for (
          var _0x16008 = 0;
          _0x16008 < _0x16170[`a_ly`]['length'];
          _0x16008++
        ) {
          if (_0x16170[`a_ly`][_0x16008]) {
            var _0x166B6 = _0x16170[`a_ly`][_0x16008][`istart`];
            var _0x1676A = $(`rect[type='lyrics'][istart='` + _0x166B6 + `']`);
            _0x164C7 = $(_0x1676A)[0][`getBoundingClientRect`]();
            _0x165D5 = _0x164C7[`top`] - _0x1673D - _0x16008 * 25;
            _0x165A8 = _0x16170[`a_ly`]['length'] * 25;
            break;
          }
        }
      } else {
        _0x165D5 =
          _0x164C7[`top`] - _0x1673D + parseFloat(_0x164C7[`height`]);
      }
      $(_0x1657B)
      [`css`]({
        left: _0x164C7[`left`] - _0x16710,
        top: _0x165D5,
        "min-width": 40,
        "min-height": _0x165A8,
      })
      [`show`]();
      if (_0x16170[`a_ly`]) {
        var _0x1681E = [];
        var _0x1662F = [];
        var _0x1654E = [];
        var _0x16521 = ``;
        for (
          var _0x15CDE = 0;
          _0x15CDE < _0x16170[`a_ly`]['length'];
          _0x15CDE++
        ) {
          var _0x1665C = _0x16170[`a_ly`][_0x15CDE];
          if (_0x1665C) {
            var _0x167F1 = _0x1665C[`t`];
            var _0x166B6 = _0x1665C[`istart`];
            var _0x16689 = _0x1665C[`iend`];
            _0x1681E[`push`](_0x167F1);
            _0x1662F[`push`](_0x166B6);
            _0x1654E[`push`](_0x16689);
            if (_0x15CDE < _0x16170[`a_ly`]['length']) {
              _0x16521 += `<div>` + _0x167F1 + `</div>`;
            } else {
              _0x16521 += _0x167F1;
            }
          } else {
            _0x16521 += `<div><br></div>`;
          }
        }
        $(_0x1657B)[`attr`](
          `lyistart`,
          _0x1662F[`join`](`,`)
        );
        $(_0x1657B)[`attr`](
          `lyiend`,
          _0x1654E[`join`](`,`)
        );
        $(_0x1657B)[`attr`](
          `word`,
          _0x1681E[`join`](`,`)
        );
        $(_0x1657B)[`html`](_0x16521);
      }
      $(`#target`)[`append`]($(_0x1657B));
      $(_0x1657B)[`focus`]();
    }
  }
}
function updateLyrics(_0x16170, _0x18E16) {
  var _0x15D92 = getNodesInfo($(`#source`)[`val`]());
  var _0x1C0B6 = -1;
  var _0x1C0E3 = -1;
  for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
    var _0x18849 = _0x15D92[_0x15CDE];
    if (
      _0x16170[`istart`] >= _0x18849[`startSeq`] &&
      _0x16170[`iend`] <= _0x18849[`endSeq`]
    ) {
      _0x1C0B6 = _0x18849[`index`];
      for (
        var _0x15D0B = 0;
        _0x15D0B < _0x18849[`nodes`]['length'];
        _0x15D0B++
      ) {
        var _0x16C29 = _0x18849[`nodes`][_0x15D0B];
        if (
          _0x16170[`istart`] >= _0x16C29[`startSeq`] &&
          _0x16170[`iend`] <= _0x16C29[`endSeq`]
        ) {
          _0x1C0E3 = _0x15D0B;
          break;
        }
      }
      break;
    }
  }
  var _0x1C002 = _0x15D92[_0x1C0B6][`lyricLineNums`];
  var _0x1C110 = [];
  var _0x1B495 = _0x15D92[_0x1C0B6][`startSeq`];
  var _0x1B35A = _0x15D92[_0x1C0B6][`endSeq`];
  var _0x1C089 = new Map();
  var _0x1C02F =
    _0x18E16['length'] > _0x1C002['length']
      ? _0x18E16['length']
      : _0x1C002['length'];
  for (var _0x15D0B = 0; _0x15D0B < _0x1C02F; _0x15D0B++) {
    var _0x1C05C = _0x1C089[`get`](`lyric` + _0x15D0B);
    if (_0x1C05C == null) {
      _0x1C05C = `w:`;
    }
    var _0x1BFD5 = [];
    for (var _0x15CDE = _0x1B495; _0x15CDE <= _0x1B35A; _0x15CDE++) {
      var _0x1BFA8 = syms[_0x15CDE];
      if (_0x1BFA8) {
        if (
          (_0x1BFA8[`type`] == 8 && !_0x1BFA8[`grace`]) ||
          _0x1BFA8[`type`] == 10
        ) {
          if (_0x1BFD5[`indexOf`](_0x1BFA8[`istart`]) > -1) {
            continue;
          }
          if (_0x1BFA8[`type`] == 10) {
            var _0x15C57 = $(`#source`)[`val`]();
            var _0x17115 = _0x15C57[`substring`](
              _0x1BFA8[`istart`],
              _0x1BFA8[`iend`]
            );
            if (_0x17115[`indexOf`](`,`) < 0) {
              continue;
            }
          }
          _0x1BFD5[`push`](_0x1BFA8[`istart`]);
          var _0x1665C = `*`;
          if (_0x1BFA8[`a_ly`] && _0x1BFA8[`a_ly`][_0x15D0B]) {
            _0x1665C = _0x1BFA8[`a_ly`][_0x15D0B][`t`];
          }
          if (_0x1BFA8[`istart`] == _0x16170[`istart`]) {
            var _0x167F1 = _0x18E16[_0x15D0B];
            if (!_0x167F1 || _0x167F1 == ``) {
              _0x167F1 = `*`;
            }
            _0x1C05C += ` ` + _0x167F1;
          } else {
            _0x1C05C += ` ` + _0x1665C;
          }
        } else {
          if (_0x1BFA8[`type`] == 0) {
            _0x1C05C += `|`;
          }
        }
      }
    }
    _0x1C089[`set`](`lyric` + _0x15D0B, _0x1C05C);
  }
  var _0x1892A = ``;
  var _0x15C84 = 0;
  for (var _0x15CDE = 0; _0x15CDE < _0x15D92['length']; _0x15CDE++) {
    if (_0x1C002[`indexOf`](_0x15CDE) > -1) {
      continue;
    }
    var _0x18849 = _0x15D92[_0x15CDE];
    var _0x15DBF = _0x18849[`lineStr`];
    _0x1892A += _0x15DBF + `
`;
    if (_0x15CDE < _0x1C0B6 && _0x18849[`type`] == `note`) {
      if (
        _0x15D92[_0x15CDE + 1] &&
        _0x15D92[_0x15CDE + 1][`type`] != `lyric`
      ) {
        _0x1892A += `w:
`;
      }
    }
    if (_0x15CDE == _0x1C0B6) {
      for (var _0x15D0B = 0; _0x15D0B < _0x1C02F; _0x15D0B++) {
        _0x1892A +=
          _0x1C089[`get`](`lyric` + _0x15D0B) + `
`;
      }
    }
  }
  _0x1892A = replaceBlankLine(_0x1892A);
  $(`#source`)[`val`](_0x1892A);
  src_change(createLyricEditor);
  doLog();
}
function editCurrNoteLyric() {
  hiddenMenu();
  createLyricEditor();
}
function editorCurrNoteAnnot() {
  hiddenMenu();
  var _0x16797 = $(`.selected_text[type*='HD'],.selected_text[type^='r']`);
  if (_0x16797['length'] == 0) {
    window[`top`][`swAutoAlert`](`未选中音符`);
    return;
  }
  var _0x15EFA = $(_0x16797)[`attr`](`istart`);
  editorAnnot(_0x15EFA);
}
function getPathInfo(_0x16AEE) {
  var _0x17AED = new Object();
  var _0x17D36 = new Object();
  var _0x19B9F = /M(.[^c]*)c/;
  var _0x1A24D = _0x19B9F[`exec`](_0x16AEE);
  var _0x19659 = new Object();
  _0x19659[`x`] = parseFloat(
    _0x1A24D[1][`split`](` `)[0]
  );
  _0x19659[`y`] = parseFloat(
    _0x1A24D[1][`split`](` `)[1]
  );
  _0x17AED[`start`] = _0x19659;
  var _0x1A1F3 = /c(.[^v]*)v/;
  var _0x1A16C = _0x1A1F3[`exec`](_0x16AEE);
  var _0x1A220 = _0x1A16C[1]
  [`replace`](/s+/, ` `)
  [`replace`](`
`, ``)
  [`replace`](`\t`, ``);
  var _0x1A27A = _0x1A220[`split`](` `);
  var _0x1A199 = new Object();
  _0x1A199[`x`] = parseFloat(_0x1A27A[0]);
  _0x1A199[`y`] = parseFloat(_0x1A27A[1]);
  _0x17AED[`control1`] = _0x1A199;
  var _0x1A1C6 = new Object();
  _0x1A1C6[`x`] = parseFloat(_0x1A27A[2]);
  _0x1A1C6[`y`] = parseFloat(_0x1A27A[3]);
  _0x17AED[`control2`] = _0x1A1C6;
  var _0x193B6 = new Object();
  _0x193B6[`x`] = parseFloat(_0x1A27A[4]);
  _0x193B6[`y`] = parseFloat(_0x1A27A[5]);
  _0x17AED[`end`] = _0x193B6;
  console[`log`](_0x17AED);
  return _0x17AED;
}
function setPathInfo(_0x16986, _0x17D36) {
  var _0x1B70B = _0x17D36[`start`];
  var _0x1A199 = _0x17D36[`control1`];
  var _0x1A1C6 = _0x17D36[`control2`];
  var _0x1B6DE = _0x17D36[`end`];
  _0x16986[`setAttribute`](`ori_start_x`, _0x1B70B[`x`]);
  _0x16986[`setAttribute`](`ori_start_y`, _0x1B70B[`y`]);
  _0x16986[`setAttribute`](`ori_end_x`, _0x1B6DE[`x`]);
  _0x16986[`setAttribute`](`ori_end_y`, _0x1B6DE[`y`]);
  _0x16986[`setAttribute`](`ori_control1_x`, _0x1A199[`x`]);
  _0x16986[`setAttribute`](`ori_control1_y`, _0x1A199[`y`]);
  _0x16986[`setAttribute`](`ori_control2_x`, _0x1A1C6[`x`]);
  _0x16986[`setAttribute`](`ori_control2_y`, _0x1A1C6[`y`]);
}
function pathxy(
  _0x1AFD6,
  _0x1B08A,
  _0x1B003,
  _0x1B0B7,
  _0x1AE41,
  _0x17CDC,
  _0x1AFA9,
  _0x1AE6E
) {
  var _0x182D6,
    _0x18303,
    _0x1AE9B,
    _0x1AD33 = 0.3,
    _0x1AD60 = 0.45;
  _0x18303 = _0x1B0B7 - _0x1B08A;
  if (_0x18303 < 0) {
    _0x18303 = -_0x18303;
  }
  _0x182D6 = _0x1B003 - _0x1AFD6;
  if (_0x182D6 > 40 && _0x18303 / _0x182D6 < 0.7) {
    _0x1AD33 = 0.3 + 0.002 * (_0x182D6 - 40);
    if (_0x1AD33 > 0.7) {
      _0x1AD33 = 0.7;
    }
  }
  var _0x1AEC8 = 0.5 * (_0x1AFD6 + _0x1B003),
    _0x1AEF5 = 0.5 * (_0x1B08A + _0x1B0B7),
    _0x1B030 = _0x1AEC8 + _0x1AD33 * (_0x1AFD6 - _0x1AEC8),
    _0x1B0E4 = _0x1AEF5 + _0x1AD33 * (_0x1B08A - _0x1AEF5) + _0x17CDC;
  _0x1B030 = _0x1AFD6 + _0x1AD60 * (_0x1B030 - _0x1AFD6);
  _0x1B0E4 = _0x1B08A + _0x1AD60 * (_0x1B0E4 - _0x1B08A);
  var _0x1B05D = _0x1AEC8 + _0x1AD33 * (_0x1B003 - _0x1AEC8),
    _0x1B111 = _0x1AEF5 + _0x1AD33 * (_0x1B0B7 - _0x1AEF5) + _0x17CDC;
  _0x1B05D = _0x1B003 + _0x1AD60 * (_0x1B05D - _0x1B003);
  _0x1B111 = _0x1B0B7 + _0x1AD60 * (_0x1B111 - _0x1B0B7);
  _0x182D6 = 0.03 * (_0x1B003 - _0x1AFD6);
  _0x18303 = 2 * _0x1AE41;
  _0x1AE9B = 0.2 + 0.001 * (_0x1B003 - _0x1AFD6);
  if (_0x1AE9B > 0.6) {
    _0x1AE9B = 0.6;
  }
  _0x1AE9B *= _0x1AE41;
  var _0x1AF22 = ``;
  _0x1AF22 +=
    `M` +
    abc[`sx`](_0x1AFD6) +
    `  ` +
    abc[`sy`](_0x1B08A);
  var _0x1AF4F = 1;
  var _0x1AD8D = ((_0x1B08A - _0x1B0E4) / _0x1AF4F)[`toFixed`](2);
  var _0x167F1 = _0x1AFA9 && radianHei ? radianHei : 0;
  if (_0x1AFA9 && _0x1AD8D > 0) {
    _0x1AD8D = -_0x1AD8D - _0x167F1;
  }
  var _0x1ADE7 = ((_0x1B08A - _0x1B111) / _0x1AF4F)[`toFixed`](2);
  if (_0x1AFA9 && _0x1ADE7 > 0) {
    _0x1ADE7 = -_0x1ADE7 - _0x167F1;
  }
  var _0x1ADBA = ((_0x1B0B7 + _0x1AE9B - _0x1B111 - _0x18303) / _0x1AF4F)[
    `toFixed`
  ](2);
  if (_0x1AFA9 && _0x1ADBA > 0) {
    _0x1ADBA = -_0x1ADBA - _0x167F1;
  }
  var _0x1AE14 = ((_0x1B0B7 + _0x1AE9B - _0x1B0E4 - _0x18303) / _0x1AF4F)[
    `toFixed`
  ](2);
  if (_0x1AFA9 && _0x1AE14 > 0) {
    _0x1AE14 = -_0x1AE14 - _0x167F1;
  }
  var _0x1AF7C = new Object();
  _0x1AF7C[`scale`] = 1;
  var _0x1AF4F = 1;
  _0x1AF22 +=
    `c` +
    ((_0x1B030 - _0x1AFD6) / _0x1AF7C[`scale`])[`toFixed`](1) +
    ` ` +
    ((_0x1B08A - _0x1B0E4) / _0x1AF4F)[`toFixed`](1) +
    ` ` +
    ((_0x1B05D - _0x1AFD6) / _0x1AF7C[`scale`])[`toFixed`](1) +
    ` ` +
    ((_0x1B08A - _0x1B111) / _0x1AF4F)[`toFixed`](1) +
    ` ` +
    ((_0x1B003 - _0x1AFD6) / _0x1AF7C[`scale`])[`toFixed`](1) +
    ` ` +
    ((_0x1B08A - _0x1B0B7) / _0x1AF4F)[`toFixed`](1);
  if (!_0x1AE6E) {
    _0x1AF22 +=
      `
\tv` +
      (-_0x1AE9B)[`toFixed`](1) +
      `c` +
      ((_0x1B05D - _0x182D6 - _0x1B003) / _0x1AF7C[`scale`])[`toFixed`](
        1
      ) +
      ` ` +
      ((_0x1B0B7 + _0x1AE9B - _0x1B111 - _0x18303) / _0x1AF4F)[`toFixed`](
        1
      ) +
      ` ` +
      ((_0x1B030 + _0x182D6 - _0x1B003) / _0x1AF7C[`scale`])[`toFixed`](
        1
      ) +
      ` ` +
      ((_0x1B0B7 + _0x1AE9B - _0x1B0E4 - _0x18303) / _0x1AF4F)[`toFixed`](
        1
      ) +
      ` ` +
      ((_0x1AFD6 - _0x1B003) / _0x1AF7C[`scale`])[`toFixed`](1) +
      ` ` +
      ((_0x1B0B7 + _0x1AE9B - _0x1B08A) / _0x1AF4F)[`toFixed`](1);
  }
  _0x1AF22 += `"/>
`;
  console[`log`](_0x1AF22);
}
